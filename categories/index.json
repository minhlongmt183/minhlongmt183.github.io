[{"content":"Ká»ƒ tá»« chÆ°Æ¡ng nÃ y, mÃ¬nh báº¯t Ä‘áº§u chuyá»ƒn qua há»c ná»™i dá»¥ng docker trÃªn katacoda.com. VÃ  cÃ¡ch há»c mÃ¬nh cÅ©ng sáº½ khÃ¡c, tÃ³m táº¯t báº±ng sÆ¡ Ä‘á»“ tÆ° duy vÃ  trÃ¬nh bÃ y láº¡i nhá»¯ng gÃ¬ mÃ¬nh hiá»ƒu sau khi há»c Ä‘Æ°á»£c trÃªn blog theo flow cá»§a sÆ¡ Ä‘á»“ tÆ° duy. Má»¥c Ä‘Ã­ch cá»§a blog nÃ y giÃºp mÃ¬nh Ã´n láº¡i, hiá»ƒu rÃµ hÆ¡n nhá»¯ng kiáº¿n thá»©c Ä‘Ã£ há»c.  Tá»•ng quan vá» khÃ³a há»c Trong khÃ³a há»c nÃ y, mÃ¬nh sáº½ Ä‘i qua má»™t sá»‘ chá»§ Ä‘á» chÃ­nh nhÆ° hÃ¬nh bÃªn dÆ°á»›i. Trong nhá»¯ng chá»§ Ä‘á» nÃ y cÃ³ nhá»¯ng chá»§ Ä‘á» má»›i vÃ  nhá»¯ng chá»§ Ä‘á» Ä‘Ã£ Ä‘á» cáº­p qua trong khÃ³a há»c cá»§a anh XuanThuLabChanel. Nhá»¯ng pháº§n Ä‘Ã£ nÃ³i qua thÃ¬ sáº½ khÃ´ng nÃ³i láº¡i mÃ  chá»‰ ghi chÃº thÃªm nhá»¯ng má»¥c má»›i, chÆ°a Ä‘á» cáº­p á»Ÿ nhá»¯ng pháº§n trÆ°á»›c Ä‘Ã³.\nWhat is the container Nhá»¯ng khÃ¡i niá»‡m cÄƒn báº£n vá» container Ä‘Ã£ Ä‘Æ°á»£c Ä‘á» cáº­p khÃ¡ nhiá»u á»Ÿ trong bÃ i docker_overview vÃ  á»Ÿ p1 trong chuá»—i bÃ i há»c tá»« anh XuanThuLabChanel. Trong pháº§n nÃ y chÃºng ta sáº½ Ä‘i qua má»™t sá»‘ khÃ¡i niá»‡m cÅ©ng nhÆ° má»™t sá»‘ chá»§ Ä‘á»:\nnamespaces KhÃ¡i niá»‡m: Namespace - khÃ´ng gian tÃªn:\n  LÃ  má»™t trong nhá»¯ng thÃ nh pháº§n cÆ¡ báº£n cá»§a container.\n  giá»›i háº¡n nhá»¯ng gÃ¬ cÃ¡c process cÃ³ thá»ƒ tháº¥y vÃ  truy cáº­p trÃªn há»‡ thá»‘ng.\n  Ä‘á»‹nh nghÄ©a vá»‹ trÃ­ inode trÃªn Ä‘Ä©a.\ninode lÃ  má»™t cáº¥u trÃºc dá»¯ liá»‡u trong má»™t há»‡ thá»‘ng táº­p tin Unix - phong cÃ¡ch mÃ´ táº£ cá»§a má»™t táº­p tin há»‡ thá»‘ng Ä‘á»‘i tÆ°á»£ng nhÆ° má»™t táº­p tin hoáº·c má»™t thÆ° má»¥c. Sá»‘ lÆ°á»£ng nÃºt trong tÃ i khoáº£n báº±ng vá»›i sá»‘ lÆ°á»£ng tá»‡p vÃ  thÆ° má»¥c cÃ³ trÃªn Ä‘Ã³. Hay cÃ³ thá»ƒ hiá»ƒu, inodes = sá»‘ files + folder.\n  ThÃ´ng qua má»™t namespace, nhiá»u process khÃ¡c nhau cÃ³ thá»ƒ chia sáº», giao tiáº¿p vá»›i nhau.\n  Khi má»™t container báº¯t Ä‘áº§u cháº¡y, nÃ³ sáº½ táº¡o ra má»™t namespace má»›i cho Ä‘á»ƒ cÃ¡c process cháº¡y trong há»™p cÃ¡t (sandboxes) cháº¡y. Báº±ng cÃ¡ch phÃ¢n bá»• namespace dá»±a trÃªn cÃ¡c pid, táº¡i thá»i Ä‘iá»ƒm cháº¡y, má»™t process sáº½ truy cáº­p vÃ o namespace tÆ°Æ¡ng á»©ng vá»›i pid cá»§a mÃ¬nh, viá»‡c nÃ y giÃºp cho process cÃ³ cáº£m giÃ¡c chá»‰ má»™t mÃ¬nh nÃ³ cháº¡y trÃªn há»‡ thá»‘ng.\n  Má»™t sá»‘ loáº¡i biáº¿n thá»ƒ cá»§a namespace Trong namespace Ä‘á»‹nh nghÄ©a má»™t sá»‘ biáº¿n thá»ƒ:\nMount (mnt): mount namespace Ä‘iá»u khiá»ƒn cÃ¡c mount point. Khi táº¡o, cÃ¡c liÃªn káº¿t tá»« mount namespace hiá»‡n táº¡i Ä‘Æ°á»£c sao chÃ©p sang khÃ´ng gian tÃªn má»›i, nhÆ°ng cÃ¡c mount point Ä‘Æ°á»£c táº¡o sau Ä‘Ã³ khÃ´ng truyá»n giá»¯a mount namespace. Cá» sao chÃ©p Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ táº¡o khÃ´ng gian tÃªn má»›i thuá»™c loáº¡i nÃ y lÃ  CLONE_NEWNS - viáº¿t táº¯t cá»§a \u0026ldquo;NEW NameSpace\u0026rdquo;. Thuáº­t ngá»¯ nÃ y khÃ´ng mang tÃ­nh mÃ´ táº£ (vÃ¬ nÃ³ khÃ´ng cho biáº¿t loáº¡i khÃ´ng gian tÃªn nÃ o sáº½ Ä‘Æ°á»£c táº¡o) bá»Ÿi vÃ¬ mount namespaces lÃ  loáº¡i namespace Ä‘áº§u tiÃªn vÃ  táº¡i thá»i Ä‘iá»ƒm, cÃ¡c nhÃ  thiáº¿t káº¿ khÃ´ng lÆ°á»ng trÆ°á»›c Ä‘Æ°á»£c sáº½ cÃ³ báº¥t ká»³ loáº¡i namespaces nÃ o khÃ¡c.\nProcess ID(pid): PID namespaces cung cáº¥p nhá»¯ng process vá»›i táº­p pid Ä‘á»™c láº­p vá»›i nhá»¯ng namespace khÃ¡c. CÃ¡c PID namespace cÃ³ thá»ƒ lá»“ng vÃ o nhau nghÄ©a lÃ : má»—i process Ä‘Æ°á»£c táº¡o trong má»™t namespace sáº½ cÃ³ 1 pid, vÃ  pid nÃ y sáº½ Ä‘Æ°á»£c tháº¥y bá»Ÿi cÃ¡c process á»Ÿ trong namespace hiá»‡n táº¡i ra cho Ä‘áº¿n namespace Ä‘áº§u tiÃªn. Nghe cÃ³ váº» giá»‘ng nhÆ° trong cÃ´ng ty, má»™t nhÃ¢n viÃªn má»›i vÃ o sáº½ cÃ³ má»™t thÃ´ng tin vÃ  Ä‘á»‹nh danh riÃªng, nhá»¯ng thÃ´ng tin nÃ y sáº½ Ä‘Æ°á»£c biáº¿t bá»Ÿi sáº¿p anh ta, sáº¿p cá»§a sáº¿p, sáº¿p cá»§a sáº¿p cá»§a sáº¿p ğŸ¤£ğŸ¤£ğŸ¤£.\nProcess Ä‘áº§u tiÃªn sáº½ Ä‘Æ°á»£c gÃ¡n PID lÃ  1, nÃ³ cÃ³ vá»‹ trÃ­ giá»‘ng nhÆ° chá»§ tich há»™i Ä‘á»“ng quáº£n trá»‹ cá»§a cÃ´ng ty, tá»« trÃªn nhÃ¬n xuá»‘ng cÃ³ thá»ƒ tháº¥y táº¥t cáº£ nhá»¯ng process khÃ¡c, vÃ  cÃ³ quyá»n \u0026ldquo;Ä‘uá»•i\u0026rdquo; táº¥t cáº£ nhá»¯ng process dÆ°á»›i trÆ°á»›ng cá»§a mÃ¬nh.\nUser ID (user): User namespace lÃ  má»™t tÃ­nh nÄƒng Ä‘á»ƒ cung cáº¥p kháº£ nÄƒng phÃ¢n quyá»n vÃ  phÃ¢n nhÃ³m ngÆ°á»i dÃ¹ng trÃªn nhiá»u process, kháº£ náº±ng Ä‘Ã£ sáºµn cÃ³ tá»« kernel 3.8. Vá»›i quyá»n admin, cÃ³ thá»ƒ xÃ¢y dá»±ng má»™t container cÃ³ váº» nhÆ° cÃ³ quyá»n admin nhÆ°ng khÃ´ng thá»±c sá»± cáº¥p cÃ¡c Ä‘áº·c quyá»n nÃ¢ng cao cho cÃ¡c process cá»§a ngÆ°á»i dÃ¹ng. Giá»‘ng nhÆ° PID namespace, user namespace dÃ¹ng Ä‘Æ°á»£c lá»“ng vÃ o nhau vÃ  má»—i user namespace má»›i Ä‘Æ°á»£c coi lÃ  con cá»§a user namespace Ä‘Ã£ táº¡o ra nÃ³.\nUser namespace chá»©a má»™t báº£ng Ã¡nh xáº¡ Ä‘á»ƒ chuyá»ƒn Ä‘á»•i cÃ¡c user ID tá»« container sang há»‡ thá»‘ng. Äiá»u nÃ y cho phÃ©p, vÃ­ dá»¥, ngÆ°á»i dÃ¹ng root cÃ³ user id 0 trong container nhÆ°ng thá»±c sá»± Ä‘Æ°á»£c há»‡ thá»‘ng coi lÃ  user id 1.400.000 Ä‘á»ƒ kiá»ƒm tra quyá»n sá»Ÿ há»¯u. Má»™t báº£ng tÆ°Æ¡ng tá»± Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ã¡nh xáº¡ group id vÃ  kiá»ƒm tra quyá»n sá»Ÿ há»¯u.\nÄá»ƒ táº¡o Ä‘iá»u kiá»‡n thuáº­n lá»£i cho viá»‡c cÃ´ láº­p Ä‘áº·c quyá»n cá»§a cÃ¡c hÃ nh Ä‘á»™ng admin, má»—i loáº¡i namespace Ä‘Æ°á»£c coi lÃ  thuá»™c sá»Ÿ há»¯u cá»§a má»™t user namespace dá»±a trÃªn user namespace Ä‘ang hoáº¡t Ä‘á»™ng táº¡i thá»i Ä‘iá»ƒm táº¡o. NgÆ°á»i dÃ¹ng quyá»n admin trong user namespace thÃ­ch há»£p sáº½ Ä‘Æ°á»£c phÃ©p thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng admin trong loáº¡i namespace Ä‘Ã³. VÃ­ dá»¥: náº¿u má»™t process cÃ³ quyá»n quáº£n trá»‹ Ä‘á»ƒ thay Ä‘á»•i Ä‘á»‹a chá»‰ IP cá»§a giao diá»‡n máº¡ng, nÃ³ cÃ³ thá»ƒ lÃ m nhÆ° váº­y miá»…n lÃ  user namespace cá»§a chÃ­nh nÃ³ giá»‘ng vá»›i (hoáº·c tá»• tiÃªn cá»§a) user namespace sá»Ÿ há»¯u network namespace. Do Ä‘Ã³ user namespace ban Ä‘áº§u cÃ³ quyá»n kiá»ƒm soÃ¡t quáº£n trá»‹ Ä‘á»‘i vá»›i táº¥t cáº£ cÃ¡c loáº¡i user namespace trong há»‡ thá»‘ng.\nNetwork (net): Network namespace áº£o hÃ³a network stack. Khi Ä‘Æ°á»£c táº¡o, network namespace chá»‰ chá»©a má»™t loopback interface. Má»—i network interface (lÃ  physical hay virtual) thá»ƒ hiá»‡n chÃ­nh xÃ¡c má»™t namespace vÃ  cÃ³ thá»ƒ di chuyá»ƒn giá»¯a cÃ¡c namespace vá»›i nhau.\nMá»™t namespace sáº½ cÃ³ táº­p cÃ¡c Ä‘á»‹a chá»‰ IP riÃªng, chá»©a nhá»¯ng routing table, socket listing, connection tracking table, firewall, vÃ  nhá»¯ng resources liÃªn quan tá»›i network khÃ¡c.\nKhi há»§y má»™t khÃ´ng gian tÃªn máº¡ng sáº½ phÃ¡ há»§y báº¥t ká»³ giao diá»‡n áº£o nÃ o bÃªn trong nÃ³ vÃ  di chuyá»ƒn báº¥t ká»³ giao diá»‡n váº­t lÃ½ nÃ o bÃªn trong nÃ³ trá»Ÿ láº¡i khÃ´ng gian tÃªn máº¡ng ban Ä‘áº§u.\nInterprocess Communication (ipc): ipc namespace dÃ¹ng Ä‘á»ƒ cÃ´ láº­p cÃ¡c process trong giao tiáº¿p. Äiá»u nÃ y ngÄƒn khÃ´ng cho cÃ¡c quÃ¡ trÃ¬nh trong cÃ¡c vÃ¹ng tÃªn IPC khÃ¡c nhau sá»­ dá»¥ng, cháº³ng háº¡n nhÆ° nhÃ³m hÃ m SHM Ä‘á»ƒ thiáº¿t láº­p pháº¡m vi bá»™ nhá»› dÃ¹ng chung giá»¯a hai quÃ¡ trÃ¬nh. Thay vÃ o Ä‘Ã³, má»—i quÃ¡ trÃ¬nh sáº½ cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¹ng má»™t sá»‘ nháº­n dáº¡ng cho má»™t vÃ¹ng bá»™ nhá»› dÃ¹ng chung vÃ  táº¡o ra hai vÃ¹ng riÃªng biá»‡t nhÆ° váº­y.\nUTS: UTS namespace (UNIX Time-Sharing) cho phÃ©p má»™t há»‡ thá»‘ng duy nháº¥t cÃ³ váº» nhÆ° cÃ³ cÃ¡c tÃªn miá»n vÃ  mÃ¡y chá»§ lÆ°u trá»¯ khÃ¡c nhau cho cÃ¡c quÃ¡ trÃ¬nh khÃ¡c nhau. \u0026ldquo;Khi má»™t quy trÃ¬nh táº¡o má»™t vÃ¹ng tÃªn UTS má»›i \u0026hellip; tÃªn mÃ¡y chá»§ vÃ  miá»n cá»§a vÃ¹ng tÃªn UTS má»›i Ä‘Æ°á»£c sao chÃ©p tá»« cÃ¡c giÃ¡ trá»‹ tÆ°Æ¡ng á»©ng trong vÃ¹ng tÃªn UTS cá»§a ngÆ°á»i gá»i\u0026rdquo;.\n CÃ²n nhiá»u loáº¡i biáº¿n thá»ƒ khÃ¡c, chÃºng ta cÃ³ thá»ƒ xem chÃºng táº¡i Ä‘Ã¢y.  Unshare tool  lÃ  cÃ´ng cá»¥ giÃºp chÃºng ta cÃ³ thá»ƒ cháº¡y má»™t process vÃ  yÃªu cáº§u nÃ³ táº¡o ra má»™t namespace má»›i.  1 2 3 4 5 6 7  $ sudo unshare --fork --pid --mount-proc bash $ ps PID TTY TIME CMD 1 pts/0 00:00:00 bash 9 pts/0 00:00:00 ps $ exit exit   What happens when we share a namespace? ChÃºng ta cÃ³ thá»ƒ liá»‡t kÃª táº¥t cáº£ nhá»¯ng namespace báº±ng lá»‡nh:\n1  ls -lha /proc/$DBPID/ns/   Má»™t cÃ´ng cá»¥ khÃ¡c chÃºng ta cÃ³ thá»ƒ dÃ¹ng Ä‘Ã³ lÃ  nsenter dÃ¹ng Ä‘á»ƒ gÃ¡n má»™t process vÃ o má»™t khÃ´ng gian tÃªn Ä‘Ã£ tá»“n táº¡i, cÃ´ng cá»¥ nÃ y sáº½ há»¯u dá»¥ng khi debug.\n1  nsenter --target $DBPID --mount --uts --ipc --net --pid ps aux   Container images Container images chÃºng ta Ä‘Ã£ Ä‘Æ°á»£c há»c kÄ© trong cÃ¡c bÃ i trÆ°á»›c, á»Ÿ Ä‘Ã¢y cÃ³ má»™t sá»‘ chÃº Ã½ nhá» nhá»:\n Nhá»¯ng images chá»©a dá»¯ liá»‡u thÃ´ (metadata) Ä‘á»ƒ lÃ m cÆ¡ sá»Ÿ Ä‘á»ƒ xÃ¢y dá»±ng nhá»¯ng image khÃ¡c. ChÃºng ta Ä‘Ã£ biáº¿t, images sáº½ cÃ³ nhiá»u layer, cÃ³ 1 layer gá»‘c vÃ  nhá»¯ng layer sau lÃ  quÃ¡ trÃ¬nh chÃºng ta cÃ i Ä‘áº·t, thiáº¿t lÃ¢p thÃªm mÃ´i trÆ°á»ng khi cháº¡y contaier Ä‘Æ°á»£c sinh ra tá»« image ban Ä‘áº§u. á» Ä‘Ã¢y, má»—i tar file Ä‘Æ°á»£c xem nhÆ° má»™t layer, vÃ  táº¥t cáº£ cÃ¡c tar file Ä‘Æ°á»£c giáº£i nÃ©n tá»›i cÃ¹ng mÃ´t vá»‹ trÃ­ thÃ¬  Learn Docker Foundation Deploying First Docker Container Pháº§n nÃ y chÃºng ta cÅ©ng Ä‘Ã£ trÃ¬nh bÃ y kÄ© á»Ÿ nhá»¯ng pháº§n trÆ°á»›c, theo sÆ¡ Ä‘á»“, ta cÃ³ thá»ƒ tháº¥y, Ä‘á»ƒ build má»™t docker container, chÃºng ta cÃ³ 5 bÆ°á»›c chÃ­nh:\n Step1: TÃ¬m kiáº¿m image thÃ­ch há»£p thÃ´ng qua lá»‡nh docker search, táº£i vá» báº±ng docker pull vÃ  cháº¡y báº±ng docker run Step2: Kiá»ƒm tra nhá»¯ng container Ä‘ang cháº¡y:  docker ps: liá»‡t kÃª táº¥t cáº£ cÃ¡c container Ä‘ang cháº¡y vÃ  cÃ¡c thÃ´ng tin vá» nÃ³ docker inspect: cung cáº¥p thÃ´ng tin chi tiáº¿t vá» má»™t container Ä‘ang cháº¡y. docker logs: nhá»¯ng message mÃ  container Ä‘Ã£ log khi cháº¡y.   Step3: Truy cáº­p vÃ o container Ä‘ang cháº¡y. á» Ä‘Ã¢y, Ä‘á»‘i vá»›i má»™t container Ä‘ang cháº¡y Ä‘á»ƒ láº¥y port cá»§a nÃ³ ta cÃ³ thá»ƒ dÃ¹ng má»™t trong 2 lá»‡nh:  1 2  docker ps docker port container_id port_number    Step 4: Thiáº¿t láº­p chia sáº» dá»¯ liá»‡u giá»¯a container vÃ  host cÅ©ng nhÆ° cÃ¡c container vá»›i nhau, Ä‘áº£m báº£o dá»¯ liá»‡u cáº§n thiáº¿t sáº½ Ä‘Æ°á»£c lÆ°u khi container bá»‹ xÃ³a. Step 5: Cháº¡y container, á»Ÿ Ä‘Ã¢y cÃ³ má»™t sá»‘ thiáº¿t láº­p nhÆ° -d Ä‘á»ƒ cháº¡y ná»n hay -it Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i shell.\nNhá»¯ng pháº§n nÃ y chÃºng ta Ä‘Ã£ Ä‘Æ°á»£c há»c á»Ÿ nhá»¯ng bÃ i trÆ°á»›c.  Deploy Static HTML Website as Container TÃ³m táº¯t cho pháº§n nÃ y\nCreate Dockerfile Docker file lÃ  gÃ¬? Dockerfile lÃ  má»™t dáº¡ng file text, khÃ´ng cÃ³ pháº§n Ä‘uÃ´i má»Ÿ rá»™ng, chá»©a táº­p cÃ¡c lá»‡nh mÃ´ táº£ cÃ¡c bÆ°á»›c Ä‘á»ƒ build má»™t docker image.\nCÃº phÃ¡p cá»§a má»™t dockerfile. Cáº¥u trÃºc chung cá»§a má»™t dockerfile cÃ³ dáº¡ng\nINSTRUCTION arguments Trong Ä‘Ã³:\n INSTRUCTION: lÃ  tÃªn cÃ¡c chá»‰ thá»‹ cÃ³ trong Dockerfile, má»—i chá»‰ thá»‹ thá»±c hiá»‡n má»™t nhiá»‡m vá»¥ nháº¥t Ä‘á»‹nh, do dockerfile quy Ä‘á»‹nh. Máº¡c Ä‘á»‹nh, lá»‡nh nÃ y pháº£i Ä‘Æ°á»£c viáº¿t báº±ng chá»¯ IN HOA arguments: ná»™i dung mÃ  lá»‡nh thá»±c hiá»‡n\nVÃ­ dá»¥:  1 2  FROMnginx:alpineCOPY . /usr/share/nginx/html  DÃ²ng lá»‡nh 1 Ä‘á»ƒ Ä‘á»‹nh nghÄ©a base images vÃ  dÃ²ng lá»‡nh 2 Ä‘á»ƒ chá»‰ thá»‹ copy táº¥t cáº£ ná»™i dá»¥ng táº¡i vá»‹ trÃ­ hiá»‡n táº¡i vÃ o má»™t Ä‘á»‹a chá»‰ cá»¥ thá»ƒ trÃªn container, á»Ÿ Ä‘Ã¢y lÃ  /usr/share/nginx/html.\nCÃ¡c chá»‰ thá»‹ chÃ­nh trong dockerfile  FROM\nChá»‰ Ä‘á»‹nh ráº±ng image nÃ o sáº½ Ä‘Æ°á»£c lÃ m cÆ¡ sá»Ÿ trong quÃ¡ trÃ¬nh build image Ä‘á»ƒ thá»±c thi nhá»¯ng cÃ¢u lá»‡nh tiáº¿p theo. CÃ¡c image nÃ y Ä‘Æ°á»£c táº£i vá» tá»« Public Repository hoáº·c Private Reppository riÃªng cá»§a má»—i ngÆ°á»i.\nChá»‰ thá»‹ FROM lÃ  báº¯t buá»™c vÃ  pháº£i Ä‘Æ°á»£c Ä‘áº·t trÃªn cÃ¹ng cá»§a Dockerfile\nCÃº phÃ¡p:  1 2 3  FROM \u0026lt;image\u0026gt; [AS \u0026lt;name\u0026gt;] FROM \u0026lt;image\u0026gt;[:\u0026lt;tag\u0026gt;] [AS \u0026lt;name\u0026gt;] FROM \u0026lt;image\u0026gt;[@\u0026lt;digest\u0026gt;] [AS \u0026lt;name\u0026gt;]   VÃ­ dá»¥:\n1 2 3  FROM ubuntu hoáº·c FROM ubuntu:latest   LABEL\nChá»‰ thá»‹ LABEL Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ thÃªm cÃ¡c thÃ´ng tin meta vÃ o Docker Image khi chÃºng Ä‘Æ°á»£c build. ChÃºng tá»“n táº¡i dÆ°á»›i dáº¡ng cáº·p key-value, lÆ°u dÆ°á»›i dáº¡ng chuá»—i. CÃ³ thá»ƒ chá»‰ Ä‘á»‹nh nhiá»u label cho má»™t Docker Image, má»—i cáº·p key-value lÃ  duy nháº¥t.\nNáº¿u cÃ¹ng 1 key mÃ  cÃ³ nhiá»u value thÃ¬ value gáº§n nháº¥t sáº½ Ä‘Ã¨ nhá»¯ng value trÆ°á»›c Ä‘Ã³.  CÃº phÃ¡p:\n1  LABEL \u0026lt;key1\u0026gt;\u0026lt;value1\u0026gt; \u0026lt;key2\u0026gt;\u0026lt;value2\u0026gt; ... \u0026lt;key_n\u0026gt;\u0026lt;value_n\u0026gt;   CÃ³ thá»ƒ khai bÃ¡o metadata cho Image theo tá»«ng dÃ²ng chá»‰ thá»‹ hoáº·c cÃ³ thá»ƒ tÃ¡ch ra khai bÃ¡o thÃ nh tá»«ng dÃ²ng riÃªng biá»‡t.\nÄá»ƒ xem thÃ´ng tin meta cá»§a má»™t image, ta dÃ¹ng lá»‡nh docker inspect\n1  docker inspect \u0026lt;image id\u0026gt;   MAINTAINER\nDÃ¹ng Ä‘á»ƒ khai bÃ¡o thÃ´ng tin tÃ¡c giáº£ cá»§a dockerfile\nCÃº phÃ¡p:  1  MAINTAINER \u0026lt;name\u0026gt; [\u0026lt;email\u0026gt;]   VÃ­ dá»¥:\n1  MAINTAINER \u0026lt;edisc\u0026gt; [\u0026lt;edisc.ctf@gmail.com\u0026gt;]   RUN\nDÃ¹ng Ä‘á»ƒ cháº¡y má»™t lá»‡nh nÃ o Ä‘Ã³ trong quÃ¡ trÃ¬nh build image, thÆ°á»ng lÃ  cÃ¡c cÃ¢u lá»‡nh Linux. TÃ¹y vÃ o image gá»‘c Ä‘Æ°á»£c khai bÃ¡o trong FROM thÃ¬ sáº½ cÃ³ cÃ¡c cÃ¢u lá»‡nh tÆ°Æ¡ng á»©ng.\nCÃº phÃ¡p:  1 2  RUN \u0026lt;command\u0026gt; RUN [\u0026#34;executable\u0026#34;, \u0026#34;param1\u0026#34;, \u0026#34;param2\u0026#34;]   VÃ­ dá»¥\n1 2  RUN apt-get update -y RUN [\u0026#34;/bin/bash\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;echo Run\u0026#34;]   á» shell form, cÃ³ thá»ƒ thá»±c hiá»‡n nhiá»u cÃ¢u lá»‡nh báº±ng dáº¥u \\:\n1 2 3 4  FROM ubuntu:latest RUN apt-get update -y \\  apt-get install vim -y apt-get install curl -y   ADD\nThá»±c hiá»‡n sao chÃ©p cÃ¡c tá»‡p, thÆ° má»¥c tá»« mÃ¡y Ä‘ang build hoáº·c remote file tá»« src vÃ  thÃªm chÃºng vÃ o filesystem cá»§a image dest\nCÃº phÃ¡p:  1 2  ADD [--chown=\u0026lt;user\u0026gt;:\u0026lt;group\u0026gt;] \u0026lt;src\u0026gt;... \u0026lt;dest\u0026gt; ADD [--chown=\u0026lt;user\u0026gt;:\u0026lt;group\u0026gt;] [\u0026#34;\u0026lt;src\u0026gt;\u0026#34;, ... \u0026#34;\u0026lt;dest\u0026gt;\u0026#34;]   trong Ä‘Ã³:\n src cÃ³ thá»ƒ lÃ  má»™t hoáº·c nhiá»u file, thÆ° má»¥c dest lÃ  Ä‘á»‹a chá»‰ tuyá»‡t Ä‘á»‘i hoáº·c Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh bá»Ÿi WORKDIR  VÃ­ dá»¥:\n1  ADD --chown=user:mygroup file* /somedir/   COPY\nGiá»‘ng nhÆ° ADD lÃ  copy file tá»« thÆ° má»¥c src Ä‘áº¿n dest, khÃ¡c á»Ÿ viá»‡c COPY khÃ´ng há»— trá»£ copy cÃ¡c remote file URLs tá»« cÃ¡c nguá»“n trÃªn máº¡ng.\nCÃº phÃ¡p:  1 2  COPY [--chown=\u0026lt;user\u0026gt;:\u0026lt;group\u0026gt;] \u0026lt;src\u0026gt;... \u0026lt;dest\u0026gt; COPY [--chown=\u0026lt;user\u0026gt;:\u0026lt;group\u0026gt;] [\u0026#34;\u0026lt;src\u0026gt;\u0026#34;,... \u0026#34;\u0026lt;dest\u0026gt;\u0026#34;]   ENV\nDÃ¹ng Ä‘á»ƒ khai bÃ¡o cÃ¡c biáº¿n mÃ´i trÆ°á»ng. CÃ¡c biáº¿n Ä‘Æ°á»£c khai bÃ¡o dÆ°á»›i dáº¡ng key-value báº±ng cÃ¡c chuá»—i. ChÃºng sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng trong cÃ¡c chá»‰ thá»‹ tiáº¿p theo cá»§a Dockerfile.\nCÃº phÃ¡p:  1  ENV \u0026lt;key\u0026gt;=\u0026lt;value\u0026gt;   VÃ­ dá»¥:\n1 2  ENV PORT=80 ENV USERNAME=\u0026#34;user\u0026#34; PASSWORD=\u0026#34;password\u0026#34;   CÃ¡c biáº¿n mÃ´i trÆ°á»ng cÃ³ thá»ƒ thay Ä‘á»•i vá»›i lá»‡nh docker run\n1  docker run --env \u0026lt;key\u0026gt;=\u0026lt;value\u0026gt;   CÃ¡c command Ä‘Æ°á»£c sá»­ dá»¥ng ENV:\n1 2 3 4 5 6 7 8 9 10  ADD COPY ENV EXPOSE FROM LABEL STOPSIGNAL USER VOLUME WORKDIR   CMD\nDÃ¹ng Ä‘á»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c cÃ¢u lá»‡nh Ä‘Æ°á»£c cháº¡y sau khi container Ä‘Æ°á»£c khá»Ÿi Ä‘á»™ng tá»« image vá»«a build.\nCÃº phÃ¡p:  1 2 3  CMD [\u0026#34;executable\u0026#34;, \u0026#34;param1\u0026#34;, \u0026#34;param2\u0026#34;] CMD [\u0026#34;param1\u0026#34;, \u0026#34;param2\u0026#34;] CMD command param1 param2   VÃ­ dá»¥:\n1 2  FROM ubuntu:latest CMD cat password.txt   USER\nThiáº¿t láº­p username hoáº·c UID Ä‘á»ƒ sá»­ dá»¥ng khi cháº¡y image vÃ  khi cháº¡y cÃ¡c lá»‡nh cÃ³ trong RUN, CMD, ENTRYPOINT sau Ä‘Ã³.\nCÃº phÃ¡p:  1 2 3  USER \u0026lt;user\u0026gt;[:\u0026lt;group\u0026gt;] hoáº·c USER \u0026lt;UID\u0026gt;[:\u0026lt;GID\u0026gt;]   VÃ­ dá»¥:\n1 2 3  FROM alpine:3.4 RUN useradd -G /bin/bash edisc USER edisc   Build Docker Image Ta dÃ¹ng lá»‡nh docker build Ä‘á»ƒ tiáº¿n hÃ nh build docker image tá»« Dockerfile vá»«a táº¡o.\nCÃº phÃ¡p:\n1  docker build -t \u0026lt;image_name\u0026gt; \u0026lt;build directory\u0026gt;   VÃ­ dá»¥:\n1  docker build -t myimage:v1 .   -t á»Ÿ Ä‘Ã¢y cho phÃ©p chá»‰ Ä‘á»‹nh tÃªn image vÃ  tag cá»§a nÃ³.\nRUN Sau khi Ä‘Ã£ táº¡o thÃ nh image, ta chá»‰ cáº§n run nÃ³ vá»›i lá»‡nh docker run Ä‘á»ƒ tiáº¿n hÃ nh cháº¡y container.\nTá»•ng káº¿t Pháº§n nÃ y chÃºng ta Ä‘i qua 2 nhÃ¡nh chÃ­nh lÃ  What is the container vÃ  Container images, á»Ÿ Ä‘Ã³ chá»§ yáº¿u lÃ  nhá»¯ng kiáº¿n thá»©c chÃºng ta Ä‘Ã£ tháº£o luáº­n qua.\nNgoÃ i ra, chÃºng ta Ä‘Ã£ Ä‘i qua má»™t vÃ i nhÃ¡nh nhá» cá»§a Docker Foundation. VÃ¬ pháº§n nÃ y liÃªn quan Ä‘áº¿n má»¥c Ä‘Ã­ch cÃ´ng viá»‡c cá»§a tÃ´i, nÃªn tÃ´i sáº½ há»c kÄ© cÅ©ng nhÆ° tÃ¬m hiá»ƒu kÄ© pháº§n nÃ y. BÃ i tiáº¿p theo chÃºng ta sáº½ cÃ¹ng Ä‘i qua nhá»¯ng nhÃ¡nh káº¿ tiáº¿p.\n","description":"Ã”n láº¡i docker vÃ  chuyá»ƒn ná»™i dung há»c","id":0,"section":"posts","tags":["Docker"],"title":"TÃ¬m hiá»ƒu vÃ  sá»­ dá»¥ng docker (P6)","uri":"https://minhlongmt183.github.io/posts/docker_p6/"},{"content":"ToÃ n bá»™ series nÃ y Ä‘Æ°á»£c tham kháº£o tá»« hai nguá»“n chÃ­nh: XuanThuLabChanel vÃ  DockerDoc. Em xin chÃ¢n thÃ nh cáº£m Æ¡n sá»± cá»‘ng hiáº¿n cá»§a cÃ¡c tÃ¡c giáº£ cá»§a nhá»¯ng kÃªnh nÃ³i trÃªn.â¤ï¸â¤ï¸â¤ï¸  Tra cá»©u thÃ´ng tin Image, Container vÃ  giÃ¡m sÃ¡t hoáº¡t Ä‘á»™ng container Docker CÃ¡c thÃ nh pháº§n táº¡o nÃªn Container ChÃºng ta Ä‘Ã£ tháº£o luáº­n vá» cÃ¡c khÃ¡i niá»‡m cÄƒn báº£n cá»§a docker á»Ÿ báº£i trÆ°á»›c, sau Ä‘Ã¢y lÃ  nhá»¯ng khÃ¡i niá»‡m trÃªn dÆ°á»›i gÃ³c nhÃ¬n cá»§a tÃ¡c giáº£.\n Container: lÃ  má»™t há»™p kÃ­n Ä‘á»ƒ á»©ng dá»¥ng hoáº¡t Ä‘á»™ng. Má»—i container Ä‘Æ°á»£c táº¡o dá»±a trÃªn má»™t image. Khi cháº¡y má»™t container xuáº¥t phÃ¡t tá»« má»™t image, cÃ³ má»™t lá»›p (layer) Ä‘Æ°á»£c phÃ©p ghi thÃªm vÃ o trÃªn Ä‘á»‰nh cá»§a image. Do Ä‘Ã³ cÃ³ thá»ƒ xem: container = images + layer cho phÃ©p ghi. VÃ  khi muá»‘n lÆ°u container nÃ y láº¡i thÃ nh image má»›i, ta dÃ¹ng lá»‡nh docker commit. Image: nhÆ° má»™t áº£nh chá»¥p láº¡i cÃ¡c cáº¥u hÃ¬nh cá»§a container. Má»™t image á»Ÿ tráº¡ng thÃ¡i chá»‰ Ä‘á»c, má»i thá»© thay Ä‘á»•i chá»‰ Ä‘Æ°á»£c thay Ä‘á»•i á»Ÿ táº§ng trÃªn cÃ¹ng (Ä‘Æ°á»£c phÃ©p ghi) cá»§a container. Khi dÃ¹ng lá»‡nh docker commit, táº§ng nÃ y sáº½ trá»Ÿ thÃ nh tráº¡ng thÃ¡i chá»‰ Ä‘á»c. Do Ä‘Ã³, cÃ³ thá»ƒ tháº¥y má»—i image Ä‘á»u phá»¥ thuá»™c vÃ o má»™t hoáº·c nhiá»u image cha. platform Image: NÃ³ lÃ  image, nhÆ°ng nÃ³ khÃ´ng cÃ³ image cha, giá»‘ng nhÆ° bá»™ khung xÆ°Æ¡ng cá»§a má»™t chÃº khá»§ng long. NÃ³ chá»©a cÃ¡c biáº¿n mÃ´i trÆ°á»ng, cÃ¡c tiá»‡n Ã­ch Ä‘á»ƒ á»©ng dá»¥ng áº£o hÃ³a cháº¡y. Registry lÃ  kho chá»©a cÃ¡c image, nÆ¡i chia sáº», táº£i vá» cÃ¡c image. Dockerfile lÃ  má»™t file cáº¥u hÃ¬nh vá»›i cáº¥u trÃºc sinh ra image, nÃ³ giÃºp tá»± Ä‘á»™ng hÃ³a viá»‡c táº¡o, cháº¡y, sá»­ dá»¥ng cÃ¡c container.\náº¢nh trÃªn cho tháº¥y, docker báº¯t Ä‘áº§u vá»›i Platform Image Ä‘á»ƒ chá»©a cÃ¡c biáº¿n mÃ´i trÆ°á»ng cáº§n thiáº¿t Ä‘á»ƒ cháº¡y. Trong quÃ¡ trÃ¬nh container thá»±c thi sáº½ tiáº¿n hÃ nh cÃ i Ä‘áº·t, bá»• sung cáº¥u hÃ¬nh, Layered Images 1, Layered Images 2 lÃ  images cá»§a container sau khi thá»±c hiá»‡n lá»‡nh docker commit vÃ  nÃ³ á»Ÿ tráº¡ng thÃ¡i chá»‰ Ä‘á»c.  docker image history DÃ¹ng Ä‘á»ƒ truy váº¥n thÃ´ng tin lá»‹ch sá»­ cÃ¡c thao tÃ¡c Ä‘á»ƒ hÃ¬nh thÃ nh nÃªn má»™t image. CÃº phÃ¡p:\n1  docker image history image_name   Khi cháº¡y, ta Ä‘Æ°á»£c káº¿t quáº£ nhÆ° sau:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  â¯ docker image history php:8.1.0alpha1-fpm-buster IMAGE CREATED CREATED BY SIZE COMMENT 65167ddfe773 3 days ago /bin/sh -c #(nop) CMD [\u0026#34;php-fpm\u0026#34;] 0B  \u0026lt;missing\u0026gt; 3 days ago /bin/sh -c #(nop) EXPOSE 9000 0B  \u0026lt;missing\u0026gt; 3 days ago /bin/sh -c #(nop) STOPSIGNAL SIGQUIT 0B  \u0026lt;missing\u0026gt; 3 days ago /bin/sh -c set -eux; cd /usr/local/etc; ifâ€¦ 26.6kB \u0026lt;missing\u0026gt; 3 days ago /bin/sh -c #(nop) WORKDIR /var/www/html 0B  \u0026lt;missing\u0026gt; 3 days ago /bin/sh -c #(nop) ENTRYPOINT [\u0026#34;docker-php-eâ€¦ 0B  \u0026lt;missing\u0026gt; 3 days ago /bin/sh -c docker-php-ext-enable sodium 17B \u0026lt;missing\u0026gt; 3 days ago /bin/sh -c #(nop) COPY multi:6dfba8f7e64bd54â€¦ 6.75kB  \u0026lt;missing\u0026gt; 3 days ago /bin/sh -c set -eux; savedAptMark=\u0026#34;$(apt-mâ€¦ 104MB \u0026lt;missing\u0026gt; 3 days ago /bin/sh -c #(nop) COPY file:ce57c04b70896f77â€¦ 587B  \u0026lt;missing\u0026gt; 3 days ago /bin/sh -c set -eux; savedAptMark=\u0026#34;$(apt-mâ€¦ 12.5MB \u0026lt;missing\u0026gt; 3 days ago /bin/sh -c #(nop) ENV PHP_SHA256=131a81ef9eâ€¦ 0B  \u0026lt;missing\u0026gt; 3 days ago /bin/sh -c #(nop) ENV PHP_URL=https://downlâ€¦ 0B  \u0026lt;missing\u0026gt; 3 days ago /bin/sh -c #(nop) ENV PHP_VERSION=8.1.0alphâ€¦ 0B  \u0026lt;missing\u0026gt; 3 days ago /bin/sh -c #(nop) ENV GPG_KEYS=528995BFEDFBâ€¦ 0B  \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c #(nop) ENV PHP_LDFLAGS=-Wl,-O1 -â€¦ 0B  \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c #(nop) ENV PHP_CPPFLAGS=-fstack-â€¦ 0B  \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c #(nop) ENV PHP_CFLAGS=-fstack-prâ€¦ 0B  \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c #(nop) ENV PHP_EXTRA_CONFIGURE_Aâ€¦ 0B  \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c set -eux; mkdir -p \u0026#34;$PHP_INI_DIRâ€¦ 0B \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c #(nop) ENV PHP_INI_DIR=/usr/locaâ€¦ 0B \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c set -eux; apt-get update; apt-gâ€¦ 227MB \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c #(nop) ENV PHPIZE_DEPS=autoconf â€¦ 0B \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c set -eux; { echo \u0026#39;Package: phpâ€¦ 46B \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c #(nop) CMD [\u0026#34;bash\u0026#34;] 0B \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c #(nop) ADD file:7362e0e50f30ff454â€¦ 69.3MB   Qua dá»¯ kiá»‡n trÃªn ta biáº¿t tá»« thao tÃ¡c cÆ¡ sá»Ÿ Ä‘Ã£ tráº£i qua nhá»¯ng bÆ°á»›c nÃ o Ä‘á»ƒ cÃ³ thá»ƒ táº¡o thÃ nh image php\ndocker inspect Lá»‡nh nÃ y tráº£ vá» thÃ´ng tin cá»§a image dÆ°á»›i dáº¡ng JSON\n1  docker inspect image_name/id   Lá»‡nh nÃ y liá»‡t kÃª táº¥t cáº£ cÃ¡c thÃ´ng tin vá» image, vÃ­ dá»¥ sau Ä‘Ã¢y lÃ  má»™t pháº§n thÃ´ng tin vá» cÃ¡c lá»›p layer cá»§a image php\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  \u0026#34;RootFS\u0026#34;: { \u0026#34;Type\u0026#34;: \u0026#34;layers\u0026#34;, \u0026#34;Layers\u0026#34;: [ \u0026#34;sha256:02c055ef67f5904019f43a41ea5f099996d8e7633749b6e606c400526b2c4b33\u0026#34;, \u0026#34;sha256:d2252dfd3726823303a8f54483e10f3ed7959f33ba63ea3a19bd0fc46587bc8f\u0026#34;, \u0026#34;sha256:6c63b3f282cb455ac2e456fb99cdceab42a876603b54cc97087c17b9999b780b\u0026#34;, \u0026#34;sha256:8e859e616115511355eadb05cbdcf86333434621f77c3ac80c410257ea39f115\u0026#34;, \u0026#34;sha256:363c2d4617a0df71a4d53f484a522caa9f2f02ba1271c7f7b4ceb524c5bac61a\u0026#34;, \u0026#34;sha256:c66c7f1f8019ed243ea38cb9ca384135cfeb3cda372de18deece786702c0c582\u0026#34;, \u0026#34;sha256:d87b1d289a070d7d2503bfedb8263ff5431423cd9eca8e577ce93d2e74392315\u0026#34;, \u0026#34;sha256:7d973749b6e2ff44d90f4df11576a27388c317f99400b746e8d8c021a747c91f\u0026#34;, \u0026#34;sha256:d5677f1776e8f36c5ba0cd40ff850a2e1ce919e22019bb76529ce6102c7b89ab\u0026#34;, \u0026#34;sha256:1cce6b181873aeb25ca52478d8f6c6b1c66213689085cc7a89e229ea045abd24\u0026#34; ] },   BÃªn cáº¡nh Ä‘Ã³, lá»‡nh nÃ y cÃ²n cÃ³ thá»ƒ tra cá»©u thÃ´ng tin chi tiáº¿t cá»§a container, chÃºng ta chá»‰ cáº§n thay tÃªn/id cá»§a image thÃ nh tÃªn/id cá»§a container Ä‘á»ƒ tra cá»©u thÃ´ng tin chi tiáº¿t cá»§a container.\ndocker diff NhÆ° Ä‘Ã£ nÃ³i á»Ÿ trÃªn, má»™t container Ä‘Æ°á»£c sinh ra tá»« má»™t platform image, sau khi docker cháº¡y, cÃ i Ä‘áº·t, chá»‰nh sá»­a, thay Ä‘á»•i cáº¥u trÃºc bÃªn trong rá»“i commit láº¡i thÃ nh nhá»¯ng layer. Äá»ƒ xem nhá»¯ng thay Ä‘á»•i cá»§a cáº¥u trÃºc thÆ° má»¥c bÃªn trong tá»« thá»i Ä‘iá»ƒm táº¡o ra Ä‘áº¿n thá»i Ä‘iá»ƒm hiá»‡n táº¡i, ta dÃ¹ng lá»‡nh docker diff. CÃº phÃ¡p:\n1  docker diff container_id/name   VÃ­ dá»¥, ta kiá»ƒm tra tá»« lÃºc táº¡o ra cho Ä‘áº¿n thá»i Ä‘iá»ƒm hiá»‡n táº¡i, cáº¥u trÃºc thÆ° má»¥c bÃªn trong container c-php Ä‘Ã£ thay Ä‘á»•i nhÆ° tháº¿ nÃ o:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  â¯ docker diff c-php C /home A /home/SharedData C /usr C /usr/local C /usr/local/lib C /usr/local/lib/php C /usr/local/lib/php/extensions C /usr/local/lib/php/extensions/no-debug-non-zts-20201009 A /usr/local/lib/php/extensions/no-debug-non-zts-20201009/mysqli.so A /usr/local/lib/php/extensions/no-debug-non-zts-20201009/pdo_mysql.so C /usr/local/etc C /usr/local/etc/php C /usr/local/etc/php/conf.d A /usr/local/etc/php/conf.d/docker-php-ext-mysqli.ini A /usr/local/etc/php/conf.d/docker-php-ext-pdo_mysql.ini C /usr/local/include C /usr/local/include/php C /usr/local/include/php/ext A /usr/local/include/php/ext/mysqli A /usr/local/include/php/ext/mysqli/php_mysqli_structs.h A /usr/local/include/php/ext/mysqli/mysqli_mysqlnd.h   á»Ÿ Ä‘Ã¢y kÃ­ tÆ° C thá»ƒ hiá»‡n ráº±ng thÆ° má»¥c Ä‘Ã³ Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t, cÃ²n A lÃ  thÆ° má»¥c Ä‘Ã³ vá»«a Ä‘Æ°á»£c thÃªm vÃ o.\ndocker log Khi container hoáº¡t Ä‘á»™ng, dáº¥u váº¿t hoáº¡t Ä‘á»™ng cá»§a nÃ³ Ä‘Æ°á»£c ghi vÃ o há»‡ thá»‘ng log cá»§a container. Äá»ƒ kiá»ƒm tra log cá»§a container, chÃºng ta dÃ¹ng lá»‡nh:\n1  docker logs container_name/id   VÃ­ dá»¥ ta kiá»ƒm tra log cá»§a c-php xem trong quÃ¡ trÃ¬nh hoáº¡t Ä‘á»™ng nÃ³ Ä‘Ã£ ghi nhá»¯ng gÃ¬:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39  â¯ docker logs c-php [11-Jun-2021 07:15:23] NOTICE: fpm is running, pid 1 [11-Jun-2021 07:15:23] NOTICE: ready to handle connections 172.23.0.4 - 11/Jun/2021:07:16:07 +0000 \u0026#34;POST /wp-admin/setup-config.php\u0026#34; 500 [11-Jun-2021 07:17:34] NOTICE: Finishing ... [11-Jun-2021 07:17:34] NOTICE: exiting, bye-bye! [11-Jun-2021 07:17:35] NOTICE: fpm is running, pid 1 [11-Jun-2021 07:17:35] NOTICE: ready to handle connections 172.23.0.4 - 11/Jun/2021:07:17:42 +0000 \u0026#34;POST /wp-admin/setup-config.php\u0026#34; 500 172.23.0.4 - 11/Jun/2021:07:17:48 +0000 \u0026#34;POST /wp-admin/setup-config.php\u0026#34; 500 172.23.0.4 - 11/Jun/2021:07:17:53 +0000 \u0026#34;GET /index.php\u0026#34; 302 172.23.0.4 - 11/Jun/2021:07:17:53 +0000 \u0026#34;GET /wp-admin/setup-config.php\u0026#34; 200 172.23.0.4 - 11/Jun/2021:07:17:58 +0000 \u0026#34;GET /wp-admin/setup-config.php\u0026#34; 200 172.23.0.4 - 11/Jun/2021:07:18:19 +0000 \u0026#34;POST /wp-admin/setup-config.php\u0026#34; 500 172.23.0.4 - 11/Jun/2021:07:22:34 +0000 \u0026#34;POST /wp-admin/setup-config.php\u0026#34; 500 172.23.0.4 - 11/Jun/2021:07:22:43 +0000 \u0026#34;GET /index.php\u0026#34; 302 172.23.0.4 - 11/Jun/2021:07:22:43 +0000 \u0026#34;GET /wp-admin/setup-config.php\u0026#34; 200 172.23.0.4 - 11/Jun/2021:07:23:32 +0000 \u0026#34;GET /wp-admin/setup-config.php\u0026#34; 200 172.23.0.4 - 11/Jun/2021:07:24:31 +0000 \u0026#34;POST /wp-admin/setup-config.php\u0026#34; 500 172.23.0.4 - 11/Jun/2021:07:26:46 +0000 \u0026#34;POST /wp-admin/setup-config.php\u0026#34; 500 172.23.0.4 - 11/Jun/2021:07:36:12 +0000 \u0026#34;POST /wp-admin/setup-config.php\u0026#34; 500 172.23.0.4 - 11/Jun/2021:10:39:55 +0000 \u0026#34;GET /index.php\u0026#34; 302 172.23.0.4 - 11/Jun/2021:10:39:55 +0000 \u0026#34;GET /wp-admin/setup-config.php\u0026#34; 200 172.23.0.4 - 11/Jun/2021:10:39:59 +0000 \u0026#34;GET /wp-admin/setup-config.php\u0026#34; 200 172.23.0.4 - 11/Jun/2021:10:40:43 +0000 \u0026#34;POST /wp-admin/setup-config.php\u0026#34; 500 172.23.0.4 - 11/Jun/2021:11:16:52 +0000 \u0026#34;POST /wp-admin/setup-config.php\u0026#34; 500 [11-Jun-2021 11:19:58] NOTICE: Finishing ... [11-Jun-2021 11:19:58] NOTICE: exiting, bye-bye! [11-Jun-2021 11:20:00] NOTICE: fpm is running, pid 1 [11-Jun-2021 11:20:00] NOTICE: ready to handle connections 172.23.0.4 - 11/Jun/2021:11:20:05 +0000 \u0026#34;POST /wp-admin/setup-config.php\u0026#34; 500 172.23.0.4 - 11/Jun/2021:11:20:09 +0000 \u0026#34;GET /index.php\u0026#34; 302 172.23.0.4 - 11/Jun/2021:11:20:09 +0000 \u0026#34;GET /wp-admin/setup-config.php\u0026#34; 200 172.23.0.4 - 11/Jun/2021:11:22:19 +0000 \u0026#34;GET /wp-admin/setup-config.php\u0026#34; 200 172.23.0.4 - 11/Jun/2021:11:22:43 +0000 \u0026#34;POST /wp-admin/setup-config.php\u0026#34; 500 [11-Jun-2021 11:27:42] NOTICE: Finishing ... [11-Jun-2021 11:27:42] NOTICE: exiting, bye-bye! [14-Jun-2021 02:55:15] NOTICE: fpm is running, pid 1 [14-Jun-2021 02:55:15] NOTICE: ready to handle connections   TrÆ°á»ng há»£p log quÃ¡ dÃ i, ta cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh sá»‘ dÃ²ng kiá»ƒm tra báº±ng cÃ¡ch thÃªm option --tail so_dong\n1 2 3 4 5 6 7 8 9 10 11  â¯ docker logs --tail 10 c-php [11-Jun-2021 11:20:00] NOTICE: ready to handle connections 172.23.0.4 - 11/Jun/2021:11:20:05 +0000 \u0026#34;POST /wp-admin/setup-config.php\u0026#34; 500 172.23.0.4 - 11/Jun/2021:11:20:09 +0000 \u0026#34;GET /index.php\u0026#34; 302 172.23.0.4 - 11/Jun/2021:11:20:09 +0000 \u0026#34;GET /wp-admin/setup-config.php\u0026#34; 200 172.23.0.4 - 11/Jun/2021:11:22:19 +0000 \u0026#34;GET /wp-admin/setup-config.php\u0026#34; 200 172.23.0.4 - 11/Jun/2021:11:22:43 +0000 \u0026#34;POST /wp-admin/setup-config.php\u0026#34; 500 [11-Jun-2021 11:27:42] NOTICE: Finishing ... [11-Jun-2021 11:27:42] NOTICE: exiting, bye-bye! [14-Jun-2021 02:55:15] NOTICE: fpm is running, pid 1 [14-Jun-2021 02:55:15] NOTICE: ready to handle connections   Äá»ƒ kiá»ƒm tra log theo thá»i gian thá»±c khi docker Ä‘ang cháº¡y, ta thÃªm tÃ¹y chá»n -f vÃ o:\n1  docker logs -f container_name/id   docker stats Khi container Ä‘ang cháº¡y, nÃ³ cÃ³ sá»­ dá»¥ng cÃ¡c tÃ i nguyÃªn cá»§a há»‡ thá»‘ng, Ä‘á»ƒ giÃ¡m sÃ¡t má»©c Ä‘á»™ sá»­ dá»¥ng tÃ i nguyÃªn, ta sá»­ dá»¥ng cÃº phÃ¡p:\n1  docker stats container_name/id   khi dÃ¹ng\n1  docker stats   máº·c Ä‘á»‹nh, nÃ³ sáº½ giÃ¡m sÃ¡t toÃ n bá»™ container Ä‘ang cháº¡y trÃªn há»‡ thá»‘ng\nProcess docker top 1  docker top docker_name/id   DÃ¹ng Ä‘á»ƒ xem thÃ´ng tin vá» tiáº¿n trÃ¬nh (process) cá»§a docker, bao gá»“m PID (process Id) vÃ  PPID (Parent Process Id).\nChÃºng ta cÃ²n cÃ³ thá»ƒ xem thÃ´ng tin vá» cÃ¡c tiáº¿n trÃ¬nh á»Ÿ dáº¡ng cÃ¢y:\n1  pstree -c -p -A $(pgrep dockerd)   ","description":"Tra cá»©u thÃ´ng tin Image, Container vÃ  giÃ¡m sÃ¡t hoáº¡t Ä‘á»™ng container Docker","id":1,"section":"posts","tags":["Docker"],"title":"TÃ¬m hiá»ƒu vÃ  sá»­ dá»¥ng docker (P5)","uri":"https://minhlongmt183.github.io/posts/docker_p5/"},{"content":"ToÃ n bá»™ series nÃ y Ä‘Æ°á»£c tham kháº£o tá»« hai nguá»“n chÃ­nh: XuanThuLabChanel vÃ  DockerDoc. Em xin chÃ¢n thÃ nh cáº£m Æ¡n sá»± cá»‘ng hiáº¿n cá»§a cÃ¡c tÃ¡c giáº£ cá»§a nhá»¯ng kÃªnh nÃ³i trÃªn.â¤ï¸â¤ï¸â¤ï¸  CÃ i Ä‘áº·t, táº¡o vÃ  cháº¡y PHP, phiÃªn báº£n cÃ³ PHP-FPM báº±ng Docker pull phiÃªn báº£n image php-fpm tá»« docker hub ChÃºng ta táº£i báº£n 7.3-fpm tá»« docker hub. fpm á»Ÿ Ä‘Ã¢y cÃ³ nghÄ©a lÃ  trong gÃ³i nÃ y, cÃ³ thÃªm dá»‹ch vá»¥ php-fpm. Dá»‹ch vá»¥ nÃ y láº¯ng nghe vÃ  táº¡o ra nhiá»u tiáº¿n trÃ¬nh php trÃªn cá»•ng 9000 chá» cÃ¡c webserver nhÆ° http, nginx káº¿t ná»‘i vÃ o.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  â¯ docker pull php:7.3-fpm 7.3-fpm: Pulling from library/php 69692152171a: Pull complete 2040822db325: Pull complete 9b4ca5ae9dfa: Pull complete ac1fe7c6d966: Pull complete c342d9e76a3c: Pull complete 6ead8e46ae7b: Pull complete 5c98df0d7626: Pull complete dd302d19deb7: Pull complete 7701b71427d2: Pull complete 672353cf3439: Pull complete b379e47d0c20: Pull complete Digest: sha256:d38892103d2f76e3245a080875718d74414d6d7a57cfe7000a91f4aa668f870b Status: Downloaded newer image for php:7.3-fpm â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE newimage version2 a8e04dcf8737 2 days ago 170MB busybox latest 69593048aa3a 2 days ago 1.24MB php 7.3-fpm 2692864592ed 4 weeks ago 399MB ubuntu latest 7e0aa2d69a15 6 weeks ago 72.7MB centos latest 300e315adb2f 6 months ago 209MB   Táº¡o máº¡ng bridge Äáº§u tiÃªn chÃºng ta táº¡o má»™t bride network cÃ³ tÃªn lÃ  www-net\n1 2 3 4 5 6 7 8  â¯ docker network create --driver bridge www-net 4d9c8d81da85fd9118cea666265aab88ae6ab71ac1d53a2dd81b168d87c9d290 â¯ docker network ls NETWORK ID NAME DRIVER SCOPE 286d5161c9f6 bridge bridge local 0f2ab02aa9f4 host host local 271997adaaa9 none null local 4d9c8d81da85 www-net bridge local   Táº¡o thÆ° má»¥c chia sáº» dá»¯ liá»‡u giá»¯a mÃ¡y host vÃ  container TrÃªn mÃ¡y host, ta xÃ¢y dá»±ng má»™t cÃ¢y thÆ° má»¥c Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u chia sáº» vá»›i container nhÆ° sau:\n1 2 3 4 5 6 7  . â”œâ”€â”€ docker â”‚Â â””â”€â”€ data â”‚Â â”œâ”€â”€ c1.txt â”‚Â â”œâ”€â”€ data_container2.txt â”‚Â â”œâ”€â”€ d.txt â”‚Â â””â”€â”€ www   Vá» kiáº¿n thá»©c liÃªn quan vá» chia sáº» dá»¯ liá»‡u giá»¯a mÃ¡y host vÃ  container, báº¡n cÃ³ thá»ƒ xem kÄ© hÆ¡n á»Ÿ pháº§n 2\nCháº¡y container php-fpm ChÃºng ta táº¡o má»™t container cÃ³ tÃªn lÃ  c-php\n1 2 3 4 5  â¯ docker run -d --name c-php -v /home/edisc/Desktop/docker/data:/home/SharedData --network www-net php:7.3-fpm 2894c033c93f5e4f2b02198afbb94cc9b5e62467b2e4c1291a7c2444f30659a7 â¯ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 2894c033c93f php:7.3-fpm \u0026#34;docker-php-entrypoiâ€¦\u0026#34; 2 minutes ago Up 2 minutes 9000/tcp c-php   á» Ä‘Ã¢y, vÃ¬ sau khi táº¡o chÃºng ta khÃ´ng muá»‘n vÃ o trá»±c tiá»‡p docker nÃªn khÃ´ng dÃ¹ng tÃ¹y chá»n -it, tuy nhiÃªn thÃªm lá»‡nh -d Ä‘á»ƒ sau khi táº¡o docker tiáº¿p tá»¥c cháº¡y ná»n. á» Ä‘Ã¢y, tÃ´i dÃ¹ng linux nÃªn quÃ¡ trÃ¬nh diá»…n ra khÃ¡ thuáº­n lá»£i, nhÆ°ng theo tÃ¡c giáº£ thÃ¬ náº¿u báº¡n dÃ¹ng Windows hay MacOs thÃ¬ cáº§n pháº£i thiáº¿t láº­p thÆ° má»¥c á»Ÿ cháº¿ Ä‘á»™ share vá»›i docker thÃ¬ má»›i cÃ³ thá»ƒ táº¡o Ä‘Æ°á»£c. Chi tiáº¿t báº¡n cÃ³ thá»ƒ vÃ o kÃªnh cá»§a anh XuanThuLabChanel Ä‘á»ƒ xem rÃµ hÆ¡n. BÃªn cáº¡nh Ä‘Ã³, ta cÅ©ng tháº¥y container má»›i Ä‘Æ°á»£c táº¡o nÃ y cháº¡y Ä‘ang cháº¡y lá»‡nh \u0026ldquo;docker-php-entrypoiâ€¦\u0026rdquo;, báº£n cháº¥t lá»‡nh nÃ y dÃ¹ng Ä‘á»ƒ gá»i dá»‹ch vá»¥ php-fpm Ä‘á»ƒ cháº¡y vÃ  láº¯ng nghe á»Ÿ cá»•ng 9000.\nKiá»ƒm tra php ChÃºng ta vÃ o container vá»«a má»›i táº¡o, Ã´n láº¡i kiáº¿n thá»©c cÅ©, thay vÃ¬ vÃ o container báº±ng lá»‡nh docker attach ta cÃ²n cÃ³ má»™t cÃ¡ch khÃ¡c Ä‘Ã³ lÃ  thá»±c thi cÃ¢u lá»‡nh bash trong container tá»« host thÃ´ng qua docker exec\n1 2  â¯ docker exec -it c-php bash root@2894c033c93f:/var/www/html#   Ta vÃ o thÆ° má»¥c chia sáº» /home/SharedData/ Ä‘á»ƒ kiá»ƒm tra dá»¯ liá»‡u trÃªn thÆ° má»¥c\n1 2 3 4  root@2894c033c93f:/var/www/html# cd /home/SharedData/ root@2894c033c93f:/home/SharedData# ls c1.txt\td.txt data_container2.txt www root@2894c033c93f:/home/SharedData#   TrÃªn mÃ¡y host, ta táº¡o file test.php trong thÆ° má»¥c www vÃ  dá»… tháº¥y nÃ³ cÅ©ng hiá»‡n á»Ÿ trong container.\nTiáº¿n hÃ nh cháº¡y lá»‡nh file test.php:\nTa Ä‘Ã£ cháº¡y Ä‘Æ°á»£c php, php trÃªn container lÃ  phiÃªn báº£n PHP 7.3.28\n1 2 3 4  root@2894c033c93f:/home/SharedData/www# php --version PHP 7.3.28 (cli) (built: May 12 2021 13:46:47) ( NTS ) Copyright (c) 1997-2018 The PHP Group Zend Engine v3.3.28, Copyright (c) 1998-2018 Zend Technologies   CÃ i Ä‘áº·t, cháº¡y Apache HTTPD báº±ng Docker Táº£i image Apache httpd ChÃºng ta Ä‘Ã£ cÃ i conatiner c-php, tiáº¿p theo cÃ i mÃ¡y chá»§ httpd. ChÃºng ta táº£i image httpd phiÃªn báº£n má»›i nháº¥t vá» vá»›i cÃ¢u lá»‡nh quen thuá»™c:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  â¯ docker pull httpd Using default tag: latest latest: Pulling from library/httpd 69692152171a: Already exists 7284b4e0cc7b: Pull complete 3678b2d55ccd: Pull complete aeb67982a725: Pull complete 06954f8169fd: Pull complete Digest: sha256:48bae0ac5d0d75168f1c1282c0eb21b43302cb1b5c5dc9fa3b4a758ccfb36fe9 Status: Downloaded newer image for httpd:latest â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE newimage version2 a8e04dcf8737 2 days ago 170MB busybox latest 69593048aa3a 2 days ago 1.24MB httpd latest 39c2d1c93266 2 weeks ago 138MB php 7.3-fpm 2692864592ed 4 weeks ago 399MB ubuntu latest 7e0aa2d69a15 6 weeks ago 72.7MB centos latest 300e315adb2f 6 months ago 209MB   Láº¥y cáº¥u hÃ¬nh httpd.conf Khi htppd cháº¡y, nÃ³ sáº½ náº¡p file cáº¥u hÃ¬nh trong Ä‘Æ°á»ng dáº«n á»Ÿ container: /usr/local/apache2/conf/httpd.conf. Do Ä‘Ã³, Ä‘Ã¢y cÅ©ng lÃ  nÆ¡i Ä‘á»ƒ chÃºng ta muá»‘n cáº¥u hÃ¬nh tÃ¹y chá»‰nh theo Ã½ muá»‘n cá»§a mÃ¬nh.\nÄáº§u tiÃªn, ta sáº½ cháº¡y táº¡m thá»i container httpd Ä‘á»ƒ trÃ­ch xuáº¥t file cáº¥u hÃ¬nh httpd.conf ra mÃ¡y host trÆ°á»›c.\n1  â¯ docker run --rm -v /home/edisc/Desktop/docker/data:/home/SharedData httpd cp /usr/local/apache2/conf/httpd.conf /home/SharedData/   VÃ¬ chÃºng ta cháº¡y container nÃ y má»™t láº§n Ä‘á»ƒ trÃ­ch xuáº¥t file httpd.conf nÃªn ta thÃªm tÃ¹y chá»n --rm Ä‘á»ƒ docker sáº½ tá»± Ä‘á»™ng xÃ³a sau khi cháº¡y, bÃªn cáº¡nh Ä‘Ã³, khi cháº¡y container ta cÅ©ng thá»±c hiá»‡n luÃ´n cÃ¢u lá»‡nh copy file httpd.conf Ä‘áº¿n thÆ° má»¥c chia sáº» dá»¯ liá»‡u cá»§a mÃ¬nh. Sau khi cháº¡y lá»‡nh trÃªn, chÃºng ta Ä‘Ã£ cÃ³ file httpd.conf trÃªn thÆ° má»¥c data á»Ÿ host.\n1 2  â¯ ls c1.txt data_container2.txt d.txt httpd.conf www   Cáº¥u hÃ¬nh httpd.conf Sau khi cÃ³ Ä‘Æ°á»£c file httpd.conf, ta má»Ÿ ra vÃ  tiáº¿n hÃ nh cáº¥u hÃ¬nh.\nMÃ¡y chá»§ apache Ä‘Æ°á»£c táº¡o ra sáº½ táº¡o nhá»¯ng file php thÃ´ng qua proxy, tá»©c lÃ  khi ta truy váº¥n Ä‘áº¿n nhá»¯ng file cÃ³ pháº§n má»Ÿ rá»™ng lÃ  .php apache sáº½ yÃªu cáº§u server cháº¡y php-fpm Ä‘á»ƒ thi hÃ nh file php Ä‘Ã³. Äá»ƒ sá»­ dá»¥ng proxy cho apache, ta cáº§n pháº£i náº¡p cÃ¡c module vá» proxy cá»¥ thá»ƒ :\nBáº­t má»™t sá»‘ module sau trong file httpd.conf:  module mod_proxy.so vÃ  mod_proxy_fcgi.so\n  ThÃªm AddHandler ThÃªm AddHandler Ä‘á»ƒ chá»‰ thá»‹ apache cháº¡y php thÃ´ng qua proxy. Ta thÃªm dÃ²ng lá»‡nh sau vÃ o cuá»‘i file:\n1  AddHandler \u0026#34;proxy:fcgi://ip:9000\u0026#34; .php   trÆ°á»ng há»£p nÃ y, ta truy váº¥n Ä‘á»ƒ container c-php nÃªn á»Ÿ ip ta thay thÃ nh c-php vÃ  cá»•ng váº«n lÃ  9000\nThiáº¿t láº­p thÆ° má»¥c máº·c Ä‘á»‹nh cá»§a apache Äá»ƒ thiáº¿t láº­p thÆ° má»¥c máº·c Ä‘á»‹nh khi chÃºng ta share, chÃºng ta sáº½ thay Ä‘á»•i á»Ÿ\n1 2  DocumentRoot \u0026#34;/usr/local/apache2/htdocs\u0026#34; \u0026lt;Directory \u0026#34;/usr/local/apache2/htdocs\u0026#34;\u0026gt;   Thay Ä‘á»•i thÃ nh thÆ° má»¥c mÃ  chÃºng ta muá»‘n mount vÃ o.\nCháº¡y mÃ¡y chá»§ Http Apache Ta cháº¡y cÃ¢u lá»‡nh:\n1  docker run --network www-net --name c-httpd -h httpd -p 9999:80 -p 443:443 -v /home/edisc/Desktop/docker/data:/home/SharedData -v /home/edisc/Desktop/docker/data/httpd.conf:/usr/local/apache2/conf/httpd.conf httpd   á» Ä‘Ã¢y:\n Ta cháº¡y má»™t container cÃ³ tÃªn lÃ  c-httpd vá»›i hostname lÃ  httpd káº¿t ná»‘i máº¡ng www-net. Ãnh xáº¡ cá»•ng 80, 443 cá»§a container láº§n lÆ°á»£t lÃªn cá»•ng 9999, 443 cá»§a mÃ¡y host. ThÆ° má»¥c chia sáº» dá»¯ liá»‡u /home/edisc/Desktop/docker/data trÃªn mÃ¡y host Ä‘Æ°á»£c Ã¡nh xáº¡ lÃªn /home/SharedData trÃªn container, vÃ  file cáº¥u hÃ¬nh httpd.conf cÅ©ng Ä‘Æ°á»£c Ã¡nh xáº¡ vÃ o /usr/local/apache2/conf/httpd.conf.\ná» Ä‘Ã¢y lÆ°u Ã½, kháº£ nÄƒng chÃºng ta sáº½ bá»‹ lá»—i  1 2  docker: Error response from daemon: driver failed programming external connectivity on endpoint c-httpd (e0fa76873fc8a5b1b73a0e9589774a25d7a7c377a777d3af6c5313bf7c44adc7): Error starting userland proxy: listen tcp 0.0.0.0:443: bind: address already in use. ERRO[0000] error waiting for container: context canceled   Tá»©c lÃ  cá»•ng mÃ  chÃºng ta Ã¡nh xáº¡ trÃªn mÃ¡y host Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi má»™t tiáº¿n trÃ¬nh nÃ o Ä‘Ã³. LÃºc bÃ¢y giá» cÃ³ 2 cÃ¡ch giáº£i quyáº¿t:\n Chá»n cá»•ng khÃ¡c trÃªn mÃ¡y host TÃ¬m cÃ¡c á»©ng dá»¥ng sá»­ dá»¥ng cá»•ng nÃ y rá»“i kill nÃ³ Ä‘i. Äá»ƒ tÃ¬m cÃ¡c cá»•ng sá»­ dá»¥ng ta dÃ¹ng lá»‡nh sudo netstat -pna | grep 443 vá»›i 443 lÃ  port mÃ¬nh cáº§n tÃ¬m.\nTa Ä‘Æ°á»£c káº¿t quáº£.  1 2 3 4 5 6 7  â¯ docker run --network www-net --name c-httpd -h httpd -p 9999:80 -p 443:443 -v /home/edisc/Desktop/docker/data:/home/SharedData -v /home/edisc/Desktop/docker/data/httpd.conf:/usr/local/apache2/conf/httpd.conf httpd [Thu Jun 10 08:10:54.751670 2021] [proxy_html:notice] [pid 1:tid 139955972379776] AH01425: I18n support in mod_proxy_html requires mod_xml2enc. Without it, non-ASCII characters in proxied pages are likely to display incorrectly. AH00558: httpd: Could not reliably determine the server\u0026#39;s fully qualified domain name, using 172.23.0.2. Set the \u0026#39;ServerName\u0026#39; directive globally to suppress this message [Thu Jun 10 08:10:54.767249 2021] [proxy_html:notice] [pid 1:tid 139955972379776] AH01425: I18n support in mod_proxy_html requires mod_xml2enc. Without it, non-ASCII characters in proxied pages are likely to display incorrectly. AH00558: httpd: Could not reliably determine the server\u0026#39;s fully qualified domain name, using 172.23.0.2. Set the \u0026#39;ServerName\u0026#39; directive globally to suppress this message [Thu Jun 10 08:10:54.771929 2021] [mpm_event:notice] [pid 1:tid 139955972379776] AH00489: Apache/2.4.48 (Unix) configured -- resuming normal operations [Thu Jun 10 08:10:54.772004 2021] [core:notice] [pid 1:tid 139955972379776] AH00094: Command line: \u0026#39;httpd -D FOREGROUND\u0026#39;   Kiá»ƒm tra apache NhÆ° váº­y á»Ÿ bÆ°á»›c trÃªn mÃ¡y chá»§ apache cá»§a chÃºng ta Ä‘Ã£ cháº¡y. Äá»ƒ kiá»ƒm tra, ta tiáº¿n hÃ nh má»Ÿ trÃ¬nh duyá»‡t 127.0.0.1:9999 hoáº·c localhost:9999\nNhÆ° váº­y, mÃ¡y chá»§ apache Ä‘Ã£ hoáº¡t Ä‘á»™ng hiá»‡u quáº£. ChÃºng ta gá»i file php Ä‘á»ƒ xem proxy cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng\nNhÆ° váº­y, proxy Ä‘Ã£ gá»i Ä‘Æ°á»£c test.php.\nCÃ i Ä‘áº·t, cháº¡y MySQL báº±ng Docker Trong 2 pháº§n trÆ°á»›c, chÃºng ta Ä‘Ã£ táº¡o Ä‘Æ°á»£c 2 container, má»™t container cháº¡y php vÃ  má»™t container cháº¡y server apache httpd. Pháº§n nÃ y chÃºng ta sáº½ tiáº¿n hÃ nh cÃ i Ä‘áº·t vÃ  cháº¡y MySQL báº±ng Docker.\nThiáº¿t láº­p biáº¿n mÃ´i trÆ°á»ng cho container Docker cho phÃ©p chÃºng ta thiáº¿t láº­p cÃ¡c biáº¿n mÃ´i trÆ°á»ng cho container thÃ´ng qua tÃ¹y chá»n -e. VÃ­ dá»¥, ta cháº¡y má»™t container tá»« image busybox, trong Ä‘Ã³, thiáº¿t láº­p cÃ¡c biáº¿n mÃ´i trÆ°á»ng cho container:\n1 2 3 4 5 6  â¯ docker run -it --rm -e BIEN1=VALUE1 -e BIEN2=\u0026#34;VALUE2\u0026#34; busybox / # echo $BIEN1 VALUE1 / # echo $BIEN2 VALUE2 / #    ÄÃ¢y lÃ  cÃ¡ch thá»©c nhiá»u image Ä‘Ã³ng gÃ³i vÃ  thiáº¿t láº­p biáº¿n mÃ´i trÆ°á»ng giÃºp chÃºng ta thiáº¿t láº­p cÃ¡c container khi cháº¡y.\nTáº£i vá» phiÃªn báº£n mysql ChÃºng ta táº£i phiÃªn báº£n má»›i nhÃ¢t cá»§a mysql báº±ng lá»‡nh docker pull\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  â¯ docker pull mysql Using default tag: latest latest: Pulling from library/mysql 69692152171a: Already exists 1651b0be3df3: Pull complete 951da7386bc8: Pull complete 0f86c95aa242: Pull complete 37ba2d8bd4fe: Pull complete 6d278bb05e94: Pull complete 497efbd93a3e: Pull complete f7fddf10c2c2: Pull complete 16415d159dfb: Pull complete 0e530ffc6b73: Pull complete b0a4a1a77178: Pull complete cd90f92aa9ef: Pull complete Digest: sha256:d50098d7fcb25b1fcb24e2d3247cae3fc55815d64fec640dc395840f8fa80969 Status: Downloaded newer image for mysql:latest â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE newimage version2 a8e04dcf8737 2 days ago 170MB busybox latest 69593048aa3a 2 days ago 1.24MB httpd latest 39c2d1c93266 2 weeks ago 138MB php 7.3-fpm 2692864592ed 4 weeks ago 399MB mysql latest c0cdc95609f1 4 weeks ago 556MB ubuntu latest 7e0aa2d69a15 6 weeks ago 72.7MB centos latest 300e315adb2f 6 months ago 209MB   Má»™t sá»‘ thÃ´ng tin chÃ­nh cáº§n chÃº Ã½ trÆ°á»›c khi báº¯t Ä‘áº§u lÃ m viá»‡c vá»›i mysql:\n port: 3384 MYSQL 8.0 cÃ³ thá»ƒ cÃ³ má»™t sá»‘ mÃ¡y cÅ© khÃ´ng há»— trá»£, cÃ³ thá»ƒ cáº§n cáº¥u hÃ¬nh Ä‘á»ƒ há»‡ thá»‘ng cÅ© cÃ³ thá»ƒ login vÃ o mysql nÃ y. khi Ä‘Ã³ ta thÃªm vÃ o file config ná»™i dung sau:  [mysqld] default-authentication-plugin=mysql_native_password  file config: /etc/mysql/my.cnf cá»§a container Biáº¿n mÃ´i trÆ°á»ng:  TÃ i khoáº£n root:MYSQL_ROOT_PASSWORD database: /var/lib/mysql    Láº¥y file cáº¥u hÃ¬nh my.cnf ChÃºng ta cháº¡y file mysql vÃ  trÃ­ch xuáº¥t file my.cnf ra.\n1 2 3  â¯ docker run --rm -v /home/edisc/Desktop/docker/data:/home/SharedData mysql cp /etc/mysql/my.cnf /home/SharedData/ â¯ ls c1.txt data_container2.txt d.txt httpd.conf my.cnf www   Cáº¥u hÃ¬nh file my.cnf  Ta thÃªm dÃ²ng lá»‡nh  1  default-authentication-plugin=mysql_native_password   vÃ o cuá»‘i file my.cnf\n Táº¡o thÃªm thÆ° má»¥c db trong folder /home/edisc/Desktop/docker/data Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u, Ä‘á»“ng thá»i khi xÃ³a container Ä‘i thÃ¬ csdl cá»§a nÃ³ cÅ©ng khÃ´ng bá»‹ máº¥t Ä‘i.  Táº¡o container mysql ChÃºng ta táº¡o docker Ä‘á»ƒ cháº¡y mysql, trong Ä‘Ã³:\n Thiáº¿t láº­p biáº¿n mÃ´i trÆ°á»ng Ä‘á»ƒ lÆ°u máº­t kháº©u cho tÃ i khoáº£n root, máº­t kháº©u ta chá»n lÃ  docker123:\n-e MYSQL_ROOT_PASSWORD=docker123, Ãnh xáº¡ file cáº¥u hÃ¬nh my.cnf lÃªn thá»±c má»¥c cáº¥u hÃ¬nh trÃªn container:\n-v /home/edisc/Desktop/docker/data/my.cnf:/etc/mysql/my.cnf, Ãnh xáº¡ thÆ° má»¥c db trÃªn host lÃªn thÆ° má»¥c lÆ°u trá»¯ databse máº·c Ä‘á»‹nh cá»§a container:\n-v /home/edisc/Desktop/docker/data/db:/var/lib/mysql TÃªn lÃ  c-mysql: --name c-mysql  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  â¯ docker run -e MYSQL_ROOT_PASSWORD=docker123 -v /home/edisc/Desktop/docker/data/my.cnf:/etc/mysql/my.cnf -v /home/edisc/Desktop/docker/data/db:/var/lib/mysql --name c-mysql mysql 2021-06-10 09:02:24+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.25-1debian10 started. 2021-06-10 09:02:25+00:00 [Note] [Entrypoint]: Switching to dedicated user \u0026#39;mysql\u0026#39; 2021-06-10 09:02:25+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.25-1debian10 started. 2021-06-10 09:02:25+00:00 [Note] [Entrypoint]: Initializing database files 2021-06-10T09:02:25.233559Z 0 [System] [MY-013169] [Server] /usr/sbin/mysqld (mysqld 8.0.25) initializing of server in progress as process 43 2021-06-10T09:02:25.244471Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started. 2021-06-10T09:02:26.680645Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended. 2021-06-10T09:02:29.942913Z 6 [Warning] [MY-010453] [Server] root@localhost is created with an empty password ! Please consider switching off the --initialize-insecure option. 2021-06-10 09:02:38+00:00 [Note] [Entrypoint]: Database files initialized 2021-06-10 09:02:38+00:00 [Note] [Entrypoint]: Starting temporary server 2021-06-10T09:02:39.196368Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.0.25) starting as process 88 2021-06-10T09:02:39.243106Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started. 2021-06-10T09:02:39.910377Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended. 2021-06-10T09:02:40.126089Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Socket: /var/run/mysqld/mysqlx.sock 2021-06-10T09:02:40.376702Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed. 2021-06-10T09:02:40.377098Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel. ...   ChÃºng ta khÃ´ng thiáº¿t láº­p tham sá»‘ Ã¡nh xáº¡ cá»•ng vÃ¬ á»Ÿ Ä‘Ã¢y chÆ°a cÃ³ nhu cáº§u truy cáº­p tá»« bÃªn ngoÃ i vÃ o csdl c-mysql mÃ  csdl nÃ y chá»‰ Ä‘á»ƒ cho c-php vÃ  c-httpd truy cáº­p thÃ´ng qua cá»•ng 3306. Trong thá»±c táº¿, chÃºng ta muá»‘n truy cáº­p tá»« xa, Ä‘á»ƒ cÃ¡c server káº¿t ná»‘i vá»›i nhau, ta cáº§n Ã¡nh xáº¡ cá»•ng 3306 nÃ y tá»›i mÃ¡y host.\nThi hÃ nh má»™t sá»‘ lá»‡nh trong container c-mysql Äáº¿n Ä‘Ã¢y, chÃºng ta Ä‘Ã£ thiáº¿t láº­p Ä‘Æ°á»£c má»™t container cháº¡y mysql, tiáº¿p theo chÃºng ta vÃ o container trÃªn Ä‘á»ƒ cháº¡y má»™t sá»‘ cÃ¢u lá»‡nh Ä‘á»ƒ kiá»ƒm tra.\nVÃ o container c-mysql Äáº§u tiÃªn, vÃ o container c-mysql báº±ng lá»‡nh docker exec:\n1 2 3 4 5 6 7  â¯ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 10c415b14dbe mysql \u0026#34;docker-entrypoint.sâ€¦\u0026#34; 5 minutes ago Up 5 minutes 3306/tcp, 33060/tcp c-mysql 7e8910d1b55c php:7.3-fpm \u0026#34;docker-php-entrypoiâ€¦\u0026#34; 43 minutes ago Up 43 minutes 9000/tcp c-php a9d05fe2fc94 httpd \u0026#34;httpd-foreground\u0026#34; About an hour ago Up 34 minutes 0.0.0.0:443-\u0026gt;443/tcp, 0.0.0.0:9999-\u0026gt;80/tcp c-httpd â¯ docker exec -it c-mysql bash root@10c415b14dbe:/#   Káº¿t ná»‘i vá»›i mysql mysql cá»§a chÃºng ta cÃ³ username lÃ  root vÃ  cÃ³ password lÃ  docker123 (thiáº¿t láº­p á»Ÿ trÃªn). Tham sá»‘ -pdocker123 giÃºp chÃºng ta khÃ´ng cáº§n pháº£i nháº­p láº¡i password.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  root@10c415b14dbe:/# mysql -u root -pdocker123 mysql: [Warning] Using a password on the command line interface can be insecure. Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 8 Server version: 8.0.25 MySQL Community Server - GPL Copyright (c) 2000, 2021, Oracle and/or its affiliates. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. mysql\u0026gt;   NhÆ° váº­y chÃºng ta Ä‘Ã£ káº¿t ná»‘i Ä‘Æ°á»£c mysql vÃ  vÃ o bÃªn trong cá»§a sql-server.\nKiá»ƒm tra cÃ³ nhá»¯ng database nÃ o trong mysql 1 2 3 4 5 6 7 8 9 10 11  mysql\u0026gt; show databases; +--------------------+ | Database | +--------------------+ | information_schema | | mysql | | performance_schema | | sys | +--------------------+ 4 rows in set (0.00 sec) mysql\u0026gt;   Sá»­ dá»¥ng database mysql 1 2 3 4 5 6  mysql\u0026gt; use mysql; Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql\u0026gt;   Show table 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43  mysql\u0026gt; show tables; +------------------------------------------------------+ | Tables_in_mysql | +------------------------------------------------------+ | columns_priv | | component | | db | | default_roles | | engine_cost | | func | | general_log | | global_grants | | gtid_executed | | help_category | | help_keyword | | help_relation | | help_topic | | innodb_index_stats | | innodb_table_stats | | password_history | | plugin | | procs_priv | | proxies_priv | | replication_asynchronous_connection_failover | | replication_asynchronous_connection_failover_managed | | role_edges | | server_cost | | servers | | slave_master_info | | slave_relay_log_info | | slave_worker_info | | slow_log | | tables_priv | | time_zone | | time_zone_leap_second | | time_zone_name | | time_zone_transition | | time_zone_transition_type | | user | +------------------------------------------------------+ 35 rows in set (0.00 sec) mysql\u0026gt;   Táº¡o dá»¯ liá»‡u 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31  mysql\u0026gt; CREATE USER \u0026#39;testuser\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED BY \u0026#39;testpass\u0026#39;; Query OK, 0 rows affected (0.03 sec) mysql\u0026gt; create database db_test; Query OK, 1 row affected (0.02 sec) mysql\u0026gt; show databases; +--------------------+ | Database | +--------------------+ | db_test | | information_schema | | mysql | | performance_schema | | sys | +--------------------+ 5 rows in set (0.00 sec) mysql\u0026gt; select User from user; +------------------+ | User | +------------------+ | root | | testuser | | mysql.infoschema | | mysql.session | | mysql.sys | | root | +------------------+ 6 rows in set (0.00 sec)   NhÆ° váº­y ta cÃ³ cÃ¡c user lÃ : root vÃ  testuser. Vá»›i testuser cÃ³ password lÃ  testpass.\nKáº¿t luáº­n Trong bÃ i há»c nÃ y, chÃºng ta Ä‘Ã£ há»c Ä‘Æ°á»£c tá»« anh XuanThuLabChanel cÃ¡ch cáº¥u hÃ¬nh ra 3 container cháº¡y 3 dá»‹ch vá»¥ khÃ¡c nhau: mysql, php, mÃ¡y chá»§ web apache httpd. trong Ä‘Ã³ mÃ¡y chá»§ web truy cáº­p Ä‘Æ°á»£c cá»•ng 9999 trÃªn host. Trong bÃ i tiáº¿p theo, chÃºng ta sáº½ cÃ i Ä‘áº·t wordpress vÃ o há»‡ thá»‘ng nÃ y.\n","description":"Pháº§n nÃ y chÃºng ta sáº½ há»c vá» : cÃ i Ä‘áº·t vÃ  cáº¥u hÃ¬nh má»™t há»‡ thá»‘ng trÃªn docker gá»“m  3 container cháº¡y 3 dá»‹ch vá»¥ khÃ¡c nhau: mysql, php, mÃ¡y chá»§ web apache httpd. trong Ä‘Ã³ mÃ¡y chá»§ web truy cáº­p Ä‘Æ°á»£c cá»•ng 9999 trÃªn host","id":2,"section":"posts","tags":["Docker"],"title":"TÃ¬m hiá»ƒu vÃ  sá»­ dá»¥ng docker (P4)","uri":"https://minhlongmt183.github.io/posts/docker_p4/"},{"content":"ToÃ n bá»™ series nÃ y Ä‘Æ°á»£c tham kháº£o tá»« hai nguá»“n chÃ­nh: XuanThuLabChanel vÃ  DockerDoc. Em xin chÃ¢n thÃ nh cáº£m Æ¡n sá»± cá»‘ng hiáº¿n cá»§a cÃ¡c tÃ¡c giáº£ cá»§a nhá»¯ng kÃªnh nÃ³i trÃªn.â¤ï¸â¤ï¸â¤ï¸  Giá»›i thiá»‡u vá» Image Busybox Busybox lÃ  má»™t image ráº¥t nhá» gá»n nhÆ°ng chá»©a ráº¥t nhiá»u cÃ´ng cá»¥ dá»±a trÃªn ná»n táº£ng linux.\nTáº£i image busybox:\n1 2 3 4 5 6  â¯ docker pull busybox Using default tag: latest latest: Pulling from library/busybox b71f96345d44: Pull complete Digest: sha256:930490f97e5b921535c153e0e7110d251134cc4b72bbb8133c6a5065cc68580d Status: Downloaded newer image for busybox:latest   Táº¡o má»™t container cháº¡y image busybox\n1 2  â¯ docker run -it --rm busybox / #    Option --rm dÃ¹ng cho nhá»¯ng container muá»‘n cháº¡y má»™t láº§n, sau khi cháº¡y xong docker sáº½ tá»± Ä‘á»™ng xÃ³a container Ä‘Ã³ Ä‘i.\nContainer cá»§a image busybox cÃ³ ráº¥t nhiá»u lá»‡nh, Ä‘á»ƒ liá»‡t kÃª cÃ¡c lá»‡nh, ta dÃ¹ng:\n1 2 3 4 5 6 7  / # ls /bin/ -la  total 449700 drwxr-xr-x 2 root root 12288 Jun 7 17:34 . drwxr-xr-x 1 root root 4096 Jun 9 16:00 .. -rwxr-xr-x 400 root root 1149184 Jun 7 17:34 [ -rwxr-xr-x 400 root root 1149184 Jun 7 17:34 [[ -rwxr-xr-x 400 root root 1149184 Jun 7 17:34 acpid   Giá»›i thiá»‡u máº¡ng, network trong docker, máº¡ng bridge Liá»‡t kÃª cÃ¡c máº¡ng cÃ³ trong docker. Kiá»ƒm tra trong docker cÃ³ nhá»¯ng máº¡ng nÃ o, ta dÃ¹ng lá»‡nh:\n1 2 3 4 5  â¯ docker network ls NETWORK ID NAME DRIVER SCOPE e0b165102300 bridge bridge local 0f2ab02aa9f4 host host local 271997adaaa9 none null local   á» Ä‘Ã¢y chÃºng ta cÃ³ 3 network Ä‘Æ°á»£c táº¡o máº·c Ä‘á»‹nh khi docker táº¡o, bao gá»“m: bridge dÃ¹ng DRIVER bridge, host dÃ¹ng DRIVE host vÃ  none dÃ¹ng DRIVE null.\nKiá»ƒm tra thÃ´ng tin network Äá»ƒ kiá»ƒm tra thÃ´ng tin vá» má»™t network cÅ©ng nhÆ° nhá»¯ng container nÃ o káº¿t ná»‘i vÃ o, ta dÃ¹ng lá»‡nh:\ndocker network inspect \u0026lt;NAME\u0026gt;\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38  â¯ docker network inspect bridge [ { \u0026#34;Name\u0026#34;: \u0026#34;bridge\u0026#34;, \u0026#34;Id\u0026#34;: \u0026#34;e0b1651023003b4e6235e7b45319daa20d80a247d66e0b303eaf5e53fb90f0f8\u0026#34;, \u0026#34;Created\u0026#34;: \u0026#34;2021-06-09T20:59:15.89942017+07:00\u0026#34;, \u0026#34;Scope\u0026#34;: \u0026#34;local\u0026#34;, \u0026#34;Driver\u0026#34;: \u0026#34;bridge\u0026#34;, \u0026#34;EnableIPv6\u0026#34;: false, \u0026#34;IPAM\u0026#34;: { \u0026#34;Driver\u0026#34;: \u0026#34;default\u0026#34;, \u0026#34;Options\u0026#34;: null, \u0026#34;Config\u0026#34;: [ { \u0026#34;Subnet\u0026#34;: \u0026#34;172.17.0.0/16\u0026#34;, \u0026#34;Gateway\u0026#34;: \u0026#34;172.17.0.1\u0026#34; } ] }, \u0026#34;Internal\u0026#34;: false, \u0026#34;Attachable\u0026#34;: false, \u0026#34;Ingress\u0026#34;: false, \u0026#34;ConfigFrom\u0026#34;: { \u0026#34;Network\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;ConfigOnly\u0026#34;: false, \u0026#34;Containers\u0026#34;: {}, \u0026#34;Options\u0026#34;: { \u0026#34;com.docker.network.bridge.default_bridge\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;com.docker.network.bridge.enable_icc\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;com.docker.network.bridge.enable_ip_masquerade\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;com.docker.network.bridge.host_binding_ipv4\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;com.docker.network.bridge.name\u0026#34;: \u0026#34;docker0\u0026#34;, \u0026#34;com.docker.network.driver.mtu\u0026#34;: \u0026#34;1500\u0026#34; }, \u0026#34;Labels\u0026#34;: {} } ]   á» Ä‘Ã¢y chÃºng ta chÃº Ã½, trÆ°á»ng Container rá»—ng, cÃ³ nghÄ©a lÃ  khÃ´ng cÃ³ container nÃ o káº¿t ná»‘i vÃ o.\nMáº¡ng bridge. Ta tiáº¿n hÃ nh táº¡o má»™t container B1 vÃ  kiÃªm tra láº¡i máº¡ng bridge.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51  â¯ docker run -it --name B1 busybox / # % â¯ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 2f6dd1dda04d busybox \u0026#34;sh\u0026#34; 9 seconds ago Up 8 seconds B1 â¯ docker network inspect bridge [ { \u0026#34;Name\u0026#34;: \u0026#34;bridge\u0026#34;, \u0026#34;Id\u0026#34;: \u0026#34;e0b1651023003b4e6235e7b45319daa20d80a247d66e0b303eaf5e53fb90f0f8\u0026#34;, \u0026#34;Created\u0026#34;: \u0026#34;2021-06-09T20:59:15.89942017+07:00\u0026#34;, \u0026#34;Scope\u0026#34;: \u0026#34;local\u0026#34;, \u0026#34;Driver\u0026#34;: \u0026#34;bridge\u0026#34;, \u0026#34;EnableIPv6\u0026#34;: false, \u0026#34;IPAM\u0026#34;: { \u0026#34;Driver\u0026#34;: \u0026#34;default\u0026#34;, \u0026#34;Options\u0026#34;: null, \u0026#34;Config\u0026#34;: [ { \u0026#34;Subnet\u0026#34;: \u0026#34;172.17.0.0/16\u0026#34;, \u0026#34;Gateway\u0026#34;: \u0026#34;172.17.0.1\u0026#34; } ] }, \u0026#34;Internal\u0026#34;: false, \u0026#34;Attachable\u0026#34;: false, \u0026#34;Ingress\u0026#34;: false, \u0026#34;ConfigFrom\u0026#34;: { \u0026#34;Network\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;ConfigOnly\u0026#34;: false, \u0026#34;Containers\u0026#34;: { \u0026#34;2f6dd1dda04d0ab42434a6cff6f9c7eb42474f81acdf32809486f8fa82be8951\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;B1\u0026#34;, \u0026#34;EndpointID\u0026#34;: \u0026#34;0af6a3739786e89d5161f25edf7bb2a5d900ab580ab53e8f852a197134e010b7\u0026#34;, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:ac:11:00:02\u0026#34;, \u0026#34;IPv4Address\u0026#34;: \u0026#34;172.17.0.2/16\u0026#34;, \u0026#34;IPv6Address\u0026#34;: \u0026#34;\u0026#34; } }, \u0026#34;Options\u0026#34;: { \u0026#34;com.docker.network.bridge.default_bridge\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;com.docker.network.bridge.enable_icc\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;com.docker.network.bridge.enable_ip_masquerade\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;com.docker.network.bridge.host_binding_ipv4\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;com.docker.network.bridge.name\u0026#34;: \u0026#34;docker0\u0026#34;, \u0026#34;com.docker.network.driver.mtu\u0026#34;: \u0026#34;1500\u0026#34; }, \u0026#34;Labels\u0026#34;: {} } ]   Xem láº¡i trÆ°á»ng container thÃ¬ Ä‘Ã£ tháº¥y cÃ³ thÃªm má»™t container cÃ³ tÃªn lÃ  B1 Ä‘ang cháº¡y. NgoÃ i ra chÃºng ta cÃ²n cÃ³ thá»ƒ kiáº¿m tra container Ä‘ang dÃ¹ng máº¡ng nÃ o vÃ  Ä‘Æ°á»£c cáº¥p Ä‘á»‹a chá»‰ IP báº±ng bao nhiÃªu thÃ´ng qua lá»‡nh docker inspect \u0026lt;container_name\u0026gt;\nTáº¡o ra thÃªm 1 container tÃªn B2, khi Ä‘Ã³ container B1, B2 cÃ³ thá»ƒ nhÃ¬n tháº¥y nhau, chÃºng ta cÃ³ thá»ƒ kiá»ƒm tra thÃ´ng qua lá»‡nh ping.\nTrong image busybox, cÃ³ sáºµn má»™t cÃ´ng cá»¥ Ä‘á»ƒ táº¡o mÃ¡y chá»§ web http. Giáº£ sá»­ ta muá»‘n cho container B2 cháº¡y mÃ¡y chá»§ web http, chÃºng ta vÃ o /var/www vÃ  cháº¡y lá»‡nh httpd\n1 2 3 4 5 6 7  â¯ docker attach B2 / # cd var/ /var # ls spool www /var # cd www/ /var/www # httpd /var/www #    Táº¡o má»™t file index.html vá»›i ná»™i dung lÃ :\n1  web server is running...   Tá»« container B1, ta tiáº¿n hÃ nh wget tá»›i B2\n1 2 3 4 5 6 7 8  â¯ docker attach B1 / # wget -O - 172.17.0.3 Connecting to 172.17.0.3 (172.17.0.3:80) writing to stdout web server is running... - 100% |********************************| 25 0:00:00 ETA written to stdout / #    Vá»›i 172.17.0.3 lÃ  Ä‘á»‹a chá»‰ cá»§a container B2, cÃ³ thá»ƒ xem báº±ng lá»‡nh docker network inspect bridge. RÃµ rÃ ng, container B1 Ä‘Ã£ Ä‘á»c Ä‘Æ°á»£c file index mÃ  B2 tráº£ vá» vá»›i dÃ²ng chá»¯ web server is running...\nÃnh xáº¡ cá»•ng máº¡ng trong docker Ãnh xáº¡ cá»•ng máº¡ng B2 Ä‘ang má»Ÿ cá»•ng 80, mÃ¡y host cá»§a chÃºng ta Ä‘ang cÃ³ Ä‘á»‹a chá»‰ lÃ  127.0.0.1, chÃºng ta muá»‘n tá»« ngoÃ i máº¡ng truy cáº­p Ä‘Æ°á»£c tá»›i container B2 thÃ¬ pháº£i Ã¡nh xáº¡ cá»•ng 80 cá»§a B2 tá»›i má»™t cá»•ng nÃ o Ä‘Ã³ cá»§a host. Trong vÃ­ dá»¥ nÃ y, chÃºng ta sáº½ thiáº¿t láº­p truy cáº­p Ä‘áº¿n cá»•ng 80 cá»§a B2 thÃ´ng qua cá»•ng 8888 ip mÃ¡y host 127.0.0.1.\nÄiá»u nÃ y Ä‘Æ°á»£c lÃ m á»Ÿ bÆ°á»›c táº¡o container B2, lÃºc táº¡o chÃºng ta sáº½ Ã¡nh xáº¡ cá»•ng 80 tá»›i cá»•ng 8888 cá»§a mÃ¡y host. CÃº phÃ¡p nhÆ° sau:\ndocker run -it --name \u0026lt;name\u0026gt; -p \u0026lt;host_port\u0026gt;:\u0026lt;container_port\u0026gt; image\n1 2  â¯ docker run -it --name B2 -p 8888:80 busybox / #    Khi kiá»ƒm tra báº±ng lá»‡nh docker ps ta sáº½ tháº¥y container B2 Ä‘Ã£ Ã¡nh xáº¡ cá»•ng 80 lá»‡nh 8888 cá»§a mÃ¡y host á»Ÿ PORT.\n1 2 3  â¯ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES bdd19faad9cf busybox \u0026#34;sh\u0026#34; 8 minutes ago Up 8 minutes 0.0.0.0:8888-\u0026gt;80/tcp B2   ChÃºng ta sáº½ thao tÃ¡c láº¡i má»™t láº§n á»Ÿ docker B2 Ä‘á»ƒ cháº¡y httpd vÃ  táº¡o file index.html vá»›i ná»™i dung web server is running... trong thÆ° má»¥c /var/www. Sau Ä‘Ã³, chÃºng ta truy cáº­p á»Ÿ trÃ¬nh duyá»‡n chrome tá»« mÃ¡y host Ä‘áº¿n Ä‘á»‹a chá»‰ 127.0.0.1:8888\nNhÆ° váº­y, ta Ä‘Ã£ cÃ³ thá»ƒ truy cáº­p Ä‘áº¿n file index.html trong container B2 tá»« máº¡ng bÃªn ngoÃ i host.\nTáº¡o thÃªm máº¡ng TrÆ°á»ng há»£p chÃºng ta khÃ´ng muá»‘n táº¥t cáº£ cÃ¡c container cÃ¹ng káº¿t ná»‘i vÃ o má»™t máº¡ng bridge, ta cÃ³ thá»ƒ táº¡o thÃªm nhiá»u bridge riÃªng Ä‘á»ƒ cÃ³ thá»ƒ tÃ¡ch cÃ¡c riÃªng cÃ¡c container thÃ nh cÃ¡c cá»¥m riÃªng. Äá»ƒ táº¡o ra má»™t máº¡ng bridge, ta dÃ¹ng lá»‡nh:\ndocker network create --driver \u0026lt;loai_mang\u0026gt; \u0026lt;ten_mang\u0026gt;\ná» Ä‘Ã¢y chÃºng ta muá»‘n táº¡o thÃªm máº¡ng bridge nÃªn sau --driver sáº½ lÃ  bridge\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  â¯ docker network ls NETWORK ID NAME DRIVER SCOPE 286d5161c9f6 bridge bridge local 0f2ab02aa9f4 host host local 271997adaaa9 none null local â¯ docker network create --driver bridge mynetwork 6c224f5d1a9819ba01d68ed6cd3a15357709d3b8dcf0b1ab0e289d11973f43d0 â¯ docker network create --driver bridge network1 8f94d7a2e8ff372c3072294dd5260bbea0d0fb2692c2bedc3acad080b07b229c â¯ docker network ls NETWORK ID NAME DRIVER SCOPE 286d5161c9f6 bridge bridge local 0f2ab02aa9f4 host host local 6c224f5d1a98 mynetwork bridge local 8f94d7a2e8ff network1 bridge local 271997adaaa9 none null local   ChÃºng ta tiáº¿n hÃ nh táº¡o má»™t sá»‘ container khÃ´ng káº¿t ná»‘i máº·c Ä‘á»‹nh vÃ o network bridge mÃ  sáº½ káº¿t ná»‘i vÃ o mynetwork cá»§a chÃºng ta.\n1 2  â¯ docker run -it --name B3 --network mynetwork busybox / #    Äá»ƒ chá»‰ Ä‘á»‹nh network khi táº¡o, ta thÃªm tÃ¹y chá»n --network vÃ  theo sau lÃ  tÃªn cá»§a network mÃ¬nh muá»‘n káº¿t ná»‘i tá»›i. ChÃºng ta kiá»ƒm tra xem B3 cÃ³ tháº­t sá»± Ä‘Ã£ káº¿t ná»‘i tá»›i mynetwork chÆ°a.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39  â¯ docker network inspect mynetwork [ { \u0026#34;Name\u0026#34;: \u0026#34;mynetwork\u0026#34;, \u0026#34;Id\u0026#34;: \u0026#34;6c224f5d1a9819ba01d68ed6cd3a15357709d3b8dcf0b1ab0e289d11973f43d0\u0026#34;, \u0026#34;Created\u0026#34;: \u0026#34;2021-06-10T07:59:52.392658153+07:00\u0026#34;, \u0026#34;Scope\u0026#34;: \u0026#34;local\u0026#34;, \u0026#34;Driver\u0026#34;: \u0026#34;bridge\u0026#34;, \u0026#34;EnableIPv6\u0026#34;: false, \u0026#34;IPAM\u0026#34;: { \u0026#34;Driver\u0026#34;: \u0026#34;default\u0026#34;, \u0026#34;Options\u0026#34;: {}, \u0026#34;Config\u0026#34;: [ { \u0026#34;Subnet\u0026#34;: \u0026#34;172.20.0.0/16\u0026#34;, \u0026#34;Gateway\u0026#34;: \u0026#34;172.20.0.1\u0026#34; } ] }, \u0026#34;Internal\u0026#34;: false, \u0026#34;Attachable\u0026#34;: false, \u0026#34;Ingress\u0026#34;: false, \u0026#34;ConfigFrom\u0026#34;: { \u0026#34;Network\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;ConfigOnly\u0026#34;: false, \u0026#34;Containers\u0026#34;: { \u0026#34;a7231f2ebe678e679ff063d0d8a09613a81db899ffb7e11eb6ba6c202e2e97d7\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;B3\u0026#34;, \u0026#34;EndpointID\u0026#34;: \u0026#34;d8f6cf60953a1ebd7c1a84a95e5503bc726a5e77df2c939e8072fe6ca7406d65\u0026#34;, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:ac:14:00:02\u0026#34;, \u0026#34;IPv4Address\u0026#34;: \u0026#34;172.20.0.2/16\u0026#34;, \u0026#34;IPv6Address\u0026#34;: \u0026#34;\u0026#34; } }, \u0026#34;Options\u0026#34;: {}, \u0026#34;Labels\u0026#34;: {} } ]   RÃµ rÃ ng á»Ÿ trÆ°á»ng container Ä‘Ã£ thÃªm má»™t container lÃ  B3 vá»›i Ä‘á»‹a chá»‰ lÃ  172.20.0.2. ChÃºng ta tiáº¿p tá»¥c táº¡o thÃªm má»™t container B4 káº¿t ná»‘i vá»›i mynetwork vÃ  chá»‰ Ä‘á»‹nh cá»•ng 80 cá»§a nÃ³ Ã¡nh xáº¡ tá»›i cá»•ng 9999 trÃªn mÃ¡y host.\n1 2 3 4 5 6 7 8  â¯ docker run -it --name B4 --network mynetwork -p 9999:80 busybox / # %  â¯ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 1b39318c8d5b busybox \u0026#34;sh\u0026#34; About a minute ago Up About a minute 0.0.0.0:9999-\u0026gt;80/tcp B4 a7231f2ebe67 busybox \u0026#34;sh\u0026#34; 5 minutes ago Up 5 minutes B3 bdd19faad9cf busybox \u0026#34;sh\u0026#34; 37 minutes ago Up 37 minutes 0.0.0.0:8888-\u0026gt;80/tcp B2 2f6dd1dda04d busybox \u0026#34;sh\u0026#34; 9 hours ago Up 3 seconds B1   NhÆ° váº­y, trÃªn mÃ¡y cá»§a chÃºng ta Ä‘ang 2 máº¡ng lÃ  bridge vÃ  mynetwork:\n Máº¡ng bridge cÃ³ 2 container Ä‘ang káº¿t ná»‘i tá»›i lÃ  B1 vÃ  B2, trong Ä‘Ã³ B2 Ä‘ang Ã¡nh xáº¡ cá»•ng 80 Ä‘áº¿n cá»•ng 8888 trÃªn mÃ¡y host. Máº¡ng mynetwork cÃ³ 2 container Ä‘ang káº¿t ná»‘i tá»›i lÃ  B3 vÃ  B4, trong Ä‘Ã³ B4 Ä‘ang Ã¡nh xáº¡ cá»•ng 80 Ä‘áº¿n cá»•ng 9999 trÃªn host.\nTa tiáº¿n hÃ nh cháº¡y web server http trÃªn container B4 vÃ  káº¿t ná»‘i tá»« máº¡ng bÃªn ngoÃ i host.\nKhi táº¡o ra 2 network thÃ¬ nhá»¯ng mÃ¡y cÃ¹ng 1 network (B1 vá»›i B2 hoáº·c B3 vá»›i B4) cÃ³ thá»ƒ tháº¥y Ä‘Æ°á»£c nhau, tuy nhiÃªn á»Ÿ khÃ¡c network (B1 vá»›i B3,B4 hoáº·c B2 vá»›i B3,B4) thÃ¬ khÃ´ng thá»ƒ tháº¥y nhau. ChÃºng ta cÃ³ thá»ƒ kiá»ƒm tra Ä‘iá»u nÃ y thÃ´ng qua lÃªnh ping, tá»« B1 Ä‘áº¿n B2 vÃ  B1 Ä‘áº¿n B3. DÃ¹ng lá»‡nh docker network inspect \u0026lt;ten_network\u0026gt; ta biáº¿t Ä‘Æ°á»£c ip cá»§a B1, B2, B3 láº§n lÆ°á»£t lÃ  172.17.0.3, 172.17.0.2, 172.20.0.2. VÃ o B1 vÃ  tiáº¿n hÃ nh ping qua B2, B3:  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  â¯ docker attach B1 / # ping 172.17.0.2 PING 172.17.0.2 (172.17.0.2): 56 data bytes 64 bytes from 172.17.0.2: seq=0 ttl=64 time=0.268 ms 64 bytes from 172.17.0.2: seq=1 ttl=64 time=0.101 ms 64 bytes from 172.17.0.2: seq=2 ttl=64 time=0.198 ms 64 bytes from 172.17.0.2: seq=3 ttl=64 time=0.162 ms 64 bytes from 172.17.0.2: seq=4 ttl=64 time=0.165 ms 64 bytes from 172.17.0.2: seq=5 ttl=64 time=0.164 ms 64 bytes from 172.17.0.2: seq=6 ttl=64 time=0.139 ms 64 bytes from 172.17.0.2: seq=7 ttl=64 time=0.160 ms 64 bytes from 172.17.0.2: seq=8 ttl=64 time=0.181 ms ^C --- 172.17.0.2 ping statistics --- 9 packets transmitted, 9 packets received, 0% packet loss round-trip min/avg/max = 0.101/0.170/0.268 ms / # ping 172.20.0.2 PING 172.20.0.2 (172.20.0.2): 56 data bytes ^C --- 172.20.0.2 ping statistics --- 25 packets transmitted, 0 packets received, 100% packet loss / #    Ãnh xáº¡ cá»•ng cho má»™t container Ä‘ang cháº¡y. Trong vÃ­ dá»¥ trÃªn, B3 Ä‘ang káº¿t ná»‘i tá»›i mynetwork, ta muá»‘n cho B3 káº¿t ná»‘i tháº³ng tá»›i network bridge, ta lÃ m nhÆ° sau:\ndocker network connect \u0026lt;ten_mang_muon_ket_noi\u0026gt; \u0026lt;ten_container\u0026gt;\n1  â¯ docker network connect bridge B3   Kiá»ƒm tra máº¡ng bridge Ä‘á»ƒ xem B3 Ä‘Ã£ thá»±c sá»± káº¿t ná»‘i chÆ°a:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60  â¯ docker network inspect bridge [ { \u0026#34;Name\u0026#34;: \u0026#34;bridge\u0026#34;, \u0026#34;Id\u0026#34;: \u0026#34;286d5161c9f65235af68d99040f31b167b4bf23f9803fa3a2b3bd7de61b7c81c\u0026#34;, \u0026#34;Created\u0026#34;: \u0026#34;2021-06-10T06:58:33.069522692+07:00\u0026#34;, \u0026#34;Scope\u0026#34;: \u0026#34;local\u0026#34;, \u0026#34;Driver\u0026#34;: \u0026#34;bridge\u0026#34;, \u0026#34;EnableIPv6\u0026#34;: false, \u0026#34;IPAM\u0026#34;: { \u0026#34;Driver\u0026#34;: \u0026#34;default\u0026#34;, \u0026#34;Options\u0026#34;: null, \u0026#34;Config\u0026#34;: [ { \u0026#34;Subnet\u0026#34;: \u0026#34;172.17.0.0/16\u0026#34;, \u0026#34;Gateway\u0026#34;: \u0026#34;172.17.0.1\u0026#34; } ] }, \u0026#34;Internal\u0026#34;: false, \u0026#34;Attachable\u0026#34;: false, \u0026#34;Ingress\u0026#34;: false, \u0026#34;ConfigFrom\u0026#34;: { \u0026#34;Network\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;ConfigOnly\u0026#34;: false, \u0026#34;Containers\u0026#34;: { \u0026#34;2f6dd1dda04d0ab42434a6cff6f9c7eb42474f81acdf32809486f8fa82be8951\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;B1\u0026#34;, \u0026#34;EndpointID\u0026#34;: \u0026#34;5ddc6f87b486401bd0e2cfea3e1c8324300f9045712778f1c321e35349c56cff\u0026#34;, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:ac:11:00:03\u0026#34;, \u0026#34;IPv4Address\u0026#34;: \u0026#34;172.17.0.3/16\u0026#34;, \u0026#34;IPv6Address\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;a7231f2ebe678e679ff063d0d8a09613a81db899ffb7e11eb6ba6c202e2e97d7\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;B3\u0026#34;, \u0026#34;EndpointID\u0026#34;: \u0026#34;f1c96c1089fbe206c52832089be7b18321aeea7abff840f5169d3d171fa5ca1d\u0026#34;, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:ac:11:00:04\u0026#34;, \u0026#34;IPv4Address\u0026#34;: \u0026#34;172.17.0.4/16\u0026#34;, \u0026#34;IPv6Address\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;bdd19faad9cfe6ba9f49a532cf245b3a1bec95d8d20688f4c6b52018d45538b2\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;B2\u0026#34;, \u0026#34;EndpointID\u0026#34;: \u0026#34;32f69c565c649791c9f70db3a7a224e6a8d882b41fb9dc7c6477d4f33b9ec32b\u0026#34;, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:ac:11:00:02\u0026#34;, \u0026#34;IPv4Address\u0026#34;: \u0026#34;172.17.0.2/16\u0026#34;, \u0026#34;IPv6Address\u0026#34;: \u0026#34;\u0026#34; } }, \u0026#34;Options\u0026#34;: { \u0026#34;com.docker.network.bridge.default_bridge\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;com.docker.network.bridge.enable_icc\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;com.docker.network.bridge.enable_ip_masquerade\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;com.docker.network.bridge.host_binding_ipv4\u0026#34;: \u0026#34;0.0.0.0\u0026#34;, \u0026#34;com.docker.network.bridge.name\u0026#34;: \u0026#34;docker0\u0026#34;, \u0026#34;com.docker.network.driver.mtu\u0026#34;: \u0026#34;1500\u0026#34; }, \u0026#34;Labels\u0026#34;: {} } ]   Trong trÆ°á»ng container Ä‘Ã£ cÃ³ thÃªm container B3, vÃ  kiá»ƒm tra network mynetwork thÃ¬ tháº¥y B3 váº«n Ä‘ang káº¿t ná»‘i tá»›i mynetwork.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  â¯ docker network inspect mynetwork [ { \u0026#34;Name\u0026#34;: \u0026#34;mynetwork\u0026#34;, \u0026#34;Id\u0026#34;: \u0026#34;6c224f5d1a9819ba01d68ed6cd3a15357709d3b8dcf0b1ab0e289d11973f43d0\u0026#34;, \u0026#34;Created\u0026#34;: \u0026#34;2021-06-10T07:59:52.392658153+07:00\u0026#34;, \u0026#34;Scope\u0026#34;: \u0026#34;local\u0026#34;, \u0026#34;Driver\u0026#34;: \u0026#34;bridge\u0026#34;, \u0026#34;EnableIPv6\u0026#34;: false, \u0026#34;IPAM\u0026#34;: { \u0026#34;Driver\u0026#34;: \u0026#34;default\u0026#34;, \u0026#34;Options\u0026#34;: {}, \u0026#34;Config\u0026#34;: [ { \u0026#34;Subnet\u0026#34;: \u0026#34;172.20.0.0/16\u0026#34;, \u0026#34;Gateway\u0026#34;: \u0026#34;172.20.0.1\u0026#34; } ] }, \u0026#34;Internal\u0026#34;: false, \u0026#34;Attachable\u0026#34;: false, \u0026#34;Ingress\u0026#34;: false, \u0026#34;ConfigFrom\u0026#34;: { \u0026#34;Network\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;ConfigOnly\u0026#34;: false, \u0026#34;Containers\u0026#34;: { \u0026#34;1b39318c8d5b92261c22321f765945b85231160b53a9a3933b5fe120db80e7c2\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;B4\u0026#34;, \u0026#34;EndpointID\u0026#34;: \u0026#34;5f26179cc819ffe9f6089c8de41cc236a36ce90c5ac646041d99de7d4a54d3e5\u0026#34;, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:ac:14:00:03\u0026#34;, \u0026#34;IPv4Address\u0026#34;: \u0026#34;172.20.0.3/16\u0026#34;, \u0026#34;IPv6Address\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;a7231f2ebe678e679ff063d0d8a09613a81db899ffb7e11eb6ba6c202e2e97d7\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;B3\u0026#34;, \u0026#34;EndpointID\u0026#34;: \u0026#34;d8f6cf60953a1ebd7c1a84a95e5503bc726a5e77df2c939e8072fe6ca7406d65\u0026#34;, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:ac:14:00:02\u0026#34;, \u0026#34;IPv4Address\u0026#34;: \u0026#34;172.20.0.2/16\u0026#34;, \u0026#34;IPv6Address\u0026#34;: \u0026#34;\u0026#34; } }, \u0026#34;Options\u0026#34;: {}, \u0026#34;Labels\u0026#34;: {} } ]   LÃºc nÃ y, B3 cÃ³ thá»ƒ káº¿t ná»‘i tá»›i B2 vÃ  B1 vÃ  ngÆ°á»£c láº¡i.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  â¯ docker attach B1 / # ping 173.20.0.2 PING 173.20.0.2 (173.20.0.2): 56 data bytes 64 bytes from 173.20.0.2: seq=0 ttl=49 time=325.730 ms 64 bytes from 173.20.0.2: seq=1 ttl=49 time=297.840 ms 64 bytes from 173.20.0.2: seq=2 ttl=49 time=280.704 ms 64 bytes from 173.20.0.2: seq=3 ttl=49 time=328.708 ms 64 bytes from 173.20.0.2: seq=4 ttl=49 time=274.586 ms 64 bytes from 173.20.0.2: seq=5 ttl=49 time=295.232 ms 64 bytes from 173.20.0.2: seq=6 ttl=49 time=274.058 ms ^C --- 173.20.0.2 ping statistics --- 8 packets transmitted, 7 packets received, 12% packet loss round-trip min/avg/max = 274.058/296.694/328.708 ms   Má»™t lÆ°u Ã½ lÃ  khi B3 vÃ  B4 cÃ¹ng káº¿t ná»‘i vá»›i nhau qua má»™t máº¡ng, bÃªn cáº¡nh káº¿t ná»‘i vá»›i nhau qua Ä‘á»‹a chá»‰ thÃ¬ chÃºng cÃ³ thá»ƒ káº¿t ná»‘i vá»›i nhau qua tÃªn.\n1 2 3 4 5 6 7 8 9 10 11  â¯ docker attach B3 / # ping B4 PING B4 (172.20.0.3): 56 data bytes 64 bytes from 172.20.0.3: seq=0 ttl=64 time=0.283 ms 64 bytes from 172.20.0.3: seq=1 ttl=64 time=0.194 ms 64 bytes from 172.20.0.3: seq=2 ttl=64 time=0.164 ms 64 bytes from 172.20.0.3: seq=3 ttl=64 time=0.191 ms ^C --- B4 ping statistics --- 4 packets transmitted, 4 packets received, 0% packet loss round-trip min/avg/max = 0.164/0.208/0.283 ms   Tuy nhiÃªn B1, B2 cÅ©ng káº¿t ná»‘i vá»›i nhau chung 1 máº¡ng mÃ  chÃºng khÃ´ng thá»ƒ giao tiáº¿p vá»›i nhau qua tÃªn. CÃ³ thá»ƒ do máº¡ng cá»§a chÃºng cÃ¹ng káº¿t ná»‘i lÃ  máº¡ng máº·c Ä‘á»‹nh (bridge).\n1 2 3  â¯ docker attach B1 / # ping B2 ping: bad address \u0026#39;B2\u0026#39;   XÃ³a máº¡ng Khi khÃ´ng cÃ³ nhu cáº§u sá»­ dá»¥ng network ná»¯a, chÃºng ta cÃ³ thá»ƒ xÃ³a chÃºng Ä‘i vá»›i cÃº phÃ¡p:\ndocker network rm \u0026lt;ten_network\u0026gt;\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  â¯ docker network ls NETWORK ID NAME DRIVER SCOPE 286d5161c9f6 bridge bridge local 0f2ab02aa9f4 host host local 2f8c72e77060 mynetwork bridge local 258acbefb858 network1 bridge local 271997adaaa9 none null local â¯ docker network rm network1 network1 â¯ docker network ls NETWORK ID NAME DRIVER SCOPE 286d5161c9f6 bridge bridge local 0f2ab02aa9f4 host host local 2f8c72e77060 mynetwork bridge local 271997adaaa9 none null local   Káº¿t luáº­n Trong bÃ i há»c nÃ y, chÃºng ta Ä‘Ã£ há»c Ä‘Æ°á»£c tá»« anh XuanThuLabChanel nhá»¯ng kiáº¿n thá»©c nhÆ° sau:\n Biáº¿t vá» busybox CÃ¡c lá»‡nh thao tÃ¡c vá»›i docker network: liá»‡t kÃª, kiá»ƒm tra thÃ´ng tin máº¡ng Máº¡ng bridge, táº¡o thÃªm, xÃ³a máº¡ng, Ã¡nh xáº¡ cá»•ng máº¡ng trong docker.  Káº¿t thÃºc bÃ i viáº¿t nÃ y, má»™t láº§n ná»¯a em xin chÃ¢n thÃ nh gá»­i lá»i cáº£m Æ¡n Ä‘áº¿n anh XuanThuLabChanel Ä‘Ã£ lÃ m nhá»¯ng bÃ i há»c quÃ½ giÃ¡ vÃ  bá»• Ã­ch nÃ y.\n","description":"Pháº§n nÃ y chÃºng ta sáº½ há»c vá» : Máº¡ng | Networking trong Docker, táº¡o vÃ  quáº£n lÃ½ network trong container Docker ","id":3,"section":"posts","tags":["Docker"],"title":"TÃ¬m hiá»ƒu vÃ  sá»­ dá»¥ng docker (P3)","uri":"https://minhlongmt183.github.io/posts/docker_p3/"},{"content":"ToÃ n bá»™ series nÃ y Ä‘Æ°á»£c tham kháº£o tá»« hai nguá»“n chÃ­nh: XuanThuLabChanel vÃ  DockerDoc. Em xin chÃ¢n thÃ nh cáº£m Æ¡n sá»± cá»‘ng hiáº¿n cá»§a cÃ¡c tÃ¡c giáº£ cá»§a nhá»¯ng kÃªnh nÃ³i trÃªn.â¤ï¸â¤ï¸â¤ï¸  Lá»‡nh Docker exec, lÆ°u container thÃ nh image vá»›i commit, xuáº¥t image ra file Docker exec ThÃ´ng thÆ°á»ng, Ä‘á»ƒ thá»±c thi má»™t lá»‡nh trong container, ta sáº½ vÃ o container báº±ng lá»‡nh docker attach \u0026lt;container name or id\u0026gt;. Tuy nhiÃªn, náº¿u ta Ä‘ang á»Ÿ host vÃ  váº«n muá»‘n thá»±c thi má»™t lá»‡nh bÃªn trong container Ä‘ang cháº¡y, ta sáº½ dÃ¹ng lá»‡nh docker exec \u0026lt;container id / name\u0026gt; [COMMAND].\nVÃ­ dá»¥, tá»« host, ta cháº¡y lá»‡nh ls Ä‘á»ƒ liá»‡t kÃª táº¥t cáº£ cÃ¡c file trong container.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  â¯ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 6d1aa3dda644 ubuntu:latest \u0026#34;/bin/bash\u0026#34; 3 minutes ago Up 3 minutes test â¯ docker exec test ls bin boot dev etc home lib lib32 lib64 libx32 media mnt opt proc root run sbin srv sys tmp usr var   NgoÃ i ra cÅ©ng váº«n cÃ³ thá»ƒ thÃªm cÃ¡c option, vÃ­ dá»¥:\n1 2  â¯ docker exec -it test bash root@ubuntu1:/#   Lá»‡nh trÃªn yÃªu cáº§u thá»±c thi lá»‡nh bash vÃ  thÃªm option -it Ä‘á»ƒ cÃ³ thá»ƒ tÆ°Æ¡ng tÃ¡c trá»±c tiáº¿p vá»›i terminal, dá»… dÃ ng tháº¥y, nÃ³ khÃ¡ giá»‘ng vá»›i lá»‡nh docker attach, tuy nhiÃªn, khi má»Ÿ cÃ¡c process trong container báº±ng htop, chÃºng ta sáº½ tháº¥y nhÆ° sau:\nRÃµ rÃ ng, á»Ÿ Ä‘Ã¢y cÃ³ ngoÃ i process /bin/bash cÃ³ khi táº¡o, container cÃ²n cháº¡y thÃªm má»™t process bash, process nÃ y chÃ­nh lÃ  lá»‡nh mÃ  chÃºng ta yÃªu cáº§u thá»±c thi tá»« mÃ¡y host. Sau khi thá»±c hiá»‡n lá»‡nh docker exec -it test bash, ta gÃµ lá»‡nh exit Ä‘á»ƒ thoÃ¡t khá»i container, tuy nhiÃªn, vÃ¬ container váº«n cÃ²n process /bin/bash nÃªn nÃ³ váº«n cÃ²n hoáº¡t Ä‘á»™ng chá»© khÃ´ng bá»‹ táº¯t Ä‘i.\nDocker commit Sau khi cÃ i docker vÃ  sá»­ dá»¥ng, chÃºng ta cÃ³ thá»ƒ pháº£i cÃ i thÃªm nhiá»u pháº§n má»m, mÃ´i trÆ°á»ng khÃ¡c nhau. Khi Ä‘Ã³, Ä‘á»ƒ chia sáº» container nÃ y Ä‘i, ta cáº§n lÆ°u container nÃ y thÃ nh image. Äá»ƒ lÃ m viá»‡c Ä‘Ã³, ta sá»­ dá»¥ng lá»‡nh container commit.\nTrÆ°á»›c khi lÆ°u container trá»Ÿ thÃ nh image, ta kiá»ƒm tra xem trong há»‡ thá»‘ng cÃ³ nhá»¯ng image nÃ o:\n1 2 3 4  â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE ubuntu latest 7e0aa2d69a15 6 weeks ago 72.7MB centos latest 300e315adb2f 6 months ago 209MB   Má»™t Ä‘iá»u lÆ°u Ã½, muá»‘n lÆ°u container thÃ nh image, thÃ¬ container Ä‘Ã³ pháº£i á»Ÿ tráº¡ng thÃ¡i dá»«ng (Exited).\n1 2 3 4  â¯ docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 6d1aa3dda644 ubuntu:latest \u0026#34;/bin/bash\u0026#34; 23 minutes ago Exited (0) 4 minutes ago test ddf68933af54 centos:latest \u0026#34;/bin/bash\u0026#34; 16 hours ago Exited (0) 16 hours ago centos_docker   Tiáº¿n hÃ nh lÆ°u container thÃ nh images, ta dÃ¹ng cÃº phÃ¡p: docker commit CONTAINER image:tag. CONTAINER á»Ÿ Ä‘Ã¢y lÃ  tÃªn hoáº·c id cá»§a container.\nVÃ­ dá»¥, container ubuntu vá»«a rá»“i tÃ´i Ä‘Ã£ cÃ i thÃªm ping vá»›i vim, bÃ¢y giá» lÆ°u láº¡i thÃ nh image, ta thá»±c hiá»‡n:\n1 2 3 4 5 6 7  â¯ docker commit test ubuntu-pv:version1 sha256:a8e04dcf8737519e456dcedd646983a5d69d97ea85f5e3517b537b2b1a86ef0a â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE ubuntu-pv version1 a8e04dcf8737 5 seconds ago 170MB ubuntu latest 7e0aa2d69a15 6 weeks ago 72.7MB centos latest 300e315adb2f 6 months ago 209MB   RÃµ rÃ ng, sau khi thá»±c hiá»‡n lá»‡nh trÃªn, chÃºng ta sáº½ tháº¥y trong danh sÃ¡ch cÃ¡c images cÃ³ thá»ƒm má»™t image cÃ³ thÃªn lÃ  ubuntu-py vá»›i TAG lÃ  version1 cÃ¹ng ID vÃ  cÃ¡c thÃ´ng tin khÃ¡c.\nDocker save Sau khi ta lÆ°u container thÃ nh má»™t image, Ä‘á»ƒ cÃ³ thá»ƒ chia sáº» image nÃ y vá»›i ngÆ°á»i khÃ¡c, ta lÆ°u image thÃ nh má»™t file trÃªn mÃ¡y host. Viá»‡c nÃ y sáº½ Ä‘Æ°á»£c thá»±c hiá»‡n thÃ´ng qua lá»‡nh docker save --output filename.tar \u0026lt;image_id/name\u0026gt;.\n1 2 3 4 5 6 7 8 9 10  â¯ ls \u0026#39;IDA Freeware.desktop\u0026#39; PinImage tmp â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE ubuntu-pv version1 a8e04dcf8737 6 minutes ago 170MB ubuntu latest 7e0aa2d69a15 6 weeks ago 72.7MB centos latest 300e315adb2f 6 months ago 209MB â¯ docker save --output ubuntu-pv.tar a8 â¯ ls \u0026#39;IDA Freeware.desktop\u0026#39; PinImage tmp ubuntu-pv.tar   VÃ­ dá»¥ trÃªn tÃ´i Ä‘Ã£ lÆ°u ubuntu-pv image thÃ nh ra file ubuntu-pv.tar.\nDocker load Sau khi nháº­n Ä‘Æ°á»£c file image.tar, Ä‘á»ƒ phá»¥c há»“i hoáº·c sá»­ dá»¥ng láº¡i, ta sá»­ dá»¥ng lá»‡nh docker load -i image.tar\nVÃ­ dá»¥, tÃ´i tiáº¿n hÃ nh xÃ³a Ä‘i ubuntu-pv image hiá»‡n cÃ³ trÃªn há»‡ thá»‘ng. Lá»‡nh thao tÃ¡c vá»›i image báº¡n cÃ³ thá»ƒ xem á»Ÿ P1.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE ubuntu-pv version1 a8e04dcf8737 11 minutes ago 170MB ubuntu latest 7e0aa2d69a15 6 weeks ago 72.7MB centos latest 300e315adb2f 6 months ago 209MB â¯ docker image rm -f ubuntu-pv:version1 Untagged: ubuntu-pv:version1 Deleted: sha256:a8e04dcf8737519e456dcedd646983a5d69d97ea85f5e3517b537b2b1a86ef0a â¯ docker image rm ubuntu:latest Untagged: ubuntu:latest Untagged: ubuntu@sha256:adf73ca014822ad8237623d388cedf4d5346aa72c270c5acc01431cc93e18e2d Deleted: sha256:7e0aa2d69a153215c790488ed1fcec162015e973e49962d438e18249d16fa9bd â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE centos latest 300e315adb2f 6 months ago 209MB   BÃ¢y giá», ta tiáº¿n hÃ nh phá»¥c há»“i ubuntu-pv image tá»« file ubuntu-pv.tar Ä‘Ã£ cÃ³ á»Ÿ trÆ°á»›c Ä‘Ã³.\n1 2 3 4 5 6 7 8  â¯ ls \u0026#39;IDA Freeware.desktop\u0026#39; PinImage tmp ubuntu-pv.tar â¯ docker load -i ubuntu-pv.tar Loaded image ID: sha256:a8e04dcf8737519e456dcedd646983a5d69d97ea85f5e3517b537b2b1a86ef0a â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; a8e04dcf8737 14 minutes ago 170MB centos latest 300e315adb2f 6 months ago 209MB   Khi phá»¥c há»“i, tÃªn cá»§a image vÃ  tag cá»§a nÃ³ sáº½ lÃ  \u0026lt;none\u0026gt;. Äá»ƒ Ä‘áº·t tÃªn vÃ  tag, ta dÃ¹ng lá»‡nh:\ndocker tag image_id name:tag.\nâ¯ docker tag a8 newimage:version2 â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE newimage version2 a8e04dcf8737 16 minutes ago 170MB centos latest 300e315adb2f 6 months ago 209MB Chia sáº» dá»¯ liá»‡u trong Docker, táº¡o vÃ  quáº£n lÃ½ á»• Ä‘Ä©a docker volume Chia sáº» dá»¯ liá»‡u giá»¯a mÃ¡y host vÃ  container TrÃªn mÃ¡y host, tÃ´i tá»• chá»©c cÃ¢y thá»±c má»¥c nhÆ° sau:\n1 2 3 4 5  . â”œâ”€â”€ docker â”‚Â â””â”€â”€ data â”‚Â â””â”€â”€ d.txt   Má»¥c tiÃªu cá»§a chÃºng ta lÃ  Ä‘á»ƒ container cÃ³ thá»ƒ truy cáº­p vÃ  thao tÃ¡c vá»›i dá»¯ liá»‡u á»Ÿ trong data, vÃ  khi container bá»‹ xÃ³a Ä‘i, dá»¯ liá»‡u khÃ´ng bá»‹ máº¥t.\nChÃºng ta táº¡o má»›i má»™t container vÃ  trong lÃºc táº¡o sáº½ chá»‰ rÃµ thá»±c má»¥c Ã¡nh xáº¡ trÃªn host vÃ  thá»±c má»¥c Ä‘Æ°á»£c Ã¡nh xáº¡ á»Ÿ Ä‘Ã¢u trÃªn container.\ndocker run -it -v \u0026lt;thu/muc/tren/host\u0026gt;:\u0026lt;thu/muc/anh/xa/tren/container\u0026gt; \u0026lt;image id\u0026gt;\n1 2 3 4 5 6  â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE newimage version2 a8e04dcf8737 28 minutes ago 170MB centos latest 300e315adb2f 6 months ago 209MB â¯ docker run -it -v /home/edisc/Desktop/docker/data:/home/shared_data a8 root@d4d24f24bbe6:/#   ChÃºng ta tiáº¿n hÃ nh kiá»ƒm tra:\n1 2 3 4  root@d4d24f24bbe6:/# cd /home/shared_data/ root@d4d24f24bbe6:/home/shared_data# ls d.txt root@d4d24f24bbe6:/home/shared_data#   NhÆ° váº­y, dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c Ã¡nh xáº¡ vÃ  má»i thao tÃ¡c trÃªn dá»¯ liá»‡u á»Ÿ thÆ° má»¥c nÃ y sáº½ Ä‘Æ°á»£c lÆ°u vÃ o host.\nChia sáº» dá»¯ liá»‡u giá»¯a cÃ¡c container vá»›i nhau ChÃºng ta táº¡o láº¡i má»™t container cÃ³ tÃªn lÃ  container1 Ã¡nh xáº¡ tá»›i dá»¯ liá»‡u Desktop/docker/data, vÃ  táº¡o má»™t container2 muá»‘n Ã¡nh xáº¡ tá»›i dá»± liá»‡u nÃ y, thay vÃ¬ dÃ¹ng lá»‡nh táº¡o nhÆ° container1, ta cÃ³ thá»ƒ dÃ¹ng --volumes-from \u0026lt;container_name/id\u0026gt;\n1 2 3 4 5 6 7 8  â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE newimage version2 a8e04dcf8737 36 minutes ago 170MB centos latest 300e315adb2f 6 months ago 209MB â¯ docker run -it -v /home/edisc/Desktop/docker/data:/home/shared_data --name \u0026#34;container1\u0026#34; a8 root@b62e5d395369:/# % â¯ docker run -it --name container2 --volumes-from container1 centos [root@e1103acb0525 /]#   Chia sáº» qua volume BÃªn cáº¡nh viá»‡c chia sáº» dá»¯ liá»‡u báº±ng cÃ¡ch táº¡o cÃ¡c file dá»¯ liá»‡u, docker cÃ²n cho phÃ©p chÃºng ta táº¡o ra nhá»¯ng á»• Ä‘Ä©a, gÃ¡n vÃ o container vÃ  Ä‘á»ƒ chia sáº» dá»¯ liá»‡u giá»¯a chÃºng. CÅ©ng nhÆ° file, khi container xÃ³a thÃ¬ nhá»¯ng á»• Ä‘Ä©a nÃ y váº«n cÃ²n tá»“n táº¡i cho Ä‘áº¿n khi chÃºng ta cá»‘ tÃ¬nh xÃ³a nÃ³.\nKiá»ƒm tra cÃ¡c á»• Ä‘Ä©a hiá»‡n cÃ³ Äá»ƒ kiá»ƒm tra cÃ¡c á»• Ä‘Ä©a hiá»‡n cÃ³, ta dÃ¹ng lá»‡nh:\n1 2  â¯ docker volume ls DRIVER VOLUME NAME   Hiá»‡n táº¡i trÃªn há»‡ thá»‘ng khÃ´ng cÃ³ á»• Ä‘Ä©a nÃ o.\nTáº¡o á»• Ä‘Ä©a Äá»ƒ táº¡o má»™t á»• Ä‘Ä©a má»›i, ta dÃ¹ng lá»‡nh: docker volume create NAMEDISK.\n1 2 3 4 5  â¯ docker volume create D1 D1 â¯ docker volume ls DRIVER VOLUME NAME local D1   Kiá»ƒm tra thÃ´ng tin á»• Ä‘Ä©a Äá»ƒ kiá»ƒm tra thÃ´ng tin á»• Ä‘Ä©a ta dÃ¹ng lá»‡nh docker volume inspect NAMEDISK.\n1 2 3 4 5 6 7 8 9 10 11 12  â¯ docker volume inspect D1 [ { \u0026#34;CreatedAt\u0026#34;: \u0026#34;2021-06-08T10:06:13+07:00\u0026#34;, \u0026#34;Driver\u0026#34;: \u0026#34;local\u0026#34;, \u0026#34;Labels\u0026#34;: {}, \u0026#34;Mountpoint\u0026#34;: \u0026#34;/var/lib/docker/volumes/D1/_data\u0026#34;, \u0026#34;Name\u0026#34;: \u0026#34;D1\u0026#34;, \u0026#34;Options\u0026#34;: {}, \u0026#34;Scope\u0026#34;: \u0026#34;local\u0026#34; } ]   XÃ³a á»• Ä‘Ä©a Khi khÃ´ng cÃ³ nhu cáº§u sá»­ dá»¥ng, ta sá»­ dá»¥ng lá»‡nh docker volume rm NAMEDISK.\n1 2 3 4 5 6 7 8 9  â¯ docker volume ls DRIVER VOLUME NAME local D1 local D2 â¯ docker volume rm D1 D1 â¯ docker volume ls DRIVER VOLUME NAME local D2   GÃ¡n á»• Ä‘Ä©a volume vÃ o container Ta sá»­ dá»¥ng cÃº phÃ¡p:\ndocker run -it --mount source=DISK,target=pathContainer imageID\n1 2 3 4 5 6 7 8  â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE newimage version2 a8e04dcf8737 About an hour ago 170MB ubuntu latest 7e0aa2d69a15 6 weeks ago 72.7MB centos latest 300e315adb2f 6 months ago 209MB â¯ docker run -it --mount source=D2,target=/home/disk2 ubuntu:latest root@524a1182f690:/# cd /home/disk2/ root@524a1182f690:/home/disk2#   Ta tiáº¿n hÃ nh thÃªm dá»¯ liá»‡u trong thÆ° má»¥c trÃªn, sau Ä‘Ã³ xÃ³a container Ä‘i, vÃ  tháº¥y, á»• Ä‘Ä©a váº«n cÃ²n.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE newimage version2 a8e04dcf8737 About an hour ago 170MB ubuntu latest 7e0aa2d69a15 6 weeks ago 72.7MB centos latest 300e315adb2f 6 months ago 209MB â¯ docker run -it --mount source=D2,target=/home/disk2 ubuntu:latest root@524a1182f690:/# cd /home/disk2/ root@524a1182f690:/home/disk2# â¯ docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 524a1182f690 ubuntu:latest \u0026#34;/bin/bash\u0026#34; About a minute ago Exited (0) 23 seconds ago cocky_mclaren e1103acb0525 centos \u0026#34;/bin/bash\u0026#34; 19 minutes ago Exited (127) 11 minutes ago container2 b62e5d395369 a8 \u0026#34;/bin/bash\u0026#34; 21 minutes ago Exited (0) 11 minutes ago container1 â¯ docker rm 52 52 â¯ docker volume ls DRIVER VOLUME NAME local D2   Váº­y lÃ m sao Ä‘á»ƒ truy xuáº¥t dá»¯ liá»‡u hiá»‡n cÃ³ trÃªn D2 hoáº·c kiá»ƒm tra xem cÃ³ dá»¯ liá»‡u trÃªn Ä‘Ã³ hay khÃ´ng? Äá»ƒ lÃ m Ä‘Æ°á»£c Ä‘iá»u Ä‘Ã³, chÃºng ta táº¡o má»™t container khÃ¡c, mount tá»›i D2 vÃ  kiá»ƒm tra.\n1 2 3 4 5  â¯ docker run -it --mount source=D2,target=/home/disk3 ubuntu:latest root@ca47e1855144:/# cd /home/disk3/ root@ca47e1855144:/home/disk3# ls data.txt root@ca47e1855144:/home/disk3#   Dá»¯ liá»‡u do container trÆ°á»›c Ä‘Ã£ táº¡o vÃ  lÆ°u vÃ o, dá»¯ liá»‡u nÃ y váº«n cÃ²n máº·c dÃ¹ container Ä‘Ã£ xÃ³a Ä‘i.\nTáº¡o á»• Ä‘Ä©a Ã¡nh xáº¡ tá»›i thÆ° má»¥c trÃªn mÃ¡y host. CÃº phÃ¡p:\ndocker create --opt device =pathHOST --opt type=noe --opt o=bind DISKNAME\n1 2 3 4 5 6  â¯ docker volume create --opt device=/home/edisc/Desktop/docker/data --opt type=none --opt o=bind DISK1 DISK1 â¯ docker volume ls DRIVER VOLUME NAME local D2 local DISK1   ThÃ´ng tin á»• Ä‘Ä©a cÃ³ Ä‘Æ°á»£c nhÆ° sau:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  â¯ docker volume inspect DISK1 [ { \u0026#34;CreatedAt\u0026#34;: \u0026#34;2021-06-08T10:27:56+07:00\u0026#34;, \u0026#34;Driver\u0026#34;: \u0026#34;local\u0026#34;, \u0026#34;Labels\u0026#34;: {}, \u0026#34;Mountpoint\u0026#34;: \u0026#34;/var/lib/docker/volumes/DISK1/_data\u0026#34;, \u0026#34;Name\u0026#34;: \u0026#34;DISK1\u0026#34;, \u0026#34;Options\u0026#34;: { \u0026#34;device\u0026#34;: \u0026#34;/home/edisc/Desktop/docker/data\u0026#34;, \u0026#34;o\u0026#34;: \u0026#34;bind\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;none\u0026#34; }, \u0026#34;Scope\u0026#34;: \u0026#34;local\u0026#34; } ]   Äá»ƒ cháº¡y container vá»›i tham sá»‘ nÃ y ta khÃ´ng sá»­ dá»¥ng tÃ¹y chá»n --mount mÃ  ta sáº½ sá»§ dá»¥ng tÃ¹y chá»n -v.\n1 2 3 4 5 6 7 8 9 10  â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE newimage version2 a8e04dcf8737 About an hour ago 170MB ubuntu latest 7e0aa2d69a15 6 weeks ago 72.7MB centos latest 300e315adb2f 6 months ago 209MB â¯ docker run -it -v DISK1:/home/disk4 ubuntu:latest root@e94027a36d5b:/# cd /home/disk4/ root@e94027a36d5b:/home/disk4# ls c1.txt d.txt data_container2.txt root@e94027a36d5b:/home/disk4#   VÃ o thÆ° má»¥c vÃ  kiá»ƒm tra, ta váº«n tháº¥y nÃ³ cÃ³ cÃ¡c dá»¯ liá»‡u á»Ÿ trÃªn mÃ¡y host. VÃ  khi thao tÃ¡c dá»¯ liá»‡u trÃªn nÃ y, dá»¯ liá»‡u trÃªn mÃ¡y host cÅ©ng sáº½ Ä‘Æ°á»£c cáº­p nhÃ¢t.\nKáº¿t luáº­n Trong bÃ i há»c nÃ y, chÃºng ta Ä‘Ã£ há»c Ä‘Æ°á»£c tá»« anh XuanThuLabChanel nhá»¯ng kiáº¿n thá»©c nhÆ° sau: CÃ¡c lá»‡nh Docker exec, lÆ°u container thÃ nh image vá»›i commit, xuáº¥t image ra file:\n docker exec: thá»±c thi má»™t lá»‡nh bÃªn trong container Ä‘ang cháº¡y tá»« host. docker commit: lÆ°u container thÃ nh image docker save: lÆ°u image thÃ nh file. docker load: chuyá»ƒn file thÃ nh image.\nChia sáº» dá»¯ liá»‡u trong Docker, táº¡o vÃ  quáº£n lÃ½ á»• Ä‘Ä©a docker volume: Chia sáº» dá»¯ liá»‡u qua tá»‡p:  Container vá»›i host Giá»¯a container vá»›i nhau.   Chia sáº» dá»¯ liá»‡u qua á»• Ä‘Ä©a disk: cÃ¡c thao tÃ¡c vá»›i volume thÃ´ng qua lá»‡nh docker volume kÃ¨m cÃ¡c option tÆ°Æ¡ng á»©ng.\nKáº¿t thÃºc bÃ i viáº¿t nÃ y, má»™t láº§n ná»¯a em xin chÃ¢n thÃ nh gá»­i lá»i cáº£m Æ¡n Ä‘áº¿n anh XuanThuLabChanel Ä‘Ã£ lÃ m nhá»¯ng bÃ i há»c quÃ½ giÃ¡ vÃ  bá»• Ã­ch nÃ y.  ","description":"Pháº§n nÃ y chÃºng ta sáº½ tÃ¬m hiá»ƒu lá»‡nh Docker exec, lÆ°u container thÃ nh image vá»›i commit, xuáº¥t image ra file; Chia sáº» dá»¯ liá»‡u trong Docker, táº¡o vÃ  quáº£n lÃ½ á»• Ä‘Ä©a docker volume ","id":4,"section":"posts","tags":["Docker"],"title":"TÃ¬m hiá»ƒu vÃ  sá»­ dá»¥ng docker (P2)","uri":"https://minhlongmt183.github.io/posts/docker_p2/"},{"content":"ToÃ n bá»™ series nÃ y Ä‘Æ°á»£c tham kháº£o tá»« hai nguá»“n chÃ­nh: XuanThuLabChanel vÃ  DockerDoc. Em xin chÃ¢n thÃ nh cáº£m Æ¡n sá»± cá»‘ng hiáº¿n cá»§a cÃ¡c tÃ¡c giáº£ cá»§a nhá»¯ng kÃªnh nÃ³i trÃªn.â¤ï¸â¤ï¸â¤ï¸  LÃ m quen vá»›i docker command line Khi lÃ m viá»‡c vá»›i docker, lá»‡nh chÃºng ta hay dÃ¹ng Ä‘Ã³ chÃ­nh lÃ  docker. Sau lá»‡nh docker sáº½ cÃ³ nhiá»u lá»‡nh nhá», Ä‘á»ƒ xem danh sÃ¡ch cÃ¡c lá»‡nh nhá» nÃ y, ta gÃµ\n1  $ docker   1  $ docker run -d -p 80:80 docker/getting-started   Trong Ä‘Ã³:\n -d: cháº¡y container á»Ÿ cháº¿ Ä‘á»™ detached mode (á»Ÿ background) -p 80:80: Ã¡nh xáº¡ cá»•ng 80 cá»§a host vÃ o cá»•ng 80 cá»§a container. docker/getting-started: image sá»­ dá»¥ng  Docker images Liá»‡t kÃª cÃ¡c images 1 2 3 4 5 6  â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE debian latest 4a7a1f401734 3 weeks ago 114MB ubuntu latest 7e0aa2d69a15 6 weeks ago 72.7MB docker/getting-started latest 3ba8f2ff0727 2 months ago 27.9MB hello-world latest d1165f221234 3 months ago 13.3kB   á» Ä‘Ã¢y,\n REPOSITORY lÃ  tÃªn cá»§a image, TAG lÃ  phiÃªn báº£n cá»§a image, IMAGE ID lÃ  má»™t mÃ£ hash cá»§a image, CREATED lÃ  thá»i gian Ä‘Æ°á»£c táº¡o cá»§a image, SIZE lÃ  kÃ­ch thÆ°á»›c cá»§a image.\nCÃ¡c images nÃ y láº¥y tá»« hub.docker.com. ChÃºng ta vÃ o hub.docker.com Ä‘á»ƒ tÃ¬m kiáº¿m image thÃ­ch há»£p mÃ  mÃ¬nh muá»‘n táº£i. LÆ°u Ã½ náº¿u láº§n Ä‘áº§u báº¡n vÃ o trang nÃ y, báº¡n cáº§n Ä‘Äƒng kÃ­ má»™t tÃ i khoáº£n. NgoÃ i ra, ta cÃ³ thá»ƒ tÃ¬m kiáº¿m trá»±c tiáº¿p trÃªn terminal vá»›i lá»‡nh:  1  docker search \u0026lt;keyword\u0026gt;   VÃ­ dá»¥, ta muá»‘n tÃ¬m kiáº¿m cÃ¡c images cá»§a ubuntu\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  â¯ docker search ubuntu NAME DESCRIPTION STARS OFFICIAL AUTOMATED ubuntu Ubuntu is a Debian-based Linux operating sysâ€¦ 12337 [OK] dorowu/ubuntu-desktop-lxde-vnc Docker image to provide HTML5 VNC interface â€¦ 539 [OK] websphere-liberty WebSphere Liberty multi-architecture images â€¦ 273 [OK] rastasheep/ubuntu-sshd Dockerized SSH service, built on top of offiâ€¦ 253 [OK] consol/ubuntu-xfce-vnc Ubuntu container with \u0026#34;headless\u0026#34; VNC sessionâ€¦ 241 [OK] ubuntu-upstart Upstart is an event-based replacement for thâ€¦ 110 [OK] 1and1internet/ubuntu-16-nginx-php-phpmyadmin-mysql-5 ubuntu-16-nginx-php-phpmyadmin-mysql-5 50 [OK] open-liberty Open Liberty multi-architecture images basedâ€¦ 46 [OK] ubuntu-debootstrap debootstrap --variant=minbase --components=mâ€¦ 44 [OK] i386/ubuntu Ubuntu is a Debian-based Linux operating sysâ€¦ 25 nuagebec/ubuntu Simple always updated Ubuntu docker images wâ€¦ 24 [OK] solita/ubuntu-systemd Ubuntu + systemd 24 [OK] 1and1internet/ubuntu-16-apache-php-5.6 ubuntu-16-apache-php-5.6 14 [OK] 1and1internet/ubuntu-16-apache-php-7.0 ubuntu-16-apache-php-7.0 13 [OK] 1and1internet/ubuntu-16-nginx-php-phpmyadmin-mariadb-10 ubuntu-16-nginx-php-phpmyadmin-mariadb-10 11 [OK] 1and1internet/ubuntu-16-nginx-php-5.6-wordpress-4 ubuntu-16-nginx-php-5.6-wordpress-4 9 [OK] 1and1internet/ubuntu-16-nginx-php-5.6 ubuntu-16-nginx-php-5.6 8 [OK] 1and1internet/ubuntu-16-apache-php-7.1 ubuntu-16-apache-php-7.1 7 [OK] 1and1internet/ubuntu-16-nginx-php-7.0 ubuntu-16-nginx-php-7.0 4 [OK] pivotaldata/ubuntu A quick freshening-up of the base Ubuntu docâ€¦ 4 pivotaldata/ubuntu16.04-build Ubuntu 16.04 image for GPDB compilation 2 pivotaldata/ubuntu-gpdb-dev Ubuntu images for GPDB development 1 smartentry/ubuntu ubuntu with smartentry 1 [OK] 1and1internet/ubuntu-16-sshd ubuntu-16-sshd 1 [OK] 1and1internet/ubuntu-16-php-7.1 ubuntu-16-php-7.1 1 [OK]   Má»¥c OFFICIAL cho biáº¿t phiÃªn báº£n nÃ y lÃ  chÃ­nh chá»§. Äá»ƒ sá»­ dá»¥ng má»™t image nÃ o Ä‘Ã³, chÃºng ta cáº§n Ä‘á»c thÃ´ng tin cá»§a image trÃªn hub.docker vÃ  cÃ¡c phiá»ƒn báº£n cá»§a image náº±m á»Ÿ pháº§n tag.\nTáº£i image Äá»ƒ táº£i image, ta sá»­ dá»¥ng:\n1  docker pull image:tag   á» Ä‘Ã¢y, tag lÃ  phiÃªn báº£n mÃ  chÃºng ta muá»‘n sá»­ dá»¥ng. Náº¿u chÃºng ta muá»‘n táº£i báº£n ubuntu 20.04 thÃ¬ cÃ¢u lá»‡nh sáº½ lÃ :\n1 2 3 4  â¯ docker pull ubuntu:20.04 20.04: Pulling from library/ubuntu Digest: sha256:adf73ca014822ad8237623d388cedf4d5346aa72c270c5acc01431cc93e18e2d Status: Downloaded newer image for ubuntu:20.04   ChÃºng ta kiá»ƒm tra láº¡i Ä‘á»ƒ xÃ¡c nháº­n docker Ä‘Ã£ Ä‘Æ°á»£c táº£i báº±ng lá»‡nh docker images\n1 2 3 4 5 6 7  â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE debian latest 4a7a1f401734 3 weeks ago 114MB ubuntu 20.04 7e0aa2d69a15 6 weeks ago 72.7MB ubuntu latest 7e0aa2d69a15 6 weeks ago 72.7MB docker/getting-started latest 3ba8f2ff0727 2 months ago 27.9MB hello-world latest d1165f221234 3 months ago 13.3kB   Khi chÃºng ta khÃ´ng Ä‘á»ƒ tag, máº·c Ä‘á»‹nh nÃ³ xem nhÆ° tag nÃ y lÃ  latest vÃ  sáº½ táº£i báº£n má»›i nháº¥t vá», vÃ  khi chÃºng ta in ra cÃ¡c images, nhá»¯ng images nÃ y sáº½ cÃ³ tag lÃ  latest.\n1 2 3 4 5 6  â¯ docker pull centos Using default tag: latest latest: Pulling from library/centos 7a0437f04f83: Pull complete Digest: sha256:5528e8b1b1719d34604c87e11dcd1c0a20bedf46e83b5632cdeac91b8c04efc1 Status: Downloaded newer image for centos:latest   XÃ³a Image Äá»ƒ xÃ³a má»™t image khÃ´ng sá»­ dá»¥ng, chÃºng ta dÃ¹ng cÃ¢u lá»‡nh:\n1  docker image rm \u0026lt;ten_image_muon_xoa:tag\u0026gt;   VÃ­ dá»¥, tÃ´i muá»‘n xÃ³a image ubuntu:20.04, ta lÃ m nhÆ° sau:\n1 2  â¯ docker image rm ubuntu:20.04 Untagged: ubuntu:20.04   Káº¿t quáº£ sau khi xÃ³a:\n1 2 3 4 5 6  â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE debian latest 4a7a1f401734 3 weeks ago 114MB ubuntu latest 7e0aa2d69a15 6 weeks ago 72.7MB docker/getting-started latest 3ba8f2ff0727 2 months ago 27.9MB hello-world latest d1165f221234 3 months ago 13.3kB   NgoÃ i ra, chÃºng ta cÃ²n cÃ³ thá»ƒ xÃ³a báº±ng cÃ¡ch dÃ¹ng IMAGE ID, vÃ­ dá»¥, ta muá»‘n xÃ³a image hello-world,\n1 2 3 4 5 6 7 8 9 10  â¯ docker image rm d1165f221234 Untagged: hello-world:latest Untagged: hello-world@sha256:5122f6204b6a3596e048758cabba3c46b1c937a46b5be6225b835d091b90e46c Deleted: sha256:d1165f2212346b2bab48cb01c1e39ee8ad1be46b87873d9ca7a4e434980a7726 Deleted: sha256:f22b99068db93900abe17f7f5e09ec775c2826ecfe9db961fea68293744144bd â¯ docker images REPOSITORY TAG IMAGE ID CREATED SIZE debian latest 4a7a1f401734 3 weeks ago 114MB ubuntu latest 7e0aa2d69a15 6 weeks ago 72.7MB docker/getting-started latest 3ba8f2ff0727 2 months ago 27.9MB   Docker version Usage 1  $ docker version [OPTIONS]   Get the server version 1  $ docker version --format \u0026#39;{{.Server.Version}}\u0026#39;   Dump raw JSON data 1  $ docker version --format \u0026#39;{{json .}}\u0026#39;   Print the current context 1  $ docker version --format=\u0026#39;{{.Client.Context}}\u0026#39;   Docker run Image sáº½ Ä‘Æ°Æ¡c cháº¡y trong cÃ¡c container, Ä‘á»ƒ cháº¡y ta thá»±c hiá»‡n cÃ¢u lá»‡nh:\n Usage:  1  $ docker run [OPTIONS] IMAGE [COMMAND] [ARG...]    CÃ³ ráº¥t nhiá»u tham sá»‘, cÃ¡c báº¡n cÃ³ thá»ƒ Ä‘á»c á»Ÿ Ä‘Ã¢y  VÃ­ dá»¥: Cháº¡y má»™t image 1  docker run -it \u0026lt;ten_image/image_id\u0026gt;   á» Ä‘Ã¢y, -it lÃ  viáº¿t gá»n cá»§a 2 options: -i (interactive) vÃ  -t (terminal) chá»‰ Ä‘á»‹nh táº¡o ra container vÃ  cÃ³ thá»ƒ tÆ°Æ¡ng tÃ¡c vá»›i nÃ³ trá»±c tiáº¿p trÃªn terminal. Giáº£ sá»­ ta cháº¡y image ubuntu:latest.\n1 2  â¯ docker run -it ubuntu:latest root@b2d8e983bcef:/#   Váº­y lÃ  chÃºng ta Ä‘Ã£ cháº¡y image ubuntu:latest vÃ  Ä‘ang á»Ÿ container ubuntu, tÃ i khoáº£n root vá»›i hostname lÃ  b2d8e983bcef. ChÃºng ta kiá»ƒm tra thÃ´ng tin cá»§a ubuntu nÃ y.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  root@ff7140c65b73:/# cat /etc/*release DISTRIB_ID=Ubuntu DISTRIB_RELEASE=20.04 DISTRIB_CODENAME=focal DISTRIB_DESCRIPTION=\u0026#34;Ubuntu 20.04.2 LTS\u0026#34; NAME=\u0026#34;Ubuntu\u0026#34; VERSION=\u0026#34;20.04.2 LTS (Focal Fossa)\u0026#34; ID=ubuntu ID_LIKE=debian PRETTY_NAME=\u0026#34;Ubuntu 20.04.2 LTS\u0026#34; VERSION_ID=\u0026#34;20.04\u0026#34; HOME_URL=\u0026#34;https://www.ubuntu.com/\u0026#34; SUPPORT_URL=\u0026#34;https://help.ubuntu.com/\u0026#34; BUG_REPORT_URL=\u0026#34;https://bugs.launchpad.net/ubuntu/\u0026#34; PRIVACY_POLICY_URL=\u0026#34;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\u0026#34; VERSION_CODENAME=focal UBUNTU_CODENAME=focal root@ff7140c65b73:/#   Äá»ƒ kiá»ƒm tra cÃ³ nhá»¯ng container nÃ o Ä‘ang cháº¡y trÃªn mÃ¡y, chÃºng ta dÃ¹ng lá»‡nh:\n1 2 3  â¯ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES ff7140c65b73 ubuntu:latest \u0026#34;/bin/bash\u0026#34; 2 minutes ago Up 2 minutes unruffled_goldberg   Káº¿t quáº£ trÃªn cho tháº¥y, há»‡ thá»‘ng Ä‘ang cháº¡y má»™t container cÃ³ id lÃ  ff7140c65b73 vÃ  cháº¡y tá»« image ubuntu:latest, vá»›i command /bin/bash.\nKhi chÃºng ta gÃµ lá»‡nh exit Ä‘á»ƒ thoÃ¡t khá»i container, lá»‡nh docker ps sáº½ khÃ´ng hiá»ƒn thá»‹ container nÃ o, tuy nhiÃªn, lá»‡nh docker ps -a sáº½ liá»‡t kÃª táº¥t cáº£ cÃ¡c container Ä‘ang hiá»‡n cÃ³ trÃªn mÃ¡y kÃ¨m theo tráº¡ng thÃ¡i cá»§a nÃ³.\n1 2 3 4  â¯ docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES ff7140c65b73 ubuntu:latest \u0026#34;/bin/bash\u0026#34; 9 minutes ago Exited (0) 5 seconds ago unruffled_goldberg b2d8e983bcef ubuntu:latest \u0026#34;/bin/bash\u0026#34; 11 minutes ago Exited (0) 11 minutes ago gallant_snyder   Tráº¡ng thÃ¡i Exited thá»ƒ hiá»‡n container Ä‘Ã£ bá»‹ dá»«ng, vÃ  Ä‘á»ƒ khá»Ÿi Ä‘á»™ng láº¡i docker Ä‘Ã£ dá»«ng, ta dÃ¹ng lá»‡nh docker start\n1 2 3 4 5 6 7 8 9  â¯ docker start ff7140c65b73 ff7140c65b73 â¯ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES ff7140c65b73 ubuntu:latest \u0026#34;/bin/bash\u0026#34; 12 minutes ago Up 6 seconds unruffled_goldberg â¯ docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES ff7140c65b73 ubuntu:latest \u0026#34;/bin/bash\u0026#34; 12 minutes ago Up 11 seconds unruffled_goldberg b2d8e983bcef ubuntu:latest \u0026#34;/bin/bash\u0026#34; 14 minutes ago Exited (0) 14 minutes ago gallant_snyder   Äá»ƒ vÃ o láº¡i há»‡ Ä‘iá»u hÃ nh trong container, ta dÃ¹ng lá»‡nh docker attach container_id, lÆ°u Ã½, id chÃºng ta khÃ´ng cáº§n ghi háº¿t, chá»‰ cáº§n ghi 2-3 chá»¯ cÃ¡i Ä‘áº§u lÃ  Ä‘Æ°á»£c.\n1 2  â¯ docker attach ff root@ff7140c65b73:/#   Äá»ƒ thoÃ¡t khá»i container mÃ  khÃ´ng dá»«ng nÃ³, ta dÃ¹ng tá»• há»£p phÃ­m ctrl + P, ctrl + Q. Khi chÃºng ta dÃ¹ng tá»• há»£p nÃ y, ta sáº½ cÃ³ káº¿t quáº£ sau:\n1 2  â¯ docker attach ff root@ff7140c65b73:/# read escape sequence   Tá»« mÃ¡y host, Ä‘á»ƒ dá»«ng container, ta dÃ¹ng lá»‡nh docker stop \u0026lt;container_name/container_id\u0026gt;\n1 2 3 4 5 6 7  â¯ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES ff7140c65b73 ubuntu:latest \u0026#34;/bin/bash\u0026#34; 26 minutes ago Up 14 minutes unruffled_goldberg â¯ docker stop unruffled_goldberg unruffled_goldberg â¯ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES   Äáº·t tÃªn cho container 1 2  â¯ docker run -it --name \u0026#34;centos_docker\u0026#34; -h centos1 centos:latest [root@centos1 /]#    VÃ­ dá»¥ trÃªn cháº¡y container cÃ³ tÃªn lÃ  centos_docker sá»­ dá»¥ng image centos:latest.\n -it táº¡o má»™t tÆ°Æ¡ng tÃ¡c bash shell trong container. --name: Ä‘áº·t tÃªn cho container. -h: Ä‘áº·t hostname cho container.\nChÃºng ta cÃ³ thá»ƒ kiá»ƒm tra  1 2 3  â¯ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES ddf68933af54 centos:latest \u0026#34;/bin/bash\u0026#34; 2 minutes ago Up 3 seconds centos_docker   Capture container ID (\u0026ndash;cidfile) 1 2 3 4 5 6 7 8 9  â¯ docker run --cidfile /tmp/docker_test.cid ubuntu echo \u0026#34;test\u0026#34; Unable to find image \u0026#39;ubuntu:latest\u0026#39; locally latest: Pulling from library/ubuntu 345e3491a907: Pull complete 57671312ef6f: Pull complete 5e9250ddb7d0: Pull complete Digest: sha256:adf73ca014822ad8237623d388cedf4d5346aa72c270c5acc01431cc93e18e2d Status: Downloaded newer image for ubuntu:latest test    Lá»‡nh nÃ y táº¡o container vÃ  in test ra mÃ n hÃ¬nh console. Flag cidfile yÃªu cáº§u Docker táº¡o má»™t file má»›i vÃ \nviáº¿t container ID vÃ o nÃ³. Náº¿u file Ä‘Ã£ tá»“n táº¡i, Docker sáº½ tráº£ vá» error. Docker sáº½ Ä‘Ã³ng file khi docker run káº¿t thÃºc.  Full container capabilities (\u0026ndash;privileged) 1 2 3 4  â¯ docker run -t -i --rm ubuntu bash root@bd1340e91d1e:/# mount -t tmpfs none /mnt mount: /mnt: permission denied. root@bd1340e91d1e:/#    --rm tá»± Ä‘á»™ng xÃ³a container náº¿u nhÆ° nÃ³ Ä‘Ã£ tá»“n táº¡i. Lá»‡nh nÃ y khÃ´ng hoáº¡t Ä‘á»™ng, vÃ¬ theo máº·c Ä‘á»‹nh, nhá»¯ng cÃ¢u lá»‡nh Ä‘em láº¡i kháº£ nÄƒng nguy hiá»ƒm tá»›i kernel sáº½ bá»‹ loáº¡i bá», bao gá»“m cap_sys_admin (lá»‡nh yÃªu cáº§u mount filesystems). Tuy nhiÃªn, flag --privileged sáº½ cho phÃ©p chÃºng ta run:  1 2 3 4 5 6 7 8 9 10 11  â¯ docker run -t -i --privileged ubuntu bash root@a3c5921afbbc:/# mount -t tmpfs none /mnt root@a3c5921afbbc:/# df -h Filesystem Size Used Avail Use% Mounted on overlay 110G 58G 46G 56% / tmpfs 64M 0 64M 0% /dev tmpfs 3.9G 0 3.9G 0% /sys/fs/cgroup /dev/sda2 110G 58G 46G 56% /etc/hosts shm 64M 0 64M 0% /dev/shm none 3.9G 0 3.9G 0% /mnt root@a3c5921afbbc:/#    flag --privileged sáº½ cáº¥p háº¿t táº¥t cáº£ capabilities cho container, vÃ  loáº¡i bá» má»i giá»›i háº¡n Ä‘Æ°á»£c Ä‘áº·t ra bá»Ÿi cgroup controller. NÃ³i cÃ¡ch khÃ¡c, container cÃ³ thá»ƒ cháº¡y háº§u háº¿t má»i thá»© mÃ  mÃ¡y host cÃ³ thá»ƒ lÃ m.  Set working directory (-w) 1  $ docker run -w /path/to/dir/ -i -t ubuntu pwd    -w cho phÃ©p cÃ¢u lá»‡nh thá»±c thi bÃªn trong thÆ° má»¥c Ä‘Ã£ chá»‰ Ä‘á»‹nh. Náº¿u Ä‘Æ°á»ng dáº«n tá»›i thÆ° má»¥c khÃ´ng tá»“n táº¡i,\nnÃ³ sáº½ táº¡o má»™t thÆ° má»¥c má»›i trong container tÆ°Æ¡ng á»©ng Ä‘Æ°á»ng dáº«n Ä‘Ã³.  Set storage driver options per container 1  $ docker run -it --storage-opt size=120G fedora /bin/bash     size cho phÃ©p chÃºng ta thiáº¿t láº­p container rootfs size tá»›i 120G táº¡i thá»i Ä‘iá»ƒm táº¡o.\nOption nÃ y chá»‰ hiá»‡u quáº£ cho devicemapper, btrfs, overlay2, windowsfilter vÃ  zfs graph drives\n  Vá»›i devicemapper, btrfs, windowsfilter and zfs graph drivers user khÃ´ng thá»ƒ gÃ¡n kÃ­ch thÆ°á»›c\nnhá» hÆ¡n Default BasFS Size\n  Vá»›i overlay2 storage drive, size option chá»‰ hoáº¡t Ä‘á»™ng náº¿u trÃ¬nh fs Ä‘Æ°á»£c gÃ¡n lÃ  xfs\nvÃ  mounted vá»›i option pquota. trÆ°á»ng há»£p nÃ y, ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ cáº¥p size.\n  Mount tmpfs (\u0026ndash;tmpfs) 1  $ docker run -d --tmpfs /run:rw,noexec,nosuid,size=65536k my_image   flag --tmpfs mount má»™t empty tmpfs vÃ o container vá»›i rw, noexec, nosuid, size=65536k\nMount volume (-v, \u0026ndash;read-only) 1  $ docker run -v `pwd`:`pwd` -w `pwd` -i -t ubuntu pwd    -v mount thÆ° má»¥c hiá»‡n táº¡i vÃ o container -w cho phÃ©p command Ä‘Æ°á»£c thá»±c thi bÃªn trong thÆ° má»¥c hiá»‡n táº¡i báº±ng cÃ¡ch thay Ä‘á»•i trong thÆ° má»¥c\nthÃ nh giÃ¡ trá»‹ Ä‘Æ°á»£c tráº£ vá» bá»Ÿi pwd. NÃ³ sáº½ thá»±c thi káº¿t há»£p cÃ¢u lá»‡nh sá»­ dá»¥ng container,\nnhÆ°ng bÃªn trong thÆ° má»¥c hiá»‡n táº¡i:  1  $ docker run -v /doesnt/exist:/foo -w /foo -i -t ubuntu bash   Khi host directory cá»§a bind-mounted volume khÃ´ng tá»“n táº¡i, Docker sáº½ tá»± Ä‘á»™ng táº¡o thÆ° má»¥c nÃ y trÃªn host cho báº¡n.\nTrong vÃ­ dá»¥ trÃªn, Docker sáº½ táº¡o thÆ° má»¥c /doesnt/exist trÆ°á»›c khi cháº¡y container.\n1  $ docker run --read-only -v /icanwrite busybox touch /icanwrite/here    --read-only Ä‘á»ƒ kiá»ƒm soÃ¡t nÆ¡i container viáº¿t file, --read-only flag mount container\u0026rsquo;s root filesystem chá»‰ Ä‘á»ƒ Ä‘á»c.  1  $ docker run -t -i -v /var/run/docker.sock:/var/run/docker.sock -v /path/to/static-docker-binary:/usr/bin/docker busybox sh   Báº±ng cÃ¡ch liÃªn káº¿t docker unix socket vá»›i docker binary liÃªn káº¿t tÄ©nh, chÃºng ta cáº¥p container toÃ n quyá»n truy cáº­p\nvÃ  chá»‰nh sá»­a host\u0026rsquo;s Docker daemon.\nAdd bind mounts or volumes using the \u0026ndash;mount flag  VÃ­ dá»¥:  1  $ docker run --read-only --mount type=volume,target=/icanwrite busybox touch /icanwrite/here   1  $ docker run -t -i --mount type=bind,src=/data,dst=/data busybox sh   Publish or expose port (-p, \u0026ndash;expose) 1  $ docker run -p 127.0.0.1:80:8080/tcp ubuntu bash     CÃ¢u lá»‡nh káº¿t ná»‘i cá»•ng 8080 cá»§a container tá»›i cá»“ng 80 TCP trÃªn 127.0.0.1 cá»§a host machine.\nChÃºng ta cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh udp vÃ  sctp ports.\n  CÃ³ má»™t lÆ°u Ã½, nhá»¯ng port khÃ´ng rÃ ng buá»™c bá»Ÿi host sáº½ cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p tá»« bÃªn ngoÃ i.\nÄiá»u nÃ y cÅ©ng Ã¡p dá»¥ng náº¿u chÃºng ta muá»‘n cáº¥u hÃ¬nh UFW Ä‘á»ƒ cháº·n cÃ´ng cá»¥ nÃ y, vÃ¬ Docker quáº£n lÃ½ cÃ¡c quy tÃ¡c iptables\ncá»§a riÃªng mÃ¬nh.\n  1  $ docker run --expose 80 ubuntu bash   Hiá»ƒn thá»‹ cá»•ng 80 cá»§a container mÃ  khÃ´ng cÃ³ xuáº¥t hiá»‡n port trÃªn host system.\nSet environment variables (-e, \u0026ndash;env, \u0026ndash;env-file) 1  docker run -e MYVAR1 --env MYVAR2=foo --env-file ./env.list ubuntu bash    Sá»­ dá»¥ng nhá»¯ng flag -e, --env, --env-file Ä‘á»ƒ thiáº¿t láº­p nhá»¯ng biáº¿n mÃ´i trÆ°á»ng (khÃ´ng pháº£i dáº¡ng array)\ncho container báº¡n Ä‘ang cháº¡y, hoáº·c ghi Ä‘Ã¨ nhá»¯ng file Ä‘Ã³ cÃ³ sáºµn.  vÃ­ dá»¥:\n1 2 3  â¯ docker run --env VAR1=value1 --env VAR2=value2 ubuntu env | grep VAR VAR2=value2 VAR1=value1   Connect a container to a network (\u0026ndash;network) 1  $ docker run -itd --network=my-net busybox   ChÃºng ta cÃ³ thá»ƒ chá»n Ä‘á»‹a chá»‰ IP cho container vá»›i flag --ip hoáº·c --ip6 khi báº¡n cháº¡y container\ntrÃªn user-defined network\n1  $ docker run -itd --network=my-net --ip=10.10.9.75 busybox   Docker rm Äá»ƒ xÃ³a container khi nÃ³ Ä‘ang dá»«ng, ta dÃ¹ng lá»‡nh docker rm container_id\n1 2 3 4 5 6 7 8 9 10 11  â¯ docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES ddf68933af54 centos:latest \u0026#34;/bin/bash\u0026#34; 9 minutes ago Exited (0) 7 minutes ago centos_docker ff7140c65b73 ubuntu:latest \u0026#34;/bin/bash\u0026#34; About an hour ago Exited (0) 45 minutes ago unruffled_goldberg b2d8e983bcef ubuntu:latest \u0026#34;/bin/bash\u0026#34; About an hour ago Exited (0) About an hour ago gallant_snyder â¯ docker rm b2 b2 â¯ docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES ddf68933af54 centos:latest \u0026#34;/bin/bash\u0026#34; 10 minutes ago Exited (0) 7 minutes ago centos_docker ff7140c65b73 ubuntu:latest \u0026#34;/bin/bash\u0026#34; About an hour ago Exited (0) 45 minutes ago unruffled_goldberg   TrÆ°á»ng há»£p container Ä‘ang cháº¡y mÃ  ta muá»‘n xÃ³a thÃ¬ ta thÃªm options -f\n1  docker rm -f container_id/container_name   Tá»•ng káº¿t Trong bÃ i há»c nÃ y, chÃºng ta Ä‘Ã£ há»c Ä‘Æ°á»£c tá»« anh XuanThuLabChanel nhá»¯ng kiáº¿n thá»©c nhÆ° sau:\n docker images:  Liá»‡t kÃª danh sÃ¡ch táº¥t cáº£ cÃ¡c images trÃªn docker docker pull image:tag táº£i image vá» mÃ¡y docker image rm image_name/image_id xÃ³a image docker version: xem version cá»§a docker docker run -it --name \u0026quot;ten_container\u0026quot; -h \u0026quot;host_name\u0026quot; image: táº¡o container. ctrl + P, ctrl + Q: thoÃ¡t khá»i container nhÆ°ng váº«n Ä‘á»ƒ container cháº¡y. docker ps: in ra container cháº¡y docker stop container_id/name: buá»™c container Ä‘ang cháº¡y dá»«ng khi ta Ä‘ang á»Ÿ host. docker attach container_id/name: trá»Ÿ láº¡i container Ä‘ang cháº¡y. docker rm containerid/name: xÃ³a container Ä‘Ã£ dá»«ng. docker rm -f containerid/name: xÃ³a container Ä‘ang cháº¡y.\nKáº¿t thÃºc bÃ i viáº¿t nÃ y, má»™t láº§n ná»¯a em xin chÃ¢n thÃ nh gá»­i lá»i cáº£m Æ¡n Ä‘áº¿n anh XuanThuLabChanel Ä‘Ã£ lÃ m nhá»¯ng bÃ i há»c quÃ½ giÃ¡ vÃ  bá»• Ã­ch nÃ y.  ","description":"BÃ i nÃ y chÃºng ta sáº½ há»c lÃ m quen vá»›i docker command line, má»™t sá»‘ cÃ¢u lá»‡nh thÃ´ng dá»¥ng nhÆ° docker images, docker version, docker run, docker rm","id":5,"section":"posts","tags":["Docker"],"title":"TÃ¬m hiá»ƒu vÃ  sá»­ dá»¥ng docker (P1)","uri":"https://minhlongmt183.github.io/posts/docker_p1/"},{"content":"Nguá»“n tham kháº£o\nWhat is Packing? Packing cÃ³ nghÄ©a lÃ  nÃ©n (compressed), hoáº·c xÃ¡o trá»™n (obfuscated) file thá»±c thi Ä‘á»ƒ lÃ m cho file thá»±c thi khÃ³ phÃ¡t hiá»‡n, khÃ³ phÃ¢n tÃ­ch tÄ©nh, khÃ³ dá»‹ch ngÆ°á»£c. Trong ngá»¯ cáº£nh cá»§a malware, vÃ¬ mÃ£ Ä‘á»™c chá»§ yáº¿u Ä‘Æ°á»£c compressed, obfuscated trong cÃ¡c máº«u Ä‘Ã³ng gÃ³i, cÃ¡c cÃ´ng cá»¥ dÃ¹ng Ä‘á»ƒ phÃ¢n tÃ­ch tÄ©nh sáº½ gáº·p váº¥n Ä‘á» khi xÃ¡c Ä‘á»‹nh liá»‡u tá»‡p nhá»‹ phÃ¢n nÃ y cÃ³ pháº£i lÃ  mÃ£ Ä‘á»™c hay khÃ´ng. BÃªn cáº¡nh nÃ³, má»™t thuáº­t toÃ¡n packing tá»‘t sáº½ lÃ m khÃ³ khÄƒn qÃºa trÃ¬nh phÃ¢n tÃ­ch cá»§a cÃ¡c nhÃ  phÃ¢n tÃ­ch mÃ£ Ä‘á»™c, tá»« Ä‘Ã³ giÃºp cho vÃ²ng Ä‘á»i cá»§a mÃ£ Ä‘á»™c Ä‘Æ°á»£c kÃ©o dÃ i lÃ¢u hÆ¡n.\nMá»™t cÃ¡ch nÃ´m na, chÃºng ta cÃ³ thá»ƒ hiá»ƒu packer gá»“m: compressing packers vÃ  encrypting packers. Trong Ä‘Ã³ compressing packers má»¥c Ä‘Ã­ch lÃ  Ä‘Æ°a file thá»±c thi vá» dáº¡ng nÃ©n, lÃ m giáº£m kÃ­ch thÆ°á»›c cá»§a file, cÃ²n encrypting packers cÃ³ má»¥c Ä‘Ã­ch mÃ£ hÃ³a hoáº·c xÃ¡o trá»™n file Ä‘Ã£ Ä‘Æ°á»£c nÃ©n, nháº±m ngÄƒn cháº·n ngÆ°á»i dÃ¹ng dá»‹ch ngÆ°á»£c. NhÆ° Ä‘Ã£ nÃ³i, cÃ¡ch hiá»ƒu trÃªn chá»‰ lÃ  hiá»ƒu má»™t cÃ¡ch nÃ´m na, bá»Ÿi vÃ¬ cÃ³ nhiá»u packer káº¿t há»£p cáº£ hai tÃ­nh cháº¥t trÃªn, cÃ²n cÃ³ nhÆ°ng packer (nhÆ° UPX), nÃ³ chá»‰ compressing mÃ  khÃ´ng cÃ³ encrypting.\nHow does packing work? ChÃºng ta sáº½ nÃ³i vá» kiáº¿n trÃºc \u0026ldquo;stub-payload\u0026rdquo;, má»™t trong nhá»¯ng cÆ¡ cháº¿ Ä‘Æ°á»£c sá»­ dá»¥ng nhiá»u bá»Ÿi packer, ká»ƒ cáº£ UPX.\nTrong kiáº¿n trÃºc \u0026ldquo;stub-payload\u0026rdquo;, má»™t file thá»±c thi sáº½ gá»“n hai thÃ nh pháº§n chÃ­nh: ná»™i dung Ä‘Ã£ Ä‘Æ°á»£c nÃ©n / mÃ£ hÃ³a tá»« file gá»‘c vÃ  má»™t Ä‘oáº¡n mÃ£ dÃ¹ng Ä‘á»ƒ giáº£i nÃ©n / giáº£i mÃ£ file nÃ y vá» file gá»‘c vÃ  thá»±c thi nÃ³. Äoáº¡n mÃ£ nÃ y Ä‘Æ°á»£c gá»i lÃ  stub. Vá» báº£n cháº¥t, file ban Ä‘áº§u Ä‘Æ°á»£c náº¿n / mÃ£ hÃ³a, sau Ä‘Ã³ Ä‘Æ°á»£c bá»c trong tá»‡p thá»±c thi má»›i cÃ³ chá»©a mÃ£ Ä‘á»ƒ Ä‘Æ°a nÃ³ vá» tráº¡ng thÃ¡i ban Ä‘áº§u\nIndication of Packing Lacking of Import in Import Address Table (IAT) Äá»ƒ má»™t file thá»±c thi cÃ³ thá»ƒ tÆ°Æ¡ng tÃ¡c vá»›i há»‡ Ä‘iá»u hÃ nh thÃ¬ file thá»±c thi cáº§n pháº£i cÃ³ cÃ¡c hÃ m Ä‘Æ°á»£c tÃ­ch há»£p vÃ o thÆ° viá»‡n há»‡ thá»‘ng nhÆ° kernel32.dll vÃ  user32.dll. Khi phÃ¢n tÃ­ch má»™t tá»‡p tin Ä‘Ã£ Ä‘Æ°á»£c giáº£i nÃ©n hoÃ n toÃ n, ta sáº½ tháº¥y má»™t sá»‘ lÆ°á»£ng lá»›n cÃ¡c import vÃ¬ mÃ£ Ä‘á»™c rÃµ rÃ ng muá»‘n tÆ°Æ¡ng tÃ¡c khÃ¡ nhiá»u vá»›i há»‡ Ä‘iá»u hÃ nh. Tuy nhiÃªn, má»™t stub cá»§a má»™t chÆ°Æ¡ng trÃ¬nh bá»‹ packed khÃ´ng cÃ³ nhiá»u chá»©c nÄƒng ngoÃ i viá»‡c giáº£i nÃ©n vÃ  thá»±c thi file gá»‘c, do Ä‘Ã³, nÃ³ sáº½ cÃ³ sá»‘ lÆ°á»£ng import Ã­t hÆ¡n ráº¥t nhiá»u so vá»›i file chuáº©n.\nNon-standard Section Names: Trong nhá»¯ng file thá»±c thi bÃ¬nh thÆ°á»ng, chÃºng thÆ°á»ng cÃ³ cÃ¡c sections giá»‘ng nhau má»i lÃºc (.text, .data, .rsrc,..). Tuy nhiÃªn, nhá»¯ng paker sáº½ tá»± Ä‘á»‹nh nghÄ©a section cho riÃªng nÃ³, Ä‘iá»u nÃ y cÅ©ng cho tháº¥y nhá»¯ng file cÃ³ section nhÆ° váº­y sáº½ khÃ´ng pháº£i lÃ  tiÃªu chuáº©n vÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i. VÃ­ dá»¥ nhÆ° UPX packer sáº½ thá»±c thi vá»›i cÃ¡c file cÃ³ tÃªn section lÃ  UPX0 vÃ  UPX1.\nSections with a small raw size but a large virtual size Khi chÃºng ta gáº·p má»™t file mÃ  cÃ³ raw size ráº¥t nhá» (Ä‘Ã´i khi báº±ng 0), Ä‘iá»u nÃ y muá»‘n nÃ³i file thá»±c thi khÃ´ng cÃ³ báº¥t kÃ¬ dá»¯ liá»‡u nÃ o trong section. Tuy nhiÃªn, khi file thá»±c thi Ä‘Æ°á»£c load vÃ o bá»™ nhá»›, raw size khÃ´ng cÃ²n liÃªn quan, vÃ  nÃ³ Ä‘Æ°á»£c thay bá»Ÿi virtual size cá»§a tá»«ng pháº§n cá»¥ thá»ƒ Ä‘Æ°á»£c cáº¥p phÃ¡t trong memory. Náº¿u má»™t file cÃ³ section Ä‘Æ°á»£c cáº¥p phÃ¡t vá»›i virtual space lá»›n vÃ  raw data ráº¥t nhá», nÃ³ cÃ³ kháº£ nÄƒng cao lÃ  nhá»¯ng Ä‘oáº¡n code dÃ¹ng Ä‘á»ƒ unpacked.\nSections with very high entropy: Tá»« entroy Ä‘á» cáº­p Ä‘áº¿n phÆ°Æ¡ng sai vÃ  tÃ­nh ngáº«u nhiÃªn cá»§a má»™t pháº§n dá»¯ liá»‡u. Nhá»¯ng thá»© nhÆ° ngÃ´n ngá»¯ Tiáº¿ng Anh, assembly code, cÃ¡c cáº¥u trÃºc giao tiáº¿p Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh rÃµ rÃ ng khÃ¡c thÆ°á»ng cÃ³ entropy tháº¥p vÃ¬ ngÃ´n ngá»¯ cÃ³ xu hÆ°á»›ng tuáº§n theo cÃ¡c máº«u cÃ³ thá»ƒ Ä‘oÃ¡n trÆ°á»›c Ä‘Æ°á»£c. Tuy nhiÃªn, encrypted data vÃ  compressed data khÃ´ng cÃ³ kháº£ nÄƒng dá»± Ä‘oÃ¡n trÆ°á»›c, do Ä‘Ã³ cÃ³ entropy cao hÆ¡n nhiá»u. Do Ä‘Ã³, khi kiá»ƒm tra náº¿u tháº¥y cÃ³ entropy cao thÃ¬ kháº£ nÄƒng dá»¯ liá»‡u nÃ y Ä‘Ã£ Ä‘Æ°á»£c nÃ©n hoáº·c mÃ£ hÃ³a.\nLow number of discernible strings: Trong file khÃ´ng bá»‹ nÃ©n, chÃºng ta sáº½ nháº­n tháº¥y cÃ³ má»™t lÆ°á»£ng nháº¥t Ä‘á»‹nh cÃ¡c chuá»—i cÃ³ thá»ƒ Ä‘á»c Ä‘Æ°á»£c vÃ¬ háº§u háº¿t cÃ¡c á»©ng dá»¥ng (ká»ƒ cáº£ malware) sá»­ dá»¥ng nhá»¯ng protocol Ä‘Æ°á»£c hiá»‡n thá»±c bá»Ÿi ngÃ´n ngá»¯ con ngÆ°á»i. Do Ä‘Ã³, trong má»™t file bÃ¬nh thÆ°á»ng, nhá»¯ng chuá»—i nÃ y nÃªn xuáº¥t hiá»‡n, vÃ  khi tháº¥y nhá»¯ng chuá»—i cÃ³ thá»ƒ Ä‘á»c Ä‘Æ°á»£c á»Ÿ má»™t file quÃ¡ Ã­t hoáº·c khÃ´ng cÃ³, kháº£ nÄƒng cao file nÃ y Ä‘Ã£ bá»‹ nÃ©n hoáº·c bá»‹ mÃ£ hÃ³a.\nSections with RWX privileges: Trong cÃ¡c file bÃ¬nh thÆ°á»ng, má»™t section sáº½ ráº¥t Ã­t khi Ä‘Æ°á»£c cho phÃ©p cáº£ Ä‘á»c vÃ  ghi, vÃ¬ chÃºng ta hiáº¿m khi muá»‘n viáº¿t Ä‘Ã¨ file thá»±c thi trong á»©ng dá»¥ng cá»§a mÃ¬nh. NgoÃ i ra, hiáº¿m khi viáº¿t trá»±c tiáº¿p vÃ o file thá»±c thi trong lÃºc nÃ³ Ä‘ang cháº¡y. Do Ä‘Ã³, khÃ´ng cÃ³ lÃ½ do nÃ o Ä‘á»ƒ section Ä‘Æ°á»£c cáº¥p quyá»n vá»«a ghi vÃ  vá»«a Ä‘á»c ngoáº¡i trá»« packer. Vá»›i packer, dá»¯ liá»‡u sau khi giáº£i nÃ©n sáº½ Ä‘Æ°á»£c ghi vÃ o section rá»“i thá»±c thi.\njmp or call Instructions to registers/strange memory addresses: TrÃªn nhiá»u packers, Ä‘á»‹a chá»‰ tá»›i nÆ¡i dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c giáº£i nÃ©n thÆ°á»ng Ä‘Æ°á»£c lÆ°u trÃªn cÃ¡c thanh ghi vÃ  Ä‘á»‹a chá»‰ Ä‘Ã³ thÆ°á»ng náº±m trong má»™t section khÃ¡c, do dÃ³ chÃºng ta sáº½ tháº¥y bÆ°á»›c nÃ y nháº£y ráº¥t xa. CÃ¡c bÆ°á»›c nháº£y xa nhÆ° tháº¿ thÆ°á»ng khÃ´ng phá»• biáº¿n, vÃ¬ táº¥t cáº£ cÃ¡c mÃ£ thá»±c thi trong há»‡ nhá»‹ phÃ¢n thÆ°á»ng Ä‘Æ°á»£c chá»©a trong má»™t section duy nháº¥t. Náº¿u chÃºng ta tháº¥y má»™t lá»‡nh jump / call Ä‘áº¿n má»™t Ä‘á»‹a chá»‰ mÃ :\n1. KhÃ´ng cÃ³ trong section hiá»‡n táº¡i\n2. KhÃ´ng cÃ³ trong khÃ´ng gian Ä‘á»‹a chá»‰ cá»§a má»™t thÆ° viá»‡n Ä‘Ã£ táº£i.\nthÃ¬ kháº£ nÄƒng cao bÆ°á»›c nháº£y nÃ y lÃ  bÆ°á»›c giáº£i nÃ©n.\nNháº­n diá»‡n vá»›i file Ä‘Æ°á»£c mÃ£ hÃ³a báº±ng UPX CÃ¡c bÆ°á»›c giÃºp chÃºng ta nháº­n diá»‡n vÃ  giáº£i nÃ©n file bá»‹ mÃ£ hÃ³a báº±ng UPX:\n Kiá»ƒm tra PE header vÃ  xÃ¡c Ä‘á»‹nh xem chÃºng cÃ³ thá»±c sá»± bá»‹ Ä‘Ã³ng gÃ³i khÃ´ng. Tuy nhiÃªn bÆ°á»›c xÃ¡c Ä‘á»‹nh nÃ y chÃºng ta cÃ³ thá»ƒ dÃ¹ng peid. TÃ¬m nÆ¡i giáº£i nÃ©n sáº½ Ä‘Æ°á»£c ghi. TÃ¬m kiáº¿m lá»‡nh jmp hoáº·c call tham chiáº¿u Ä‘áº¿n má»™t thanh ghi hoáº·c khÃ´ng gian bá»™ nhá»› nÆ¡i lÆ°u dá»¯ liá»‡u giáº£i nÃ©n cÃ³ thá»ƒ Ä‘Æ°á»£c ghi vÃ o trong mÃ£ gá»‘c. Äáº·t breakpoint á»Ÿ nhá»¯ng lá»‡nh nÃ y. Dump data chá»©a trong khÃ´ng gian bá»™ nhá»› Ä‘Ã³, sá»­a import resolutions vÃ  xuáº¥t nÃ³ dÆ°á»›i dáº¡ng tá»‡p thá»±c thi má»›i.  Ãp dá»¥ng. Ta Ã¡p dá»¥ng vá»›i bÃ i garbage cá»§a flareon-2020.\n","description":"Packer lÃ  má»™t chÆ°Æ¡ng trÃ¬nh dÃ¹ng Ä‘á»ƒ nÃ©n vÃ  che dáº¥u file thá»±c thi cá»§a mÃ¬nh. NÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng nháº±m giÃºp cÃ¡c developer giáº¥u Ä‘i file thá»±c thi cá»§a mÃ¬nh, Ä‘á»ƒ lÃ m khÃ³ cÃ¡c reverser khiáº¿n há» khÃ³ khÄƒn trong quÃ¡ trÃ¬nh báº» khÃ³a chÆ°Æ¡ng trÃ¬nh cá»§a mÃ¬nh. Tuy nhiÃªn á»©ng dá»¥ng cÅ©ng nhÆ° kÄ© thuáº­t nÃ y cÅ©ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ táº¡o ra mÃ£ Ä‘á»™c, vÃ  nÃ³ cÅ©ng gÃ¢y ra nhiá»u khÃ³ khÄƒn cho cÃ¡c nhÃ  phÃ¢n tÃ­ch mÃ£ Ä‘á»™c trong quÃ¡ trÃ¬nh nghiÃªn cá»©u.","id":6,"section":"posts","tags":["Malware, flareon"],"title":"Manually Unpacking UPX Executables (váº«n Ä‘ang update...)","uri":"https://minhlongmt183.github.io/posts/packet/"},{"content":"Container Basics ChÃºng ta sáº½ Ä‘i qua má»™t sá»‘ khÃ¡i niá»‡m cÆ¡ báº£n vÃ  cáº§n thiáº¿t trong docker:\nCredentials Credentials describe the user identity of a task, which determine its permission for shared resources such as files, semaphores, and shared memory.\nCapabilities Since kernel 2.2, Linux divides the privileges associated with superuser into distinct unit known as capabilities\n/proc/$PID/status | man capabilities Filesystem The container\u0026rsquo;s root mount is often planted in a container-specialized filesystem, such as OverlayFS\n/var/lib/docker/overlay2/..hash../diff Namespaces  Má»¥c Ä‘Ã­ch: lÃ m cho há»‡ thá»‘ng container cÃ³ thá»ƒ sá»­ dá»¥ng vÃ  an toÃ n. PID: have their own view of tasks - cung cáº¥p cÃ¢y khÃ´ng gian tÃªn cá»§a process id. NÃ³ cho phÃ©p má»—i container cÃ³ má»™t cÃ¢y Ä‘áº§y Ä‘á»§ cÃ¡c process id riÃªng biá»‡t, trong Ä‘Ã³ init process cÃ³ pid = 1. Process cháº¡y trÃªn host sáº½ cÃ³ pid khÃ¡c vá»›i khi cháº¡y trÃªn container. User: wrap mapping of UID to user - cung cáº¥p phiÃªn báº£n namespace cá»§a User IDs (UIDs) and Group IDs (GIDs). ÄÃ¢y lÃ  má»™t trong nhá»¯ng tÃ­nh nÄƒng quan trá»ng nháº¥t cá»§a há»‡ thá»‘ng container hiá»‡n Ä‘áº¡i vÃ¬ nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ cung cáº¥p \u0026ldquo;unprivileged containers\u0026rdquo;. User namespaces cung cáº¥p má»™t trong nhá»¯ng ná»n táº£n cho há»‡ thá»‘ng container trÃªn Linux hiá»‡n nay, vÃ  lÃ  vÃ¹ng cáº¥u hÃ¬nh duy nháº¥t Ä‘Æ°á»£c LXC coi lÃ  an toÃ n. Mount: isolate mount points - cung cáº¥p cháº¿ Ä‘á»™ xem khÃ´ng gian tÃªn cá»§a cÃ¡c Ä‘iá»ƒm káº¿t ná»‘i (mount points). Káº¿t há»£p vá»›i pivot_root syscall, tÃ­nh nÄƒng nÃ y sáº½ cÃ´ láº­p container\u0026rsquo;s filesystem vá»›i host\u0026rsquo;s filesystem. Network: cung cáº¥p khÃ´ng gian tÃªn vÃ  ngÄƒn xáº¿p máº¡ng riÃªng biá»‡t. Háº§u háº¿t cÃ¡c trÆ°á»ng há»£p sá»­ dá»¥ng cá»§a container liÃªn quan tá»›i dá»‹ch vá»¥ máº¡ng, vÃ¬ váº­y nÃ³ Ä‘Æ°á»£c coi lÃ  tÃ­nh nÄƒng lÃµi cá»§a container. UTS: have their own hostname - cung cáº¥p namespaced version cá»§a Ä‘á»‹nh danh há»‡ thá»‘ng (system identifies) IPC: restrict SysV IPC objects Cgroup: isolate the view of cgroups  /proc/$PID/ns/ Cgroups CGroups: cung cáº¥p giao diá»‡n phÃ¢n cáº¥p Ä‘á»ƒ quáº£n lÃ­ cÅ©ng nhÆ° Ä‘o lÆ°á»ng tÃ i nguyÃªn vÃ  quyá»n truy cáº­p cá»§a thiáº¿t bá»‹. Cgroups cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi cÃ¡c process cÃ³ quyá»n háº¡n cao (higher privileged) Ä‘á»ƒ Ä‘áº·t giá»›i háº¡n vá» sá»­ dá»¥ng bá»™ nhá»›, CPU, cháº·n cÃ¡c thiáº¿t bá»‹ IO khÃ¡c. ChÃºng cÃ²n cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng chung vá»›i iptables Ä‘á»ƒ cung cáº¥p Ä‘á»‹nh hÃ¬nh lÆ°u lÆ°á»£ng. Quan trong nháº¥t, chÃºng Ä‘Æ°á»£c sá»­ dá»¥ng trong há»‡ thá»‘ng container Ä‘áº» kiá»ƒm soÃ¡t quyá»n truy cáº­p cá»§a cÃ¡c thiáº¿t bá»‹.\nLinux Security Modules - LSMs  AppArmor and SELinux are Linux security modules providing Mandatory Access Control (MAC), where access rules for a program are described by a profile. AppArmor lÃ  LSM phá»• biáº¿n nháº¥t trong há»‡ thá»‘ng container, nÃ³ cÃ³ thá»ƒ giá»›i háº¡n cÃ¡c hÃ nh Ä‘á»™ng mÃ  má»™t chÆ°Æ¡ng trÃ¬nh nháº¥t Ä‘á»‹nh cÃ³ thá»ƒ thá»±c hiá»‡n, cÅ©ng nhÆ° thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng phá»©c táº¡p khi báº¯t Ä‘áº§u process. Cáº£ LXC vÃ  Docker Ä‘á»u thiáº¿t láº­p á»Ÿ cháº¿ Ä‘á»™ máº·c Ä‘á»‹nh Ä‘á»ƒ xÃ¢y dá»±ng nhá»¯ng rÃ o cáº£n an ninh, chá»‘ng láº¡i nhá»¯ng má»‘i Ä‘e dá»a theo chiá»u sÃ¢u. Cho Ä‘áº¿n nay, AppArmor Ä‘Æ°á»£c ghi nháº­n lÃ  há»— trá»£ vÃ  ghi nháº­n tá»‘t nháº¥t.\nDo sá»± Ä‘Æ¡n giáº£n cá»§a cÃº phÃ¡p AppArmor, nÃ³ cÅ©ng dá»… sá»­ dá»¥ng hÆ¡n ráº¥t nhiá»u Ä‘á»ƒ cáº¥u hÃ¬nh tÃ¹y chá»‰nh cho má»—i vÃ¹ng chá»©a. Docker and LXC enable a default LSM profile in enforcement mode, wh mostly serves to restrict a container\u0026rsquo;s\naccess to sensitive /proc and /sys entries. The profile also denies mount syscall.  Táº§m quan trá»ng cá»§a Apparmor Mount Options  ChÃ­nh sÃ¡ch cá»§a AppArmor cháº·n viá»‡c truy cáº­p Ä‘á»ƒ mounting devpts filesystems. NhÆ° comment á»Ÿ dÆ°á»›i, náº¿u khÃ´ng cÃ³ chÃ­nh sÃ¡ch nÃ y, container cÃ³ thá»ƒ remount /dev/pts vÃ  chiáº¿m quyá»n truy cáº­p vÃ o cÃ¡c thiáº¿t bá»‹ Ä‘áº§u cuá»‘i cá»§a mÃ¡y chá»§.  1 2 3 4  # the container may never be allowed to mount devpts. If it does, it # will remount the host\u0026#39;s devpts. We could allow it to do it with # the newinstance option (but, right now, we don\u0026#39;t). deny mount fstype=devpts    CÃ¡c chÃ­nh sÃ¡ch dÃ¹ng Ä‘á»ƒ cháº·n container cá»‘ gáº¯ng remount root filesystem. ChÃ­nh sÃ¡ch nÃ y Ä‘Æ°á»£c thá»±c hiá»‡n nhÆ° má»™t biá»‡n phÃ¡p phÃ²ng thá»§ theo chiá»u sÃ¢u.  1 2 3  # ignore DENIED message on / remount deny mount options=(ro, remount) -\u0026gt; /, deny mount options=(ro, remount, silent) -\u0026gt; /,   Utility Changes   CÃ³ ráº¥t nhiá»u \u0026ldquo;nÆ¡i nguy hiá»ƒm\u0026rdquo; trong /proc vÃ  /sys cho phÃ©p cÃ¡c container thoÃ¡t ra ngoÃ i (container escapes).\nTáº¥t cáº£ nhá»¯ng Ä‘iá»u nÃ y liÃªn quan tá»›i viá»‡c thay Ä‘á»•i vá»‹ trÃ­ cá»§a má»™t tiá»‡n Ã­ch (cháº³ng háº¡n nhÆ° modprobe) mÃ  mÃ¡y chá»§ sáº½ gá»i khi má»™t sá»± kiá»‡n nháº¥t Ä‘á»‹nh xáº£y ra (vÃ­ dá»¥ nhÆ° yÃªu cáº§u load yÃªu cáº§u cá»§a kernel module).\nBáº±ng cÃ¡ch thay Ä‘á»•i Ä‘iá»u nÃ y Ä‘á»ƒ trá» Ä‘áº¿n má»™t chÆ°Æ¡ng trÃ¬nh bÃªn trong container cá»§a chÃºng ta, attacker sau Ä‘Ã³ cÃ³ thá»ƒ khiáº¿n mÃ¡y chá»§ cháº¡y má»™t Ä‘oáº¡n mÃ£ tÃ¹y Ã½ bÃªn ngoÃ i container\n  LXC sá»­ dá»¥ng bá»™ quy táº¯c sau Ä‘á»ƒ cháº·n cÃ¡c cuá»™c táº¥n cÃ´ng nÃ y. LÆ°u Ã½, nÃ³ khÃ´ng pháº£i lÃ  má»™t cáº¥u hÃ¬nh cáº£u AppArmor, nÃ³ lÃ  Ä‘áº§u vÃ o cho má»™t Ä‘oáº¡n lá»‡nh python nhá» táº¡o ra má»™t pháº§n dÃ i (long portion) cá»§a cÃ¡c quy táº¯c AppArmor.\n  1 2 3 4 5 6 7 8 9 10 11 12 13 14  # Run lxc-generate-aa-rules.py on this file after any modification, to generate # the container-rules file which is appended to container-base.in to create the # final abstractions/container-base. block /sys allow /sys/fs/cgroup/** allow /sys/devices/virtual/net/** allow /sys/class/net/** block /proc/sys allow /proc/sys/kernel/shm* allow /proc/sys/kernel/sem* allow /proc/sys/kernel/msg* allow /proc/sys/kernel/hostname allow /proc/sys/kernel/domainname allow /proc/sys/net/**   Nhá»¯ng vector quan trá»ng nÃ o Ä‘ang bá»‹ cháº·n?\n  uevent_helper: uevents lÃ  nhá»¯ng sá»± kiá»‡n Ä‘Æ°á»£c kernel kÃ­ch hoáº¡t khi má»™t thiáº¿t bá»‹ thÃªm vÃ o hoáº·c xÃ³a Ä‘i. Äiá»u Ä‘Ã¡ng chÃº Ã½ lÃ  Ä‘Æ°á»ng dáº«n cá»§a \u0026ldquo;uevent_helper\u0026rdquo; cÃ³ thá»ƒ Ä‘Æ°á»£c chá»‰nh sá»­a báº±ng cÃ¡ch ghi vÃ o \u0026quot;/sys/kernel/uevent_helper\u0026quot;.\nDo Ä‘Ã³, khi má»™t uevent Ä‘Æ°á»£c kÃ­ch hoáº¡t (cÅ©ng cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c hiá»‡n tá»« userland báº±ng cÃ¡ch ghi vÃ o cÃ¡c tá»‡p nhÆ° \u0026quot;/sys/class/mem/null/event\u0026quot;), \u0026ldquo;uevent_helper Ä‘á»™c háº¡i\u0026rdquo; sáº½ Ä‘Æ°á»£c thá»±c thi.\n  modprobe: modprobe lÃ  má»™t tiá»‡n Ã­ch thuá»™c userland, Ä‘Æ°á»£c kernel gá»i khi kernel cáº§n load má»™t kernel module. Vá»‹ trÃ­ cá»§a nÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c thay Ä‘á»•i báº±ng cÃ¡ch sá»­a Ä‘á»•i \u0026quot;/proc/sys/kernel/modprobe\u0026quot;,\nvÃ  sau Ä‘Ã³ chÃºng ta chá»‰ cáº§n thá»±c hiá»‡n má»™t hÃ nh Ä‘á»™ng nÃ o Ä‘Ã³ Ä‘á»ƒ kernel táº£i má»™t kernel module, code chÃºng ta sáº½ Ä‘Æ°á»£c thá»±c thi. (Cháº³ng háº¡n nhÆ° sá»­ dá»¥ng crypto-API Ä‘á»ƒ táº£i crypto-module hoáº·c sá»­ dá»¥ng ifconfig Ä‘á»ƒ táº£i networking module cho thiáº¿t bá»‹ hiá»‡n khÃ´ng sá»­ dá»¥ng.)\n  core_pattern: core_patterns thÆ°á»ng sá»­ dá»¥ng Ä‘á»ƒ cho kernel biáº¿t cÃ¡ch Ä‘áº·t tÃªn vÃ  Ä‘á»‹nh dáº¡ng cÃ¡c core dumps Ä‘Æ°á»£c táº¡o khi chÆ°Æ¡ng trÃ¬nh bá»‹ crash.\nTuy nhiÃªn, nÃ³ láº¡i cÃ³ 1 tÃ­nh nÄƒng ráº¥t tá»‡: \u0026ldquo;tá»« Linux kernel 2.6.19. Linux há»— trá»£ cÃº phÃ¡p thay tháº¿ cho tá»‡p /proc/sys/kernel/core_patterm. Náº¿u kÃ½ tá»± Ä‘áº§u tiÃªn cá»§a tá»‡p nÃ y lÃ  kÃ­ tá»± pipe (|),\nthÃ¬ pháº§n cÃ²n láº¡i cá»§a dÃ²ng nÃ y Ä‘Æ°á»£c hiá»ƒu lÃ  má»™t chÆ°Æ¡ng trÃ¬nh sáº½ Ä‘Æ°á»£c thá»±c thi. Thay vÃ¬ Ä‘Æ°á»£c ghi vÃ o Ä‘Ä©a, core dump lÃºc bÃ¢y giá» sáº½ Ä‘Æ°á»£c xem lÃ  má»™t chuáº©n input cá»§a chÆ°Æ¡ng trÃ¬nh trÃªn.\u0026rdquo;.\nSá»­ dá»¥ng tÃ­nh nÄƒng trÃªn, core_pattern cÃ³ thá»ƒ Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh Ä‘á»ƒ gá»i chÆ°Æ¡ng trÃ¬nh cá»§a chÃºng ta, rá»“i Ä‘á»ƒ kÃ­ch hoáº¡t nÃ³, ta chá»‰ cáº§n lÃ m cho chÆ°Æ¡ng trÃ¬nh bá»‹ crash.\n  /proc/sys/vm/panic_on_oom: Ä‘Ã¢y lÃ  global flag, xÃ¡c Ä‘á»‹nh kernel cÃ³ \u0026ldquo;hoáº£ng sá»£\u0026rdquo; (panic) khi gáº·p pháº£i tÃ¬nh tráº¡ng háº¿t bá»™ nhá»› hay khÃ´ng (Out Of Memory - OOM). Äiá»u nÃ y cho phÃ©p chÃºng ta tiáº¿n hÃ nh má»™t cuá»™c táº¥n cÃ´ng DOS Ä‘Æ¡n giáº£n.\n  Dangerous Paths 1 2 3 4 5  # block some other dangerous paths deny @{PROC}/kcore rwklx, deny @{PROC}/kmem rwklx, deny @{PROC}/mem rwklx, deny @{PROC}/sysrq-trigger rwklx,     kcore cung cáº¥p káº¿t xuáº¥t Ä‘áº§y Ä‘á»§ cá»§a bá»™ nhá»› váº­y lÃ­ há»‡ thá»‘ng (full dump of the physical memory) á»Ÿ dáº¡ng core file. NÃ³ khÃ´ng cho phÃ©p ghi vÃ o bá»™ nhá»› Ä‘Ã£ nÃ³i.\nQuyá»n truy vÃ o Ä‘iá»u nÃ y cho phÃ©p container cÃ³ thá»ƒ Ä‘á»c táº¥t cáº£ host memory.\n  kmem: \u0026ldquo;/proc/kmem\u0026rdquo; lÃ  má»™t giao diá»‡n thay tháº¿ cho \u0026ldquo;/dev/kmem\u0026rdquo; (quyá»n truy cáº­p trá»±c tiáº¿p bá»‹ cháº·n bá»›i cgroup device whitelist), lÃ  má»™t kÃ­ tá»± Ä‘áº¡i diá»‡n cho kernel virtual memory.\nNÃ³ cho phÃ©p cáº£ Ä‘á»c vÃ  viáº¿t, cho phÃ©p trá»±c tieps sá»­a Ä‘á»•i kernel memory. (NÃ³ Ä‘Ã²i há»i sá»± khÃ©o lÃ©o hÆ¡n má»™t chÃºt so vá»›i kmem, vÃ¬ cÃ¡c Ä‘á»‹a chá»‰ áº£o cáº§n Ä‘Æ°á»£c phÃ¢n giáº£i thÃ nh cÃ¡c Ä‘á»‹a chá»‰ váº­t lÃ­ trÆ°á»›c).\n  sysrq-trigger: ghi vÃ o tá»‡p Ä‘áº·c biá»‡t nÃ y cho phÃ©p gá»­i cÃ¡c lá»‡nh khÃ³a yÃªu cáº§u (Request Key commands), cho phÃ©p mÃ´t sá»‘ hÃ nh Ä‘á»™ng Ä‘áº·c quyá»n,\ncháº³ng háº¡n nhÆ° há»§y cÃ¡c quy trÃ¬nh, liá»‡t kÃª táº¥t cáº£ cÃ¡c quy trÃ¬nh trÃªn há»‡ thÃ´ng hoáº·c kÃ­ch hoáº¡t khá»Ÿi Ä‘á»™ng láº¡i mÃ¡y chá»§.\n  CÃ¡c khá»‘i quan trá»ng cuá»‘i cÃ¹ng ghi Ä‘áº¿n má»™t sá»‘ nÆ¡i khÃ¡c nhau cÃ³ thá»ƒ nguy hiá»ƒm:\n1 2 3 4 5 6  # deny writes in /sys except for /sys/fs/cgroup, also allow # fusectl, securityfs and debugfs to be mounted there (read-only) deny mount fstype=debugfs -\u0026gt; /var/lib/ureadahead/debugfs/, deny /sys/firmware/efi/efivars/** rwklx, deny /sys/kernel/security/** rwklx, deny @{PROC}/sys/fs/** wklx,     debugfs: cung cáº¥p má»™t giao diá»‡n \u0026ldquo;no rules\u0026rdquo; mÃ  kernel (hoáº·c kernel module) cÃ³ thá»ƒ táº¡o ra cÃ¡c giao diá»‡n debug cÃ³ thá»ƒ truy cáº­p vÃ o vÃ¹ng ngÆ°á»i dÃ¹ng (userland).\nNÃ³ Ä‘Ã£ cÃ³ má»™t sá»‘ váº¥n Ä‘á» vá» báº£o máº­t trong quÃ¡ khá»© vÃ  cÃ¡c nguyÃªn táº¯c \u0026ldquo;no rules\u0026rdquo; Ä‘áº±ng sau há»‡ thá»‘ng tá»‡p thÆ°á»ng xung Ä‘á»™t vá»›i cÃ¡c rÃ ng buá»™c báº£o máº­t.\nBÃªn trong má»™t LXC container, nÃ³ Ä‘Æ°á»£c gÃ¡n á»Ÿ cháº¿ Ä‘á»™ chá»‰ Ä‘á»c.\n  /sys/firmware/efi/efivars: efivars cung cáº¥p má»™t giao diá»‡n Ä‘á»ƒ viáº¿t vÃ o NVRAM sá»­ dá»¥ng cho cÃ¡c Ä‘á»‘i sá»‘ khá»Ÿi Ä‘á»™ng UEFI (UEFI boot arguments).\nViá»‡c sá»­a Ä‘á»•i chÃºng cÃ³ thá»ƒ khiáº¿n mÃ¡y chá»§ khÃ´ng thá»ƒ khá»Ÿi Ä‘á»™ng Ä‘Æ°á»£c (unbootable).\n  /sys/kernel/security: Ä‘Æ°á»£c gÃ¡n á»Ÿ Ä‘Ã¢y lÃ  má»™t giao diá»‡n securityfs, cho phÃ©p cáº¥u hÃ¬nh Linux Security Modules. NÃ³ cho phÃ©p cáº¥u hÃ¬nh chÃ­nh sÃ¡ch cá»§a AppArmor,\nvÃ¬ váº­y, quyá»n truy cáº­p vÃ o Ä‘iá»u nÃ y cÃ³ thá»ƒ cho phÃ©p má»™t vÃ¹ng chá»©a vÃ´ hiá»‡u hÃ³a há»‡ thá»‘ng MAC cá»§a nÃ³.\n  /proc/sys/fs: ThÆ° má»¥c nÃ y chá»©a má»™t máº£ng cÃ¡c options vÃ  thÃ´ng tin liÃªn quan Ä‘áº¿n cÃ¡c khÃ­a cáº¡nh khÃ¡c nhau cá»§a há»‡ thá»‘ng tá»‡p, bao gá»“m: quota, file handle, inode,\nand dentry information. Ghi vÃ o thÆ° má»¥c nÃ y cho phÃ©p cÃ¡c cuá»™c táº¥n cÃ´ng tá»« chá»‘i dá»‹ch vá»¥ khÃ¡c nhau chá»‘ng láº¡i mÃ¡y chá»§.\n  seccomp  LÃ  cÆ¡ cháº¿ cho system call filtering. ChÃ­nh sÃ¡ch cá»§a policies Ä‘áº¿n tá»« 2 version.  Trong version 1, má»™t filter lÃ  má»™t táº­p há»£p nhá» cÃ¡c lá»‡nh gá»i há»‡ thá»‘ng khÃ´ng thá»ƒ tÃ¹y chá»‰nh. Trong version 2, \u0026ldquo;Filter mode\u0026rdquo;, system call filter Ä‘Æ°á»£c viáº¿t nhÆ° chÆ°Æ¡ng trÃ¬nh lá»c gÃ³i Berkeley (Berkeley Packet Filter - BPF). ÄiÃªu\nÄÃ¢y Ä‘Æ°á»£c gá»i lÃ  \u0026ldquo;Strict\u0026rdquo; mode. LXC hiá»‡n táº¡i sá»­ dá»¥ng má»™t chÃ­nh sÃ¡ch khÃ¡ Ä‘Æ¡n giáº£n, trong khi báº£n release 1.10 cá»§a docker Ä‘Æ°á»£c giá»›i thiá»‡u há»— trá»£ cho seccomp-bpf.\nMá»™t Ä‘iá»u lÆ°u Ã½ lÃ  trong Docker 1.10, seccomp khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng theo máº·c Ä‘á»‹nh trÃªn trusty (hÆ¡i khÃ³ hiá»ƒu vÃ¬ docker 1.10 trÃªn ubuntu 15.10, seccomp váº«n Ä‘Æ°á»£c sá»­ dá»¥ng máº·c Ä‘á»‹nh).\nTuy nhiÃªn, ká»ƒ tá»« Docker 1.11.1 seccomp hiá»‡n cÅ©ng Ä‘Æ°á»£c sá»­ dá»¥ng theo máº·c Ä‘á»‹nh trÃªn trusty.    Táº§m quan trá»ng cá»§a Seccomp Seccomp-BPF cho phÃ©p cáº¥u hÃ¬nh lá»c nhá»¯ng \u0026ldquo;lá»i gá»i há»‡ thá»‘ng nguy hiá»ƒm\u0026rdquo;. Äá»‘i vá»›i má»™t sá»‘ phiÃªn báº£n hiá»‡n nay, LXC Ä‘Ã£ xuáº¥t xÆ°á»Ÿng vá»›i chÃ­nh sÃ¡ch seccomp ráº¥t nhá», Ä‘Æ¡n giáº£n,\nvá»›i minh há»a á»Ÿ dÆ°á»›i. Vá»›i báº£n Docker 1.10, Docker Ä‘Ã£ thÃªm nhiá»u chÃ­nh sÃ¡ch phá»©c táº¡p hÆ¡n.\n1 2 3 4 5 6 7 8 9  2 blacklist reject_force_umount # comment this to allow umount -f; not recommended [all] kexec_load errno 1 open_by_handle_at errno 1 init_module errno 1 finit_module errno 1 delete_module errno 1   Pháº§n Ä‘áº§u cá»§a chÃ­nh sÃ¡ch LXC Ä‘Æ°á»£c sá»­ dá»¥ng nhÆ° má»™t biá»‡n phÃ¡p báº£o vá»‡ chuyÃªn sÃ¢u Ä‘á»ƒ ngÄƒn cháº¡n cÃ¡c vÃ¹ng chá»©a buá»™c pháº£i ummounting cÃ¡c pháº§n cá»§a filesystem.\nKernel Manipulation Má»™t sá»‘ lá»‡nh cho phÃ©p thao tÃ¡c vá»›i kernel module bá»‹ cáº¥m (init_module, finit_module, delete_module), cÅ©ng nhÆ° kexec_load cho phÃ©p thay tháº¿ kernel hiá»‡n táº¡i báº±ng\nmá»™t kernel images má»›i. LÆ°u Ã½, cÃ³ má»™t sá»‘ biá»‡n phÃ¡p báº£o vá»‡ chuyÃªn sÃ¢u chá»‘ng láº¡i viá»‡c khai thÃ¡c chÃºng trong cÃ¡c container Ä‘áº·c quyá»n:\n init_module, finit_module, delete_module: táº¥t cáº£ yÃªu cáº§u SYS_MODULE capability - Ä‘Ã£ bá»‹ loáº¡i bá» bá»Ÿi Docker vÃ  LXC trong privileged containers. kexec_load khÃ´ng yÃªu cáº§u SYS_MODULE, thay vÃ o Ä‘Ã³ nÃ³ yÃªu cáº§u SYS_BOOT - privileged LXC container giá»¯. Trong háº§u háº¿t cÃ¡c trÆ°á»ng há»£p, Ä‘iá»u nÃ y khÃ´ng thá»ƒ khai thÃ¡c (mÃ  khÃ´ng bypass seccomp),\ntuy nhiÃªn, Ä‘iá»u Ä‘Ã¡ng chÃº Ã½ lÃ  Linux 3.17 Ä‘Ã£ gá»›i hiá»‡u 1 biáº¿n thá»ƒ má»›i cá»§a kexec: kexec_file_load. Lá»‡nh gá»i nÃ y (táº£i signed kernels) khÃ´ng náº±m trong danh sÃ¡ch Ä‘en cá»§a privileged LXC container, vÃ  chá»‰ yÃªu cáº§u SYS_BOOT. Tuy nhiÃªn, vÃ¹ng chá»©a LXC Ä‘áº·c quyá»n cÃ³ má»™t sá»‘ váº¥n Ä‘á» khÃ¡c cho phÃ©p thoÃ¡t khá»i container mÃ  khÃ´ng cáº§n boot vÃ o kernel má»›i (vÃ¬ trÃªn thá»±c táº¿, chÃºng ta cÃ³ thá»ƒ bypass seccomp).  The Issue With open_by_handle_at() open_by_handle_at lÃ  má»™t lá»£i gá»i há»‡ thá»‘ng khÃ¡ thÃº vá»‹, ban Ä‘áº§u nÃ³ Ä‘Æ°á»£c Ä‘Æ°a vÃ o kernel Ä‘á»ƒ há»— trá»£ userspace file servers Ä‘á»ƒ cÃ¡c process dá»… dÃ ng chuyá»ƒn cÃ¡c mÃ£ Ä‘á»‹nh danh tá»‡p duy nháº¥t (unique file identifiers) cho nhau.\nTuy nhiÃªn, nÃ³ láº¡i lÃ  má»™t cÆ¡n Ã¡c má»™ng cá»§a báº£o máº­t. Báº¥t kÃ¬ process nÃ o cÃ³ kháº£ nÄƒng DAC_READ_SEARCH Ä‘á»u cÃ³ thá»ƒ sá»­ dá»¥ng open_by_handle_at Ä‘á»ƒ cÃ³ quyá»n truy cáº­p vÃ o báº¥t cá»© tá»‡p nÃ o,\nngay cáº£ cÃ¡c tá»‡p bÃªn ngoáº¡i khÃ´ng gian tÃªn gáº¯n káº¿t cá»§a chÃºng. Xá»­ lÃ­ Ä‘Æ°á»£c chuyá»ƒn vÃ o open_by_handle_at nháº±m má»¥c Ä‘Ã­ch giÃºp má»™t sá»‘ nháº­n dáº¡ng khÃ´ng rÃµ Ä‘Æ°á»£c truy xuáº¥t báº±ng cÃ¡ch sá»­ dá»¥ng name_to_handle_at.\nTuy nhiÃªn, quÃ¡ trÃ¬nh xá»­ lÃ­ nÃ y láº¡i chá»©a thÃ´ng tin nháº¡y cáº£m vÃ  cÃ³ thá»ƒ bá»‹ giáº£ máº¡o. Lá»—i nÃ y Ä‘Æ°á»£c chá»‰ ra trong docker container bá»Ÿi Sebastian krahmer, Ä‘iá»u nÃ y Ä‘Ã£ áº£nh hÆ°á»›ng Ä‘áº¿n cáº£ LXC vÃ  Docker.\nNÃ³ cÅ©ng lÃ  má»™t váº¥n Ä‘á» trong OpenVZ (má»™t há»‡ thá»‘ng container khÃ¡c, nhÆ°ng nay Ä‘Ã£ khÃ´ng cÃ²n phá»• biáº¿n nhiá»u ná»¯a). Docker Ä‘Ã£ giáº£i quyáº¿t báº±ng cÃ¡ch bá» DAC_READ_SEARCH (cÅ©ng nhÆ° cháº·n nhÆ°ng truy cáº­p vÃ o open_by_handle_at báº±ng seccomp).\nLXC giáº£i quyáº¿t báº±ng cÃ¡ch sá»­ dá»¥ng user namespaces, vÃ  máº·c Ä‘á»‹nh cháº·n nhá»¯ng lá»i gá»i há»‡ thá»‘ng thÃ´ng qua seccomp. ChÃ­nh sÃ¡ch cá»§a seccomp Ä‘Ã£ bá»‹ vÃ´ hiá»‡u hÃ³a trong cáº£\nprivileged vÃ  unprivileged cá»§a LXC containers. VÃ¬ váº­y, nhá»¯ng ngÆ°á»i dÃ¹ng tháº­n trá»ng Ä‘Æ°á»£c khuyÃªn nÃªn cáº¥u hÃ¬nh unprivileged LXC container vÃ  bá» DAC_READ_SEARCH (vÃ  cÃ³ thá»ƒ cáº£ SYS_PTRACE).\nAbusing Privileged Containers SYS_RAWIO Abuse  SYS_RAWIO Ä‘Æ°á»£c cho lÃ  dá»… láº¡m dá»¥ng vÃ¬ nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng trÃªn toÃ n bá»™ kernel vÃ  trong má»™t sá»‘ ngá»¯ cáº£nh nháº¡y cáº£m, Ä‘iá»u nÃ y dáº«n Ä‘áº¿n viá»‡c tÃ¬m tháº¥y lá»—i container escape trÃªn\nLXC privileged container. Nhá»¯ng phiÃªn báº£n má»›i cá»§a LXC Ä‘Ã£ bá» SYS_RAWIO vÃ  cÃ³ thÃªm nhá»¯ng luáº­t AppArmor Ä‘á»ƒ cháº·n truy cáº­p vÃ o \u0026ldquo;/proc/bus\u0026rdquo;. Tá»« bÃªn trong containter, ta cÃ³ thá»ƒ truy cáº­p vÃ o \u0026ldquo;control regions\u0026rdquo; cá»§a thiáº¿t bá»‹ Ä‘Æ°á»£c gáº¯n vÃ o host PCI bus báº±ng \u0026ldquo;/proc/bus/pci/interface\u0026rdquo;. Äá»ƒ truy cáº­p vÃ o \u0026ldquo;/proc/interface\u0026rdquo; cáº§n pháº£i cÃ³ quyá»n SYS_RAWIO.\nTháº­m chÃ­, Ä‘Æ°á»ng dáº«n \u0026ldquo;/proc\u0026rdquo; bá»‹ cháº·n bá»Ÿi AppArmor, container vá»›i SYS_RAWIO váº«n cÃ³ thá»ƒ tiáº¿p tá»¥c truy cáº­p vÃ o interface nÃ y thÃ´ng qua \u0026ldquo;iopl/ioperm\u0026rdquo;\n(sau Ä‘Ã³ sá»­ dá»¥ng inb, outb, friends Ä‘á»ƒ truy cáº­p vÃ o IO ports). Má»™t Ä‘iá»u lÆ°u Ã½ lÃ  Docker khÃ´ng bá»‹ lá»—i nÃ y, vÃ¬ \u0026quot;/proc\u0026quot; thÆ°á»ng Ä‘Æ°á»£c gáº¯n cho cháº¿ Ä‘á»™ chá»‰ Ä‘á»c vÃ  SYS_RAWIO bá»‹ loáº¡i bá».\nTrong pháº£n há»“i vá» lá»—i nÃ y, nhÃ³m LXC nháº­n xÃ©t ráº±ng há» coi cÃ¡c vÃ¹ng privileged container vá»‘n khÃ´ng an toÃ n, vÃ¬ cÃ³ má»™t lá»— há»•ng Ä‘Ã£ biáº¿t vÃ  \u0026ldquo;khÃ´ng thá»ƒ sá»­a\u0026rdquo; trong cÃ¡c vÃ¹ng privileged containers.  The ptrace Hole \u0026ldquo;Kiá»ƒm tra seccomp sáº½ khÃ´ng Ä‘Æ°á»£c cháº¡y láº¡i sau khi tracer Ä‘Æ°á»£c thÃ´ng bÃ¡o. (ÄiÃªu nÃ y cÃ³ nghÄ©a lÃ  há»™p cÃ¡t dá»±a trÃªn seccomp KHÃ”NG cho phÃ©p sá»­ dá»¥ng ptrace, ngay cáº£ sandboxed processes,\nmaf khÃ´ng tháº­n trá»ng, ptracer cÃ³ thá»ƒ Ä‘Æ°á»£c bá»‹ sá»­ dá»¥ng Ä‘á»ƒ escappe).\u0026rdquo;\n  Báº£n thÃ¢n \u0026ldquo;lá»— há»•ng báº£o máº­t\u0026rdquo; lÃ  má»™t váº¥n Ä‘á» Ä‘Æ¡n giáº£n vá» Time-of-Check-to-Time-of-Use (TOCTTOU): seccomp filtering Ä‘Æ°á»£c Ã¡p dá»¥ng trÆ°á»›c khi tracer Ä‘Æ°á»£c thÃ´ng bÃ¡o (vÃ  trÆ°á»›c khi cuá»™c gá»i há»‡ thá»‘ng thá»±c sá»± dÆ°á»£c kÃ­ch hoáº¡t),\nvÃ¬ váº­y pacer cÃ³ thá»ƒ sá»­a Ä‘á»•i cÃ¡c thanh ghi Ä‘Æ°á»£c sá»­ dá»¥ng trong lá»‡nh gá»i há»‡ thá»‘ng (sau khi chÃºng Ä‘Ã£ Ä‘Æ°á»£c kiá»ƒm tra bá»Ÿi seccomp) Ä‘á»ƒ biáº¿n má»™t lá»‡nh gá»i há»‡ thá»‘ng tá»« bÃ¬nh thÆ°á»ng trá»Ÿ thÃ nh \u0026ldquo;Ä‘á»™c háº¡i\u0026rdquo;.\nCÃ¡ch mafg docker giáº£i quyáº¿t váº¥n Ä‘á» nÃ y Ä‘Æ¡n giáº£n lÃ  khÃ´ng cho phÃ©p sá»­ dá»¥ng ptrace trong containers (báº±ng cÃ¡ch loáº¡i bá» SYS_PTRACE á»Ÿ cháº¿ Ä‘á»™ máº·c Ä‘á»‹nh). Máº·c dÃ¹ seccomp cÃ³ thá»ƒ bá»‹ vÃ´ hiá»‡u hÃ³a báº±ng cÃ¡ch sá»­ dá»¥ng ptrace trong unprivileged contaner,\nviá»‡c lÃ m dá»¥ng open_by_handle_at sáº½ khÃ´ng thÃ nh cÃ´ng, vÃ¬ quÃ¡ pocess váº«n thiáº¿u DAC_READ_SEARCH trong root namespace. Vá»›i viá»‡c bá»• sung user namespace vÃ o docker, kháº£ nÄƒng docker sáº½ cho phÃ©p sá»­ dá»¥ng ptrace bÃªn trong container (máº·c dÃ¹ khÃ´ng cháº¯c\ndo sá»± táº­p trung gáº§n Ä‘Ã¢y cá»§a há» vÃ o seccomp).\n  Máº·c dÃ¹ LXC privileged containers vá»‘n Ä‘Ã£ khÃ´ng an toÃ n, viá»‡c tÃ¬m ra cÃ¡c Ä‘iá»ƒm Ä‘á»™t phÃ¡ (breakout) lÃ  má»™t bÃ i táº­p thÃº vá»‹ (vÃ  thÆ°á»ng chÃºng cÃ³ thá»ƒ lÃ m cho cÃ¡c privileged container an toÃ n hÆ¡n má»™t chÃºt)\n  Abusing Unprivileged Containers Tiáº¿p theo, chÃºng ta sáº½ tÃ¬m hiá»ƒu nhá»¯ng Ä‘iá»ƒm yáº¿u cá»§a unprivileged containers.\nPID Namespacing Info-Leak ChÃºng ta sáº½ nÃ³i Ä‘áº¿n tá»‡p /proc/sched_debug. pseudo-file nÃ y cho phÃ©p unprivileged user cÃ³ thá»ƒ xem thÃ´ng tin debug cho Linux scheduler vÃ  khÃ´ng biáº¿t PID-namespace. Dá»… tháº¥y, nÃ³ tiáº¿t lá»™ tÃªn vÃ  PID cá»§a táº¥t cáº£ cÃ¡c tiáº¿n trÃ¬nh Ä‘ang cháº¡y trÃªn há»‡ thá»‘ng (vÃ  tháº­m chÃ­ biáº¿t cáº£ nhÃ³m tÃ¡c vá»¥ cá»§a chÃºng (cgroup) lÃ  gÃ¬, giÃºp xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c cÃ¡c vÃ¹ng chá»©a khÃ¡c trÃªn há»‡ thá»‘ng vÃ  há»‡ thá»‘ng container nÃ o Ä‘ang Ä‘Æ°á»£c thá»±c thi). Lá»—i nÃ y Ä‘Ã£ Ä‘Æ°á»£c reported cho cáº£ Docker vÃ  LXC vÃ  nÃ³ Ä‘Ã£ Ä‘Æ°á»£c vÃ¡ á»Ÿ Docker.\nNET_RAW abuse Cáº¥u hÃ¬nh phá»• biáº¿n nháº¥t cho cÃ¡c cÃ´ng ty cung cáº¥p giáº£i phÃ¡p PaaS Ä‘Æ°á»£c xÃ¢y dá»±ng trÃªn container lÃ  cÃ³ nhiá»u container cá»§a khÃ¡ch hÃ ng cháº¡y trÃªn cÅ©ng má»™t mÃ¡y chá»§ váº­t lÃ½. Theo máº·c Ä‘á»‹nh, cáº£ LXC vÃ  Docker Ä‘á»u thiáº¿t láº­p container network Ä‘á»ƒ táº¥t cáº£ cÃ¡c vÃ¹ng chá»©a chia sáº» cÃ¹ng má»™t Linux virtual bridge. Do Ä‘Ã³, nhá»¯ng container nÃ y sáº½ cÃ³ thá»ƒ giao tiáº¿p vá»›i nhau. Ngay cáº£ khi quyá»n truy cáº­p máº¡ng trá»±c tiáº¿p nÃ y bá»‹ vÃ´ hiá»‡u hÃ³a (set flag -icc = false cho Docker hoáº·c sá»­ dá»¥ng iptables rules cho LXC), cÃ¡c container váº«n khÃ´ng bá»‹ háº¡n cháº¿ Ä‘á»‘i vá»›i viá»‡c truy cáº­p link-layer traffic. Äáº·c biá»‡t, cÃ³ thá»ƒ tiáº¿n hÃ nh má»™t cuá»™c táº¥n cÃ´ng giáº£ máº¡o ARP vÃ o má»™t container khÃ¡c trong cÃ¹ng má»™t há»‡ thá»‘ng mÃ¡y chá»§, cho phÃ©p táº¥n cÃ´ng full middle-person Ä‘á»‘i vá»›i lÆ°u lÆ°á»£ng cá»§a container má»¥c tiÃªu. ChÃºng ta sáº½ cÃ³ má»™t bÃ i viáº¿t nÃ³i rÃµ hÆ¡n vá» cÃ¡ch táº§n cÃ´ng nÃ y.\nSau khi nháº­n Ä‘Æ°á»£c bÃ¡o cÃ¡o nÃ y, LXC team Ä‘Ã£ Ä‘á» xuáº¥t má»™t sá»‘ giáº£i phÃ¡p, chÃºng bao gá»“m:\n Sá»­ dá»¥ng LXD vá»›i OpenStack Ä‘á»ƒ quáº£n lÃ­ container networking Sá»­ dá»¥ng libvirt Ä‘á»ƒ quáº£n lÃ­ MAC tables cá»§a bridges/containers. Sá»­ dá»¥ng má»™t virtual bridge riÃªng trÃªn má»—i trust zone hoáº·c trÃªn má»—i container.  Denial of Service Attacks User namespaces hoáº¡t Ä‘á»™ng báº±ng cÃ¡ch \u0026ldquo;sliding\u0026rdquo; UIDs giá»¯a user namspace (container) vÃ  root namespace (host). VÃ­ dá»¥, máº·c Ä‘á»‹nh cÃ i Ä‘áº·t cá»§a LXC thÃ¬ UID 0 bÃªn trong contaner sáº½ trá»Ÿ thÃ nh UID 100000 trÃªn host. Tuy nhiÃªn, máº·c Ä‘á»‹nh trÃªn cáº£ LXC vÃ  Docker lÃ  sá»­ dá»¥ng cÃ¹ng má»™t trang trÃ¬nh bÃ y UID cho táº¥t cáº£ cÃ¡c unprivileged container.\nNÃ³i cÃ¡ch khÃ¡c, cÃ¡c UID giá»‘ng há»‡t nhau cá»§a cÃ¡c process trong container khÃ¡c nhau sáº½ cÃ³ giÃ¡ trá»‹ giá»‘ng nhau trÃªn mÃ¡y chá»§, chá»‰ Ä‘Æ°á»£c chuyÃªn lÃªn báº±ng má»™t slide khÃ´ng Ä‘á»•i (tá»©c lÃ  táº¥t cáº£ cÃ¡c process Ä‘ang cháº¡y dÆ°á»›i root bÃªn trong báº¥t kÃ¬ container nÃ o sáº½ Ä‘ang cháº¡y vá»›i UID 100000 trÃªn host). Äiá»u nay lÃ m tÄƒng kháº£ nÄƒng ulimit cá»§a ngÆ°á»i dÃ¹ng khi bá»‹ táº¥n cÃ´ng, vÃ¬ cÃ¡c khu vá»±c nÃ y cá»§a kernel khÃ´ng xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c user namespace. LÆ°u Ã½ ráº±ng cÃ¡c Ä‘iá»u kiá»‡n cá»§a tá»« chá»‘i dá»‹ch vá»¥ (Dos) xáº£y ra mÃ  khÃ´ng cáº§n user namespace (cÅ©ng nhÆ° Ä‘iá»u kiá»‡n tÆ°Æ¡ng tá»± cá»§a UID mÃ¡y chá»§ Ä‘Æ°á»£c chia sáº» Ä‘áº» Ã¡p dá»¥ng). ChÃºng ta sáº½ cÃ³ má»™t bÃ i viáº¿t riÃªng Ä‘á»ƒ tháº£o luáº­n vá» cÃ¡ch táº¥n cÃ´ng nÃ y, tuy nhiÃªn chÃºng ta cÃ³ má»™t sá»‘ khÃ¡i niá»‡m cáº§n lÆ°u Ã½:\n pending Signals: ÄÃ¢y lÃ  giá»›i háº¡n cho má»—i ngÆ°á»i dÃ¹ng vá» sá»‘ lÆ°á»£ng tÃ­n hiá»‡u Ä‘ang chá» xá»­ lÃ½ tá»‘i Ä‘a cÃ³ thá»ƒ Ä‘Æ°á»£c xáº¿p hÃ ng Ä‘á»£i trong táº¥t cáº£ cÃ¡c process cá»§a ngÆ°á»i dÃ¹ng. process cháº¡y trong má»™t container cÃ³ thá»ƒ xáº¿p hÃ ng Ä‘á»£i sá»‘ lÆ°á»£ng tin hiá»‡u Ä‘ang chá» xá»­ lÃ½ tá»‘i Ä‘a, ngÄƒn cÃ¡c quÃ¡ trÃ¬nh trong cÃ¡c process khÃ¡c nháº­n Ä‘Æ°á»£c tÃ­n hiá»‡u Ä‘ang chá» xá»­ lÃ½. Thá»±c nghiá»‡m cho tháº¥y, Ä‘iá»u nÃ y lÃ m áº£nh hÆ°á»Ÿng Ä‘áº¿n cáº£ LXC vÃ  Docker. Posix Message Queues: giá»›i háº¡n sá»‘ lÆ°á»£ng tÃ i nuyÃªn tá»‘i Ä‘a cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng trÃªn hÃ ng Ä‘á»£i thÃ´ng Ä‘iá»‡p POSIX. QuÃ¡ trÃ¬nh cháº¡y trÃªn má»™t container cÃ³ thá»ƒ lÃ m cáº¡n kiá»‡t táº¥t cáº£ bá»™ nhá»› hÃ ng Ä‘á»£i thÃ´ng Ä‘iá»‡p POSIX cÃ³ sáºµn, ngÄƒn cÃ¡c process trong container khÃ¡c táº¡o hoáº·c gá»­i thÃ´ng Ä‘iá»‡p Ä‘áº¿n hÃ ng Ä‘á»£i thÃ´ng Ä‘iá»‡p POSIX, Thá»­ nghiá»‡m cho tháº¥y viá»‡c nÃ y váº«n Ä‘ang hoáº¡t Ä‘á»™ng trÃªn LXC vÃ  Docker. Max User Processes: giá»›i háº¡n cho má»—i ngÆ°á»i dÃ¹ng vá» sá»‘ lÆ°á»£ng process tá»‘i Ä‘a. Äiá»u nÃ y cÃ³ thá»ƒ dá»… dÃ ng Ä‘Æ°á»£c khai thÃ¡c Ä‘á»ƒ táº¡o ra má»™t Dos Ä‘Æ¡n giáº£n chá»‘ng láº¡i cÃ¡c container khÃ¡c, cÅ©ng nhÆ° mÃ¡y chá»§. Thá»­ nghiá»‡m cho tháº¥y cuá»™c táº¥n cÃ´ng nÃ y ráº¥t thÃ nh cÃ´ng trÃªn LXC (vÃ  cÃ³ thá»ƒ lÃ m há»ng toÃ n bá»™ mÃ¡y chá»§) trong khi trÃªn Docker chá»‰ cÃ³ thá»ƒ háº¡ táº¥t cáº£ vÃ¹ng chá»©a Docker (mÃ¡y chá»§ váº«n á»•n Ä‘á»‹nh). LÆ°u Ã½, Linux 4.3 Ä‘Ã£ thÃªm kháº£ nÄƒng giá»›i háº¡n tÃ i nguyÃªn PID, Ä‘iá»u nÃ y giÃºp cÃ¡c há»‡ thá»‘ng container giáº£m thiáº¿u váº¥n Ä‘á» nÃ y. Max Files: ÄÃ¢y lÃ  giá»›i háº¡n cho má»—i ngÆ°á»i dÃ¹ng vá» sá»‘ lÆ°á»£ng bá»™ mÃ´ táº£ tá»‡p tá»‘i Ä‘a cÃ³ thá»ƒ má»Ÿ. Tren cáº£ LXC vÃ  Docker, Ä‘Ã¢y lÃ  má»™t cÃ¡ch dá»… dÃ ng Ä‘á»ƒ Dos táº¥t cáº£ cÃ¡c container khÃ¡c Ä‘ang cháº¡y trÃªn cÃ¹ng 1 mÃ¡y chá»§.\nBá» qua ulimit, hai Ä‘iá»u kiá»‡n Dos khÃ¡c cÃ³ thá»ƒ Ä‘Æ°á»£c khai thÃ¡c trong container nhÆ° sau: Disk Space: cÃ³ láº½, Dos Ä‘Æ¡n giáº£n nháº¥t Ä‘á»ƒ táº¥n cÃ´ng há»‡ thá»‘ng container lÃ  lÃ m cho á»• Ä‘Ä©a bá»‹ full. Thá»­ nghiá»‡m, cho tháº¥y Ä‘iá»u nÃ y Ä‘Ã£ hoáº¡t Ä‘á»™ng trÃªn LXC vÃ  Docker. KhÃ´ng giá»‘ng nhÆ° má»™t sÃ´ cuá»™c táº¥n cÃ´ng Dos á»Ÿ trÃªn, thÆ°á»ng cÃ³ thá»ƒ lÃ m há»ng mÃ¡y chÃº hoáº¡c gÃ¢y ra báº¥t á»•n Ä‘á»§ Ä‘á»ƒ chÃºng khÃ³ dá»n dáº¹p, cÃ¡ch nÃ y cung cáº¥p kháº£ nÄƒng Ä‘Æ¡n giáº£n nháº¥t Ä‘á»ƒ táº¡o ra má»™t Dos vÃ  sau Ä‘Ã³ dá»n dáº¹p nÃ³ má»™t cÃ¡ch nhanh chÃ³ng. Káº¿t há»£p vá»›i PID Namespacing Info-Leak, Ä‘iá»u nÃ y cÃ³ thá»ƒ cho phÃ©p container cá»§a káº» táº¥n cÃ´ng nháº±m má»¥c tiÃªu Ä‘áº¿n nhá»¯ng ngÆ°á»i thuÃª khÃ¡c trÃªn cÃ¹ng má»™t mÃ¡y chá»§ Ä‘Æ°á»£c chia sáº», chá»‰ táº¡o Ä‘iá»u kiá»‡n Dos cÃ³ chá»n lá»c khi má»™t sá»‘ container hoáº·c process khÃ¡c Ä‘ang cháº¡y. Global File Descriptor Limits: Há»‡ thá»‘ng duy trÃ¬ giá»›i háº¡n vá» sá»‘ lÆ°á»£ng bá»™ mÃ´ táº£ tá»‡p tá»‘i Ä‘a cÃ³ sáºµn tá»•n thá»ƒ (cÃ³ sáºµn táº¡i /proc/sys.fs.filemax, nhÆ° tháº£o luáº­n trÆ°á»›c Ä‘Ã³, container khÃ´ng thá»ƒ ghi vÃ o). Náº¿u container khÃ´ng chia sáº» UID vÃ  cÃ³ bá»™ ulimit vá» sá»‘ bá»™ mÃ´ táº£ tá»‡p mÃ  chÃºng ta cÃ³ thá»ƒ má»Ÿ, container váº«n cÃ³ thá»ƒ cá»‘ gáº¯ng DoS mÃ¡y chá»§ vÃ  cÃ¡c contaienr khÃ¡c báº±ng cÃ¡ch má»Ÿ sÃ´ lÆ°Æ¡ng FD tá»‘i Ä‘a cho phÃ©p khi má»—i ngÆ°á»i dÃ¹ng trong user namespace cá»§a há», cung cáº¥p kháº£ nÄƒng tiÃªu thá»¥ FD Ä‘Æ°á»£c khuáº¿ch Ä‘áº¡i ráº¥t nhiá»u. ÄÃ¢y thÆ°á»ng lÃ  Dos \u0026ldquo;last line\u0026rdquo; vÃ  chá»‰ Ä‘Æ°á»£c Ä‘Æ°á»£c thiá»‡n náº¿u cÃ¡c biÃªn phÃ¡p giáº£m nháº¹ cho cÃ¡c vector khÃ¡c (Ä‘Æ¡n gian hÆ¡n) Ä‘Æ°á»£c Ä‘Æ°a ra.  Container Engine Vulnerabilities Má»™t sá»‘ lá»— há»•ng vÃ  cÃ¡ch khai thÃ¡c.\nDocker Vulnerabilities    Weak/proc permissions Host FD leakage Symlinks     CVE-2015-3630 CVE-2015-3627 CVE-2015-3627   CVE-2015-3631 CVE-2019-15664 CVE-2015-3629     CVE-2019-15664    Escape via Insecure Configuration  Bad idea #1: Exposed Docker Socket Bad idea #2: \u0026ndash;privileged container Bad idea #3: Excessive Capabilities Bad idea #4: Sensitive mounts  Kernel Exploitation The security model of containers is predicated on kernel integrity\nDirty CoW (CVE-2016-5195) ","description":"TÃ¬m hiá»ƒu vá» Container Escapes","id":7,"section":"posts","tags":["Docker"],"title":"TÃ¬m hiá»ƒu vá» Container Escapes","uri":"https://minhlongmt183.github.io/posts/container-escapes/"},{"content":"ToÃ n bá»™ series nÃ y Ä‘Æ°á»£c tham kháº£o tá»« hai nguá»“n chÃ­nh: XuanThuLabChanel vÃ  DockerDoc. Em xin chÃ¢n thÃ nh cáº£m Æ¡n sá»± cá»‘ng hiáº¿n cá»§a cÃ¡c tÃ¡c giáº£ cá»§a nhá»¯ng kÃªnh nÃ³i trÃªn.â¤ï¸â¤ï¸â¤ï¸  Tá»•ng quan vá» Docker Docker lÃ  gÃ¬?  Docker lÃ  má»™t container platform Ä‘á»ƒ phÃ¡t triá»ƒn, triá»ƒn khai vÃ  quáº£n lÃ­ á»©ng dá»¥ng nhanh chÃ³ng. Docker lÃ  ná»n táº£ng má»Ÿ (open platform) Ä‘á»ƒ phÃ¡t triá»ƒn (developing), váº­n chuyá»ƒn (shipping) hoáº·c cháº¡y (running) cÃ¡c á»©ng dá»¥ng. Docker cho phÃ©p á»©ng dá»¥ng cá»§a chÃºng ta Ä‘á»™c láº­p vá»›i cÆ¡ sá»Ÿ háº¡ táº§ng (infrastructure) cá»§a mÃ¡y, do Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ dá»… dÃ ng chia sáº» á»©ng dá»¥ng má»™t cÃ¡ch dá»… dÃ ng giá»¯a cÃ¡c thiáº¿t bá»‹. ChÃºng ta cÃ³ thá»ƒ quáº£n lÃ­ cá»Ÿ sá»Ÿ háº¡ táº§ng (infrastructure) giá»‘ng nhÆ° cÃ¡ch quáº£n lÃ­ nhá»¯ng á»©ng dá»¥ng trÃªn mÃ¡y. Sá»­ dá»¥ng LibContainer Ä‘á»ƒ quáº£n lÃ½ nhá»¯ng function cá»§a Linux kernel vÃ  sá»­ dá»¥ng nhá»¯ng nhÃ³m cÃ´ng nghá»‡ Ä‘á»™c láº­p nhÆ°: Namespaces, Control Groups, AppArmor, security profiles, network interface, rule for the firewall necessary for the operation of containers.  The Docker platform  Docker cung cáº¥p má»™t kháº£ nÄƒng Ä‘Ã³ng gÃ³i vÃ  cháº¡y á»©ng dá»¥ng trÃªn má»™t mÃ´i trÆ°á»ng cÃ´ láº­p, kháº£ nÄƒng nÃ y gá»i lÃ  container. Container nháº¹ vÃ  chá»©a táº¥t cáº£ nhá»¯ng thá»©c cáº§n thiáº¿t Ä‘á»ƒ cháº¡y á»©ng dá»¥ng, do Ä‘Ã³, chÃºng ta chá»‰ cáº§n táº£i vá» vÃ  cháº¡y trÃªn mÃ¡y cÃ¡ nhÃ¢n (host). NgoÃ i ra, mÃ´i trÆ°á»ng Ä‘Æ°á»£c cháº¡y lÃ  mÃ´i trÆ°á»ng Ä‘á»™c láº­p vÃ  báº£o máº­t (security) cho phÃ©p chÃºng ta cháº¡y nhiá»u container Ä‘á»“ng thá»i vÃ  dá»… dÃ ng chia sáº» container trong khi chÃºng ta lÃ m viá»‡c, vÃ  Ä‘áº£m báº£o táº¥t cáº£ má»i ngÆ°á»i Ä‘á»u Ä‘Æ°á»£c chÃºng ta chia sáº» má»™t container sáº½ cÃ³ chung 1 mÃ´i trÆ°á»ng thá»±c thi á»©ng dá»¥ng, vÃ  cho káº¿t quáº£ thá»±c thi giá»‘ng nhau. Docker cung cáº¥p cÃ´ng cá»¥ vÃ  ná»n táº£ng Ä‘á»ƒ quáº£n lÃ­ vÃ²ng Ä‘á»i (lifecycle) containers cá»§a chÃºng ta:  PhÃ¡t triá»ƒn á»©ng dá»¥ng cá»§a chÃºng ta vÃ  há»— trá»£ nhá»¯ng thÃ nh pháº§n Ä‘á»ƒ á»©ng dá»¥ng cÃ³ thá»ƒ sá»­ dá»¥ng container. Container trá»Ÿ thÃ nh má»™t Ä‘Æ¡n vá»‹ (unit) Ä‘á»ƒ phÃ¢n phá»‘i vÃ  kiá»ƒm tra á»©ng dá»¥ng cá»§a chÃºng ta.    DÃ¹ng docker Ä‘á»ƒ lÃ m gÃ¬? Nhanh, phÃ¢n phá»‘i nháº¥t quÃ¡n á»©ng dá»¥ng cá»§a chÃºng ta Docker sáº¯p xáº¿p há»£p lÃ­ vÃ²ng Ä‘á»i phÃ¡t triá»ƒn báº±ng cÃ¡ch cho phÃ©p cÃ¡c developers lÃ m viá»‡c trong mÃ´i trÆ°á»ng chuáº©n, sá»­ dá»¥ng local container - nÆ¡i cung cáº¥p nhá»¯ng á»©ng dá»¥ng vÃ  dá»‹ch vá»¥ (services). Conatiner lÃ  má»™t giáº£i phÃ¡p cho quy trÃ¬nh lÃ m viá»‡c CI/CD (continuous integration and continuous delivery).\nKháº£ nÄƒng triá»ƒn khai vÃ  má»Ÿ rá»™ng  Ná»n táº£ng dá»±a cá»§a container docker Ä‘Ã¡p á»©ng cho khá»‘i cÃ´ng viá»‡c cÃ³ kháº£ nÄƒng linh Ä‘á»™ng cao. Docker container cÃ³ thá»ƒ cháº¡y trÃªn laptop cá»§a láº­p trÃ¬nh viÃªn, cÃ³ thá»ƒ cháº¡y trÃªn mÃ¡y tháº­t hoáº·c mÃ¡y áº£o trong cÃ¡c data center, trÃªn clouder provider, hoáº·c trong há»—n há»£p cÃ¡c mÃ´i trÆ°á»ng (mixture of environments) TÃ­nh linh Ä‘á»™ng vÃ  nháº¹ cá»§a docker lÃ m cho nÃ³ dá»… dÃ ng trong viá»‡c quáº£n lÃ½ Ä‘á»™ng cÃ¡c cÃ´ng viá»‡c, má»Ÿ rá»™ng hoáº·c chia nhá» cÃ¡c á»©ng dá»¥ng, dá»‹ch vá»¥ theo nhu cáº§u kinh doanh, trong thá»i gian thá»±c.  Cháº¡y Ä‘Æ°á»£c nhiÃªu cÃ´ng viá»‡c hÆ¡n trong cÃ¹ng má»™t pháº§n cá»©ng (hardware). VÃ¬ docker nháº¹ vÃ  nhanh, nÃ³ cÃ³ kháº£ nÄƒng thay tháº¿ nhá»¯ng mÃ¡y áº£o Ä‘Æ°á»£c xÃ¢y dá»±ng dá»±a trÃªn hypervisor, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng nhiá»u kháº£ nÄƒng tÃ­nh toÃ¡n hÆ¡n Ä‘á»ƒ thá»±c hiá»‡n má»¥c tiÃªu cá»§a mÃ¬nh. Docker hoáº¡t Ä‘á»™ng hiá»‡u quáº£ cho cáº£ mÃ´i trÆ°á»ng triá»ƒn khai cÃ³ máº­t Ä‘á»™ cao, vá»«a hoáº·c nhá», nÆ¡i mÃ  chÃºng ta cáº§n lÃ m viá»‡c vá»›i Ã­t tÃ i nguyÃªn hÆ¡n.\nKiáº¿n trÃºc cá»§a Docker.  Docker sá»­ dá»¥ng kiáº¿n trÃºc client-server. Docker client sáº½ nÃ³i chuyá»‡n vá»›i docker daemon - trÃ¬nh thá»±c hiá»‡n xÃ¢y dá»±ng, cháº¡y, phÃ¢n phá»‘i docker container cá»§a chÃºng ta.  Docker client vÃ  daemon cÃ³ thá»ƒ cháº¡y trÃªn cÃ¹ng 1 há»‡ thá»‘ng, hoáº·c cÃ³ thá»ƒ káº¿t ná»‘i docker client tá»›i má»™t trÃ¬nh Ä‘iá»u khiá»ƒn docker daemon (remote docker daemon) ChÃºng giao tiáº¿p vá»›i nhau thÃ´ng qua sá»­ dá»¥ng REST API, qua UNIX sockets hoáº·c network interface.    The Docker Daemon( dockerd) Láº¯ng nghe nhá»¯ng yÃªu cáº§u tá»« Docker API vÃ  quáº£n lÃ­ Ä‘á»‘i tÆ°á»£ng cá»§a docker nhÆ°: images, container, networks, volumes. Má»™t daemon can thá»ƒ giao tiáº¿p vá»›i nhá»¯ng daemons khÃ¡c Ä‘á»ƒ quáº£n lÃ­ docker services.\nThe Docker client (docker) LÃ  cÃ¡ch mÃ  ngÆ°á»i dÃ¹ng tÆ°Æ¡ng tÃ¡c vá»›i docker. khi chÃºng ta thá»±c hiá»‡n nhá»¯ng cÃ¢u lá»‡nh nhÆ° docker run, client sáº½ gá»­i cÃ¢u lá»‡nh nÃ y vá»›i dockered Ä‘á»ƒ Ä‘em chÃºng ra ngoÃ i. Lá»‡nh docker sá»­ dá»¥ng Docker API. Docker client cÃ³ thá»ƒ giao tiáº¿p vá»›i má»™t hoáº·c nhiá»u daemon.\nDocker registries MÃ´t docker registry lÆ°u trá»¯ Docker images. Docker Hub lÃ  má»™t public registry mÃ  má»i ngÆ°á»i Ä‘á»u cÃ³ thá»ƒ sá»­ dá»¥ng, vÃ  docker Ä‘Æ°á»£c cáº¥u hÃ¬nh máº·c Ä‘á»‹nh Ä‘á»ƒ tÃ¬m kiáº¿m nhá»¯ng images trÃªn Docker Hub. chÃºng ta cÃ²n cÃ³ thá»ƒ cháº¡y nhá»¯ng registry cá»§a riÃªng chÃºng ta.\nKhi chÃºng ta thá»±c hiá»‡n lá»‡nh docker pull hoáº·c docker run, nhá»¯ng images yÃªu cáº§u sáº½ Ä‘Æ°á»£c kÃ©o tá»« registry cá»§a chÃºng ta vá» mÃ¡y, vÃ  khi thá»±c hiá»‡n lá»‡nh docker push, images cá»§a chÃºng ta sáº½ Ä‘Æ°á»£c Ä‘áº©y lÃªn trÃªn registry.\nDocker Object Images Má»™t image lÃ  má»™t máº«u chá»‰ Ä‘á»c vá»›i táº­p lá»‡nh Ä‘á»ƒ táº¡o ra má»™t docker container. ThÃ´ng thÆ°á»ng, má»™t image dá»±a trÃªn nhá»¯ng image khÃ¡c vá»›i má»™t sá»‘ tÃ¹y chá»‰nh bá»• sung. VÃ­ dá»¥, chÃºng ta muá»‘n xÃ¢y dá»±ng má»™t image dá»±a trÃªn ubuntu image, nhÆ°ng cÃ³ cÃ i thÃªm Apache web server, á»©ng dá»¥ng riÃªng cá»§a chÃºng ta cÅ©ng nhÆ° nhá»¯ng cáº¥u hÃ¬nh cáº§n thiáº¿t Ä‘á»ƒ cÃ³ á»©ng dá»¥ng cháº¡y.\nchÃºng ta cÃ³ thá»ƒ táº¡o images riÃªng hoáº·c sá»­ dá»¥ng nhá»¯ng images Ä‘Ã£ cÃ³ sáºµn trÃªn cÃ¡c registry.\nÄá»ƒ xÃ¢y dá»±ng riÃªng images, chÃºng ta táº¡o Dockfile vá»›i nhá»¯ng cÃº phÃ¡p Ä‘Æ¡n giáº£n Ä‘á»‹nh nghÄ©a cÃ¡c bÆ°á»›c cáº§n thiáº¿t Ä‘á»ƒ táº¡o image vÃ  cháº¡y nÃ³. Má»—i cÃ¢u lá»‡nh trong Dockerfile táº¡o má»™t layer trong image. Khi báº¡n thay Ä‘á»•i Dockerfile vÃ  rebuild image, chá»‰ nhá»¯ng layer bá»‹ thay Ä‘á»•i má»›i buil láº¡i. ÄÃ¢y chÃ­nh lÃ  lÃ­ do lÃ m cho image trá»Ÿ nÃªn nháº¹, nhá», nhanh khi Ä‘em so sÃ¡nh vá»›i nhá»¯ng cÃ´ng nghá»‡ áº£o hÃ³a khÃ¡c.\nContainers  Docker Ä‘Ã³ng gÃ³i pháº§n má»m thÃ nh má»™t Ä‘Æ¡n vá»‹ chuáº©n, gá»i lÃ  container, nÆ¡i lÆ°u táº¥t cáº£ nhá»¯ng thá»© cáº§n thiáº¿t Ä‘á»ƒ cháº¡y pháº§n má»m, bao gá»“m: libraries, systemtools, and code Má»™t container cÃ³ thá»ƒ cháº¡y má»™t images. ChÃºng ta cÃ³ thá»ƒ create, start, stop, move, delete má»™t container báº±ng sá»­ dá»¥ng Docker API hoáº·c CLI. ChÃºng ta cÃ³ thá»ƒ káº¿t ná»‘i tá»« má»™t container tá»›i má»™t hoáº·c nhiá»u networks, Ä‘Ã­nh kÃ¨m bá»™ nhá»› vÃ o trong nÃ³, hoáº·c thÃ¢m chÃ­ cÃ³ thá»ƒ táº¡o ra má»™t image má»›i dá»±a trÃªn tráº¡ng thÃ¡i hiá»‡n táº¡i cá»§a nÃ³. Theo máº·c Ä‘á»‹nh, má»™t container Ä‘á»™c láº­p vá»›i nhá»¯ng container khÃ¡c vÃ  vá»›i host machine. ChÃºng ta cÃ³ thá»ƒ kiá»ƒm soÃ¡t má»©c Ä‘á»™ Ä‘á»™c láº­p cá»§a network, bá»™ nhá»› hoáº·c nhá»¯ng há»‡ thá»‘ng con cÆ¡ báº£n tá»« mÃ´t container tá»›i nhá»¯ng container khÃ¡c hoáº·c tá»« host machine tá»›i nhá»¯ng container. Má»™t container Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a bá»Ÿi images cá»§a nÃ³, cÅ©ng nhÆ° báº¥t ká»³ tÃ¹y chá»n cáº¥u hÃ¬nh nÃ o báº¡n cung cáº¥p cho nÃ³ khi táº¡o hoáº·c khá»Ÿi Ä‘á»™ng nÃ³. Khi má»™t container bá»‹ xÃ³a, nhá»¯ng thay Ä‘á»•i vá» tráº¡ng thÃ¡i cá»§a nÃ³ khÃ´ng Ä‘Æ°á»£c lÆ°u mÃ  sáº½ bá»‹ xÃ³a.  VÃ­ dá»¥ vá» docker run command Nhá»¯ng cÃ¢u lá»‡nh sau run má»™t ubuntu container:\n1  $ docker run -i -t ubuntu /bin/bash   Khi chÃºng ta cháº¡y lá»‡nh nÃ y, quÃ¡ trÃ¬nh thá»±c hiá»‡n sáº½ nhÆ°u sau (xÃ©t trÆ°á»ng há»£p cáº¥u hÃ¬nh lÃ  default):\n1. Náº¿u chÃºng ta khÃ´ng cÃ³ ubuntu image á»Ÿ local, Docker pulls nÃ³ tá»« configured registry cá»§a chÃºng ta, chÃºng ta cÃ³ thá»ƒ kÃ©o nÃ³ xuá»‘ng báº±ng cÃ¢u lá»‡nh: docker pull ubuntu\n2. Docker táº¡o ra má»™t container má»›i, chÃºng ta cÃ³ thá»ƒ tá»± thá»±c hiá»‡n báº±ng lá»‡nh: docker container create.\n3. Docker phÃ¢n bá»• read-write filesystem vÃ o container, nhÆ° lÃ  lá»›p cuá»‘i cÃ¹ng cá»§a nÃ³ (final layer). NÃ³ cho phÃ©p cháº¡y Ä‘á»ƒ táº¡o hoáº·c chá»‰nh sá»­a file hoáº·c thÆ° má»¥c á»Ÿ local filesystem.\n4. Docker táº¡o ra network interface Ä‘á»ƒ Ä‘á»ƒ ná»‘i contain tá»›i default network, vÃ¬ chÃºng ta khÃ´ng chá»‰ Ä‘á»‹nh báº¥t kÃ¬ tÃ¹y chá»n máº¡ng nÃ o - gÃ¡n IP adress vÃ o container. Theo Ä‘á»‹nh nghÄ©a, container cÃ³ thá»ƒ káº¿t ná»‘i vá»›i máº¡ng bÃªn ngoÃ i thÃ´ng qua sá»­ dá»¥ng káº¿t ná»‘i máº¡ng cá»§a mÃ¡y host.\n5. Docker cháº¡y container rá»“i thá»±c thÃ¬ /bin/bash. VÃ¬ container Ä‘ang cháº¡y á»Ÿ cháº¿ Ä‘á»™ tÆ°Æ¡ng tÃ¡c vÃ  gÃ¡n vÃ o terminal (-i, -t flags), chÃºng ta cÃ³ thá»ƒ input tá»« keyboard vÃ  output Ä‘Æ°á»£c ghi vÃ o terminal cá»§a báº¡n.\n6. Khi chÃºng ta gÃµ exit Ä‘á»ƒ dá»«ng /bin/bash, container sáº½ dá»«ng nhÆ°ng khÃ´ng bá»‹ xÃ³a, do Ä‘Ã³, ta cÃ³ thá»ƒ cháº¡y láº¡i hoáº·c xÃ³a nÃ³.\nThe underlying technology Docker Ä‘Æ°á»£c viáº¿t báº±ng ngÃ´n ngá»¯ GO vÃ  táº­n dá»¥ng má»™t sá»‘ tÃ­nh nÄƒng tá»« Linux kernel Ä‘á»ƒ trá»Ÿ thÃ nh chá»©c nÄƒng cá»§a nÃ³.\nDocker sá»­ dá»¥ng má»™t cÃ´ng nghá»‡ Ä‘Æ°á»£c gá»i lÃ  namespaces Ä‘á»ƒ cung cáº¥p khÃ´ng gian Ä‘á»™c láº­p Ä‘Æ°á»£c gá»i lÃ  container. Khi báº¡n cháº¡y má»™t container, Docker táº¡o ra má»™t táº­p namespaces cho container Ä‘Ã³.\nNhá»¯ng namespaces cung cáº¥p má»™t lá»›p Ä‘á»™c láº­p, má»—i khÃ­a cáº¡nh cá»§a má»™t vÃ¹ng chá»©a cháº¡y trong má»™t khÃ´ng gian tÃªn riÃªng biá»‡t vÃ  quyá»n truy cáº­p cá»§a nÃ³ bá»‹ giá»›i háº¡n trong khÃ´ng gian tÃªn Ä‘Ã³.\nCÃ i docker Post-installation steps for Linux Quáº£n lÃ½ docker vá»›i tÆ° cÃ¡ch lÃ  non-root user  Docker daemon káº¿t ná»‘i vá»›i Unix socket thay vÃ¬ cá»•ng TCP. Máº·c Ä‘á»‹nh, Unix socket Ä‘Æ°á»£c sá»Ÿ há»¯u bá»Ÿi root\nvÃ  nhá»¯ng user khÃ¡c chá»‰ cÃ³ thá»ƒ truy cáº­p thÃ´ng qua lá»‡nh sudo. Do Ä‘Ã³, Docker daemon luÃ´n luÃ´n cháº¡y\nvá»›i tÆ° cÃ¡ch lÃ  root user. ChÃºng ta cÃ³ thá»ƒ thiáº¿t láº­p láº¡i Ä‘á»ƒ cháº¡y mÃ  khÃ´ng cáº§n lá»‡nh sudo báº±ng cÃ¡ch táº¡o ra má»™t Unix group lÃ  docker\nvÃ  thÃªm user vÃ o nÃ³. Khi docker daemon cháº¡y, nÃ³ táº¡o má»™t Unix socket mÃ  táº¥t cáº£ cÃ¡c thÃ nh pháº§n cá»§a docker group\ncÃ³ thá»ƒ truy cáº­p vÃ o.   Táº¡o docker group:  $ sudo groupadd docker ThÃªm user vÃ o docker group  $ sudo usermod -aG docker $USER KÃ­ch hoáº¡t sá»± thay Ä‘á»•i  $ newgrp docker Configure Docker to start on boot  TrÃªn Debian vÃ  Ubuntu, Docker service máº·c Ä‘á»‹nh Ä‘Æ°á»£c cáº¥u hÃ¬nh Ä‘á»ƒ khá»Ÿi Ä‘á»™ng khÃ­ boot.\nVá»›i nhá»¯ng distros khÃ¡c, ta cÃ³ thá»ƒ sá»­ dá»¥ng lá»‡nh sau Ä‘Ã¢y Ä‘á»ƒ tá»± Ä‘á»™ng cháº¡y:  $ sudo systemctl enable docker.service $ sudo systemctl enable containerd.service  VÃ  Ä‘á»ƒ táº¯t cháº¿ Ä‘á»™ trÃªn:  $ sudo systemctl disable docker.service $ sudo systemctl disable containerd.service Cáº¥u hÃ¬nh nÆ¡i Docker daemon láº¯ng nghe Ä‘á»ƒ káº¿t ná»‘i  Máº·c Ä‘á»‹nh, Docker daemon sáº½ nghe káº¿t ná»‘i á»Ÿ UNIX socket Ä‘á»ƒ cháº¥p nháº­n cÃ¡c yÃªu cáº§u tá»« local client.\nNgoÃ i ra, chÃºng ta cÃ³ thá»ƒ cho phÃ©p Docker cháº¥p nháº­n nhá»¯ng yÃªu cáº§u tá»« remote host báº±ng viá»‡c cáº¥u hÃ¬nh Ä‘á»ƒ nÃ³ láº¯ng nghe\ntrÃªn má»™t Ä‘á»‹a chá»‰ IP vÃ  má»™t cá»•ng, giá»‘ng nhÆ° UNIX socket.  Configuring remote access with systemd unit file  sudo systemctl edit docker.service Ä‘á»ƒ ghi Ä‘Ã¨ file docker.service. ThÃªm / sá»­a nhá»¯ng lá»‡nh sau:  [Service] ExecStart= ExecStart=/usr/bin/dockerd -H fd:// -H tcp://127.0.0.1:2375 LÆ°u file Reload láº¡i cáº¥u hÃ¬nh systemctl  $ sudo systemctl daemon-reload Cháº¡y láº¡i Docker  $ sudo systemctl restart docker.service Kiá»ƒm tra Ä‘áº£m báº£o sá»± thay Ä‘á»•i  $ sudo netstat -lntp | grep dockerd Configuring remote access with daemon.json  ThÃªm dÃ²ng lá»‡nh vÃ o /etc/docker/daemon.json Ä‘á»ƒ káº¿t ná»‘i vá»›i UNIX socket vÃ  Ä‘á»‹a chá»‰ IP:  { \u0026quot;hosts\u0026quot;: [\u0026quot;unix:///var/run/docker.sock\u0026quot;, \u0026quot;tcp://127.0.0.1:2375\u0026quot;] } Khá»Ÿi Ä‘á»™ng láº¡i Docker Kiá»ƒm tra Ä‘áº£m báº£o sá»± thay Ä‘á»•i  $ sudo netstat -lntp | grep dockerd ThÃªm nhiá»u cáº¥u hÃ¬nh khÃ¡c\n","description":"Docker lÃ  ná»n táº£ng má»Ÿ (open platform) Ä‘á»ƒ phÃ¡t triá»ƒn (developing), váº­n chuyá»ƒn (shipping) hoáº·c cháº¡y (running) cÃ¡c á»©ng dá»¥ng.","id":8,"section":"posts","tags":["Docker"],"title":"TÃ¬m hiá»ƒu vá» docker","uri":"https://minhlongmt183.github.io/posts/docker_overview/"},{"content":"About me\n","description":"Edisc","id":10,"section":"","tags":null,"title":"Edisc","uri":"https://minhlongmt183.github.io/about/"}]